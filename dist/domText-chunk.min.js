(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[1213],{8249:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>y}),String.prototype.replaceAt=function(t,e){return this.substr(0,t)+e+this.substr(t)},String.prototype.removeAt=function(t,e){return this.substr(0,t)+this.substr(e)};let i="( |\t)*?";const a=t=>`(( |\t)+?(?:(?:${t})((?:="[^"]*?")| |\t|>)))`,n=t=>`(?:${i}${t}${i}:${i}[^;]+?${i};${i})`,o=t=>`(?:${i}${t}${i})`;let r=a("[a-z0-9-_]+?"),l=(a(""),`${i}(?<tagSlash>/)?${i}>`),h=n("[^:]+?");o('[^"]+?');const g="data-element_id=";let u=new Map,f=new Map;function m(t,e){this.html=t,this.domHtml=e,this.param={},this.tagStPos,this.tagStAfPos,this.tagStClPos,this.tagStClAfPos,this.tagEnPos,this.tagEnClAfPos,this.atSt,this.atEn}function d(t){return"Text"===t.constructor.name||!t.constructor.name.indexOf("Element")&&void 0}function c(t,e,s){for(let s=0;s<e.length;s++)if(!1===d(e[s])&&e[s].getAttribute("data-element_id")==t)return s;return-1}function p(t){let e=document.createElement(t.tagName);return e.innerHTML=t.innerHTML,E(t,e),e}function b(t,e){!0===d(t)&&e&&!0===d(e)&&(e.data+=t.data,t.remove())}function S(t,e,s){let i="beforebegin"===s?t.before:t.after,a=e.cloneNode(!0);"SCRIPT"===a.tagName&&(a=p(a)),a.querySelectorAll("script").forEach((t=>{t.replaceWith(p(t))})),i.call(t,a)}function C(t,e,s){let i=e.cloneNode(!0);"SCRIPT"===i.tagName&&(i=p(i)),i.querySelectorAll("script").forEach((t=>{t.replaceWith(p(t))})),t.insertAdjacentElement(s,i)}function E(t,e){for(let s of t.attributes)if(!e.attributes[s.name]||e.attributes[s.name].value!==s.value)try{e.setAttribute(s.name,s.value)}catch(t){}if(t.attributes.length!==e.attributes.length)for(let s=0,i=e.attributes.length;s<i;s++){let a=e.attributes[s];t.attributes[a.name]||(e.removeAttribute(a.name),s--,i--)}}m.prototype.reset=function(){this.atEn=null,this.atSt=null,this.atVSt=null,this.atVSt=null,this.tagStPos=null,this.tagStAfPos=null,this.tagStClPos=null,this.tagStClAfPos=null,this.tagEnPos=null,this.tagEnClAfPos=null,this.isOmission=null,this.tagNameEnd=null,this.haveClosingTag=null},m.prototype.setCallback=function({addCallback:t,removeCallback:e}){this.removeCallback=function(t){if(!t)return!1;u.set(t.from*t.to,!0),this.html=this.html.removeAt(t.from,t.to),e.call(null,t)},this.addCallback=function(e){if(!e)return!1;f.set(e.position+e.value,!0),this.html=this.html.replaceAt(e.position,e.value),t.call(null,e)}},m.prototype.findStartTagById=function(){let t=`(?:${i}data-element_id="${this.param.target}"${i})`,e=`(?<tagWhole>(?:<(?<tagName>[a-z0-9]+?))${r}*?${t}${r}*?${l})`,s=this.html.match(new RegExp(e,"is"));if(!s)throw new Error("element is not valid or can not be found");return this.target=this.param.target,this.tagName=s.groups.tagName.toUpperCase(),this.tagStPos=s.index,this.tagStAfPos=s.index+this.tagName.length+1,this.tagStClPos=s.index+s.groups.tagWhole.length-1-(s.groups.tagSlash?1:0),this.haveClosingTag=!s.groups.tagSlash,this.tagStClAfPos=s.index+s.groups.tagWhole.length,this.tagNameEnd=this.tagStAfPos+this.tagName.length,s.groups.tagSlash&&(this.tagEnPos=this.tagStClPos,this.tagEnClAfPos=this.tagStClAfPos,this.isOmission=!0),!0},m.prototype.getWholeElement=function(){return!!this.findStartTagById()&&(this.findClosingTag(),{from:this.tagStPos,to:this.tagEnClAfPos||this.tagStClAfPos})},m.prototype.findClosingTag=function(){let t=this.html.substr(this.tagStClAfPos).matchAll(new RegExp(`(?<tagWhole>${e=this.tagName,`(?:<(?<isClosing>${i}/${i})?${e}${i})`}${r}*?${l})`,"gi"));var e;if(!t)throw new Error("can not find any closing tag");let s=0;for(let e of t)if(e.groups.isClosing){if(!s)return this.tagEnPos=this.tagStClAfPos+e.index,this.tagEnClAfPos=this.tagStClAfPos+e.index+e[0].length,this.tagClosingNameStart=1+e.groups.isClosing.length+this.tagEnPos,this.tagClosingNameEnd=this.tagClosingNameStart+this.tagName.length,!0;s--}else s++;throw new Error("closing tag and openning tag order does not match")},m.prototype.insertAdjacentElement=function({target:t,position:e,element:s,elementValue:i}){let a,n;if(this.param.target=s,this.reset(),!i){if(a=this.getWholeElement(),!a)throw new Error("insertAdjacentElement: element not found");i=this.html.substring(a.from,a.to)}switch(this.param.target=t,this.reset(),this.findStartTagById(),e){case"beforebegin":case"afterbegin":n="beforebegin"==e?this.tagStPos:this.tagStClAfPos;break;case"beforeend":case"afterend":this.findClosingTag(),n="beforeend"==e?this.tagEnPos:this.tagEnClAfPos}a&&(a.to<n&&(n-=a.to-a.from),this.removeCallback(a)),this.addCallback({value:i,position:n})},m.prototype.setClass=function({target:t,classname:e}){if(this.param.target=t,this.reset(),this.findAttribute("class"),this.atVEn){let t=this.findClassPos(e);t.to&&this.removeCallback(t),this.addCallback({position:t.from,value:e})}else this.addCallback({position:this.atSt,value:` class="${e}"`})},m.prototype.setClassStyle=function({target:t,classname:e,value:s,unit:i}){this.param.target=t,this.reset(),this.findAttribute("class");let a=s?` ${e}:${s+i}`:" "+e;if(this.atVEn){let t=this.findClassPos(e);t.to&&this.removeCallback(t),s&&this.addCallback({position:t.from,value:a})}else s&&this.addCallback({position:this.atSt,value:` class="${a}"`})},m.prototype.findClassPos=function(t,e){let s=e?`(?:${i}${t}:[^ ]+${i})`:o(t);let a=this.html.substring(this.atVSt,this.atVEn).match(new RegExp(`(?<ourClass>${s})(?<classstyle>:[^" ]+)( |")?`,"is"));return a&&a.groups.ourClass?{from:this.atVSt+a.index,to:this.atVSt+a.index+a.groups.ourClass.length+a.groups.classstyle.length}:{from:this.atVEn}},m.prototype.setStyle=function({target:t,styleName:e}){if(this.param.target=t,this.reset(),this.findAttribute("style"),this.atVSt===this.atVEn)return{from:this.atVSt,context:"value"};if(this.atVEn){let t=this.findStylePos(e);t.to&&this.removeCallback(t),this.addCallback({position:t.from,value:e})}else this.addCallback({position:this.atSt,value:` style="${e}"`})},m.prototype.findStylePos=function(t){let e=n(t),s=this.html.substring(this.atVSt,this.atVEn).match(new RegExp(`^(?<styleWhole>${h})*?(?<ourStyle>${e})`,"is"));if(s&&s.groups.ourStyle){let t=s.groups.styleWhole?s.groups.styleWhole.length:0;return{from:this.atVSt+t,to:this.atVSt+t+s.groups.ourStyle.length}}return{from:this.atVEn}},m.prototype.findAttribute=function(t){if(!this.findStartTagById())throw new Error("attribute can not be found");let e=a(t),s=`^(?<beforeAtt>${r}*?)${e}`,i=this.html.substr(this.tagStAfPos).match(new RegExp(s,"is"));i?(this.atSt=this.tagStAfPos+i.groups.beforeAtt.length,this.atVSt=this.atSt+3+t.length,this.atEn=this.tagStAfPos+i[0].length,this.atVEn=this.atEn-1):this.atSt=this.tagStClPos},m.prototype.setAttribute=function({target:t,name:e,value:s}){this.param.target=t,this.reset(),this.findAttribute(e),this.atEn&&this.removeCallback({from:this.atSt,to:this.atEn}),s&&this.addCallback({position:this.atSt,value:` ${e}="${s}"`})},m.prototype.removeAttribute=function({target:t,name:e}){this.param.target=t,this.reset(),this.findAttribute(e),this.attEn&&this.removeCallback({from:this.atSt,to:this.atEn})},m.prototype.setInnerText=function({target:t,value:e}){return this.param.target=t,this.reset(),!!this.findStartTagById()&&(this.findClosingTag(),this.removeCallback({from:this.tagStClAfPos,to:this.tagEnPos}),this.addCallback({position:this.tagStClAfPos,value:e}),!0)},m.prototype.getId=function(t){let e=this.html[t],s=this.html.indexOf(e,t+1);return this.html.substring(t+1,s)},m.prototype.isPosOnEl=function(t,e){if(this.param.target=this.getId(t+g.length),this.reset(),!this.findStartTagById())return!1;this.findClosingTag();let s=this.tagStPos,i=this.tagEnClAfPos||this.tagStClAfPos;return this.pos>s&&this.pos<i||void 0},m.prototype.parseAll=function(t){let e=t.match(/\<(?<tag>[a-z0-9]+)(.*?)?\>/).groups.tag;if(!e)throw new Error("find position: can not find the main tag");let s=(new DOMParser).parseFromString(t,"text/html");switch(e){case"html":return[s.documentElement];case"body":return[s.body];case"head":return[s.head];default:return s.head.children.length?s.head.children:s.body.children}},m.prototype.addToDom=function({pos:t,changeStr:e}){let s=t+e;f.has(s)?f.delete(s):this.changeDom({pos:t,changeStr:e})},m.prototype.removeFromDom=function({pos:t,removeLength:e}){let s=t*(e+t);u.has(s)?u.delete(s):this.changeDom({pos:t,removeLength:e})},m.prototype.changeDom=function({pos:t,changeStr:e,removeLength:s}){if(t<0||t>this.html.length)throw new Error("position is out of range");this.changeStr=e,this.removeLength=s,this.pos=t;try{this.findElByPos(t)?this.rebuildByElement():this.rebuildByDocument()}catch(t){throw new Error("domText failed to apply the change "+t.message,t.name)}},m.prototype.rebuildByElement=function(t,e,s){let i=this.html.substring(this.tagStPos,this.tagEnClAfPos||this.tagStClAfPos);if(!i)return;let[a,...n]=this.parseAll(i);for(let t of n)o.insertAdjacentElement("afterend",t);let o=this.domHtml.querySelector(`[data-element_id="${this.target}"]`);this.rebuildDom(a,o)},m.prototype.rebuildByDocument=function(t,e,s){let i=(new DOMParser).parseFromString(this.html,"text/html");this.rebuildDom(i.documentElement,this.domHtml)},m.prototype.rebuildDom=function(t,e,s){if(e.tagName&&t.tagName!==e.tagName&&function(t,e){let s=document.createElement(t.tagName);E(t,s),s.replaceChildren(...t.childNodes),e.replaceWith(s)}(t,e),e.tagName&&("SCRIPT"===e.tagName&&t.src!==e.src?e.replaceWith(p(t)):E(t,e)),s)return;const i=e.childNodes,a=Array.from(t.childNodes);if("HEAD"===t.tagName&&!a.length)return;let n=0,o=a.length;for(;n<o;n++){let t=a[n],o=i[n],r=d(t);if(o){let a=d(o);if(void 0===a)continue;if(r)if(a)t.data.trim()!==o.data.trim()&&(o.data=t.data);else{o.before(document.createTextNode(t.data));let s=o.getAttribute("data-element_id");if(s){let t=c(s,e.childNodes);if(-1===t){o.remove(),b(i[n],i[n-1]),n--;continue}i[t]&&i[t]!==o&&i[t].before(o)}}else if(a)S(o,t,"beforebegin"),o.remove();else{let a=o.getAttribute("data-element_id"),r=t.getAttribute("data-element_id");if(r&&a!==r){let s=c(r,e.childNodes);if(-1===s?C(o,t,"beforebegin"):o.insertAdjacentElement("beforebegin",e.childNodes[s]),o=i[n],a=o.getAttribute("data-element_id"),a){if(s=c(a,e.childNodes),-1===s){o.remove(),b(i[n],i[n-1]),n--;continue}i[s]&&i[s]!==o&&i[s].before(o)}}else this.rebuildDom.call(this,t,o,s)}}else if(!0===r)e.insertAdjacentText("beforeend",t.data);else{if(!1!==r)continue;C(e,t,"beforeend")}}for(;i[n];)i[n].remove()},m.prototype.findElByPos=function(t){let e=t-g.length,s=t+g.length;if(e=this.html.indexOf(g,e+g.length),-1!==e&&this.isPosOnEl(e))return!0;for(;;){if(s=this.html.lastIndexOf(g,s-g.length),-1===s)return!1;if(this.isPosOnEl(s))return!0}};const y=m}}]);