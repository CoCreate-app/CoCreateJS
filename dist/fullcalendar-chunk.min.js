(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[4568],{822:function(e,t,n){var a,r;"undefined"!=typeof self&&self,a=[n(9446),n(374)],void 0===(r=function(e,t){return function(e,t,n){return{socket:null,setSocket:function(e){this.socket=e},readDocumentList(e){if(!e)return;let n=t.getCommonParams();e.collection&&e.operator&&(n={...n,...e},this.socket.send("readDocumentList",n))},createDocument:function(n){if(null===n)return;let a=t.getCommonParamsExtend(n),r={...n,...a},i=n.data||{};i.organization_id||(i.organization_id=e.config.organization_Id),n.data&&(i={...i,...n.data}),r.data=i;const o=t.generateSocketClient(n.namespace,n.room);this.socket.send("createDocument",r,o)},updateDocument:function(e){if(!e||!n.checkDocumentId(e.document_id))return;let a=t.getCommonParamsExtend(e),r={...e,...a};if("object"==typeof e.data&&(r.set=e.data),Array.isArray(e.delete_fields)&&(r.unset=e.delete_fields),!r.set&&!r.unset)return;!1===e.broadcast&&(r.broadcast=!1),void 0===e.broadcast_sender&&(r.broadcast_sender=!0);const i=t.generateSocketClient(e.namespace,e.room);this.socket.send("updateDocument",r,i)},readDocument:function(e){if(null===e)return;if(!e||!n.checkDocumentId(e.document_id))return;let a=t.getCommonParamsExtend(e),r={...e,...a};this.socket.send("readDocument",r)},deleteDocument:function(e){if(!e||!n.checkDocumentId(e.document_id))return;let a=t.getCommonParamsExtend(e),r={...e,...a};const i=t.generateSocketClient(e.namespace,e.room);this.socket.send("deleteDocument",r,i)},exportCollection:function(e){if(null===e)return;let n=t.getCommonParamsExtend(e);n.collection=e.collection,n.export_type=e.export_type,n.metadata=e.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:a}=n;if(null===n||!(a instanceof e.File))return;const r=a.name.split(".").pop();if(!["json","csv"].some((e=>e===r)))return;let i=t.getCommonParamsExtend(n);i.collection=n.collection,i.import_type=r,this.socket.send("importDB",i),this.socket.sendFile(a)},listen:function(e,t){this.socket.listen(e,t)},listenAsync:function(e){return this.socket.listenAsync(e)},createSocket:function(e,t){t?(this.socket.create({namespace:t,room:null,host:e}),this.socket.setGlobalScope(t)):this.socket.create({namespace:null,room:null,host:e})},...n}}(window,e,t)}.apply(t,a))||(e.exports=r)},3623:function(e,t,n){var a,r;"undefined"!=typeof self&&self,a=[n(8585),n(822)],void 0===(r=function(e,t){return function(e,t,n){if(e){let e=new t("ws");n.setSocket(e),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,e,t)}.apply(t,a))||(e.exports=r)},374:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function e(t,n){t=t||{};for(let a of Object.keys(n))n[a]instanceof Object&&Object.assign(n[a],e(t[a],n[a]));return Object.assign(t||{},n),t}function t(e,t){if(!t)return e;let n=t.split("."),a=e;for(var r=n.length-1;r>=0;r--)a={[n[r]]:a};return a}function n(e,t){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(e);if(n&&3==n.length){let a=n[1],r=parseInt(n[2]);t[a]&&Array.isArray(t[a])||(t[a]=[]),t[a][r]=t[e],delete t[e],e=a}}catch{}return e}function a(e){return!!e&&e.constructor===Object}function r(e){return!!e&&e.constructor===Array}function i(a){let r=Object.keys(a),i={};return r.forEach((r=>{if((r=n(r,a)).split(".").length>1){let n=t(a[r],r);delete a[r],i=e(i,n)}else i[r]=a[r]})),i}function o(e){let t=Object.keys(e),n={};return t.forEach((t=>{let i=e[t];if(a(e[t])){let a=o(e[t]);Object.keys(a).forEach((e=>{let r=a[e];n[e=t+"."+e]=r}))}else r(i)?i.forEach(((e,a)=>{n[`${t}[${a}]`]=e})):n[t]=e[t]})),n}function c(e){if(e)return{collection:e.getAttribute("data-collection"),document_id:e.getAttribute("data-document_id"),name:e.getAttribute("name")}}function l(e){return e?{is_realtime:f(e),is_save:s(e),is_read:d(e),is_update:u(e)}:{}}const d=e=>m(e,"data-read_value"),s=e=>m(e,"data-save_value"),u=e=>m(e,"data-update_value"),f=e=>!!e&&"false"!=e.getAttribute("data-realtime");function m(e,t){return!!e&&"false"!==e.getAttribute(t)}function h(e){return!!e&&!/{{\s*([\w\W]+)\s*}}/g.test(e)}function _(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}function g(e){const{collection:t,document_id:n,name:a}=c(e);return!(_(t)||_(a)||!("INPUT"===e.tagName&&["text","email","tel","url"].includes(e.type)||"TEXTAREA"===e.tagName)||!a||!f(e)||"true"===e.getAttribute("data-unique")||"password"===e.type||!d(e))}function y(e){try{return!!e&&"null"!==e.toLowerCase()}catch(e){return!1}}return{decodeObject:i,encodeObject:o,getAttr:c,getFlagAttr:l,isRealtimeAttr:f,isReadAttr:d,isSaveAttr:s,isUpdateAttr:u,checkValue:h,isCRDT:g,checkDocumentId:y}}()}.apply(t,[]))||(e.exports=n)},5850:(e,t,n)=>{"use strict";n.r(t);var a=n(3623),r=n.n(a),i=n(3232),o=n(366),c=n(9844),l=[],d="cal-container";const s=["#09efc6","#09ef1a","#efec09","#ef8609","#ef6009","#b609ef","#ef0986","#09efec","#ecef09","#09a6ef","#076692","#c0b507","#c04807","#6b07c0","#72aeb5","#69811e","#8d2b23"],u=["#8c489f","#f610e5","#1013f6","#1079f6","#109ff6","#49f610","#10f679","#f61013","#1310f6","#f65910","#f8996c","#3f4af8","#3fb7f8","#94f83f","#8d514a","#fff","#72d4dc"];function f(e){let t=e||document;if(!t.querySelectorAll)return;let n=t.querySelectorAll(".cal-container");0==n.length&&t!=document&&t.hasAttribute(d)&&(n=[t]);for(var a=0;a<n.length;a++){var r=n[a],c=r.id;if(!c)continue;var s=r.getAttribute("data-calendar_id"),u=r.getAttribute("data-dispaly_field");let e=i.default.setFilter(r,"data-calendar_id","calendar");if(e&&!o.default.getInitialized(r)){o.default.setInitialized(r);var f=new FullCalendar.Calendar(r,{plugins:["interaction","dayGrid","timeGrid","resourceTimeline","timeline","list"],height:"100%",editable:!0,timeZone:"local",eventResizableFromStart:!0,eventLimit:!0,selectable:!0,selectMirror:!0,nowIndicator:!0,selectMinDistance:100,header:{left:"prev,",center:"title",right:"next"},defaultView:"dayGridMonth",eventClick:function(e){y(e)},eventResize:function(e){p(e)},eventDrop:function(e){p(e)},select:function(e){D(e)}});f.render();var m={eId:c,calendar_id:s,calendar:f,displayName:u,filter:e};r.addEventListener("changeFilterInput",(function(e){m.filter.startIndex=0,CoCreate.filter.fetchData(m.filter)})),CoCreate.filter.fetchData(e),l.push(m)}}}function m(){var e=Math.floor(Math.random()*s.length);return{bg_color:s[e],text_color:u[e]}}function h(e,t){var n="";return e[t]&&t&&(n=e[t]),n}function _(e,t){var n=new Object;const{bg_color:a,text_color:r}=m();return n.id=e._id,n.title=h(e,t),n.textColor="black",n.backgroundColor=a,n.textColor=r,n.start=e.start_date,n.end=A(e.end_date,e.end_time,e.allDay),n.allDay=e.allDay,e.start_time&&(n.start+="T"+e.start_time),e.end_time&&(n.end+="T"+e.end_time),e.start_date&&e.end_date?n:null}function g(e,t){e.getEventById(t).remove()}function y(e){var t=e.event,n=t.id,a=t._calendar.el.querySelector(".eventLink");a.querySelectorAll("[data-pass_document_id]").forEach((e=>{e.getAttribute("data-pass_document_id")||e.setAttribute("data-pass_document_id",n)})),c.default.initDataPassValues(),c.default.setLinkProcess(a)}function p(e){var t=e.event,n=b(t.start),a=b(t.end),i=v(t.start),o=v(t.end),c=t._calendar.el.id,l=k(c);l&&r().updateDocument({collection:l.filter.collection,element:c,metadata:"",document_id:t.id,data:{start_date:n,end_date:a,start_time:i,end_time:o}})}function b(e){var t=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),t+"-"+n+"-"+a}function v(e){var t=e.getHours(),n=e.getMinutes();return t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n}function k(e){for(var t=0;t<l.length;t++){var n=l[t];if(e==n.eId)return n}return null}function D(e){var t=b(e.start),n=b(e.end),a=v(e.start),r=v(e.end);if(k(e.view.calendar.el.id)){const i=e.view.calendar.el.querySelector(".eventLink");i.querySelectorAll("[data-pass_document_id]").forEach((e=>{e.getAttribute("data-pass_document_id")||e.setAttribute("data-pass_document_id","")})),c.default.setDataPassValues({start_date:t,end_date:n,start_time:a,end_time:r}),c.default.setLinkProcess(i)}}function w(e){let t=e||document;if(t.querySelectorAll){var n=t.querySelectorAll("[data-calendar_id][data-btn_type]");0===n.length&&t!=document&&t.hasAttribute("data-btn_type")&&t.hasAttribute("data-calendar_id")&&(n=[t]);for(var a=0;a<n.length;a++){var r=n[a];o.default.getInitialized(r)||(o.default.setInitialized(r),r.addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-btn_type");C(this.getAttribute("data-calendar_id"),t)})))}}}function A(e,t,n){return e}function C(e,t){if(e)for(var n=0;n<l.length;n++){var a=l[n];if(a.eId==e){var r=a.calendar;switch(t){case"dayGridDay":r.changeView("dayGridDay");break;case"dayGridWeek":r.changeView("dayGridWeek");break;case"dayGridMonth":r.changeView("dayGridMonth");break;case"resourceTimelineDay":r.changeView("resourceTimelineDay");break;case"resourceTimelineThreeDays":r.changeView("resourceTimelineThreeDays");break;case"resourceTimelineFiveDays":r.changeView("resourceTimelineFiveDays");break;case"timeGridWeek":r.changeView("timeGridWeek");break;case"timeGridDay":r.changeView("timeGridDay");break;case"listDay":r.changeView("listDay");break;case"listWeek":r.changeView("listWeek");break;case"listMonth":r.changeView("listMonth");break;case"listYear":r.changeView("listYear");break;case"timelineWeek":r.changeView("timelineWeek");break;case"today":r.today()}}}}r().listen("updateDocument",(function(e){!function(e){for(var t=e.collection,n=0;n<l.length;n++){var a=l[n];if(a.filter.collection==t){var r=a.calendar,i=[],o=r.getEventById(e.document_id);if(o){var c=o.start,d=o.end,s=b(c),u=v(c),f=b(d),m=v(d),h=o.allDay;o.backgroundColor,o.textColor;const t=e.data;for(var g in t){if(g==a.displayName){var y=t[g];o.setProp("title",y)}"start_date"==g&&(s=t[g]),"end_date"==g&&(f=t[g]),"start_time"==g&&(u=t[g]),"end_time"==g&&(m=t[g]),"allDay"===g&&(h=t[g])}f=A(f),o.setAllDay(h),o.setStart(s+"T"+u),o.setEnd(f+"T"+m)}else{let t=_(e.data,a.displayName);t&&(i.push(t),r.addEventSource(i))}}}}(e)})),r().listen("deleteDocument",(function(e){!function(e){const t=e.document_id;for(var n=0;n<l.length;n++){var a=l[n];a.filter.collection==e.collection&&g(a.calendar,t)}}(e)})),r().listen("readDocumentList",(function(e){!function(e){let t=i.default.getObjectByFilterId(l,e.element);t&&function(e,t){var n=new Array;t.data.forEach((function(t,a){var r={};const{bg_color:i,text_color:o}=m();r.id=t._id,r.title=h(t,e.displayName),r.textColor=o,r.backgroundColor=i,r.start=t.start_date,r.end=A(t.end_date,t.end_time,t.allDay),r.allDay=t.allDay,t.start_time&&(r.start+="T"+t.start_time),t.end_time&&(r.end+="T"+t.end_time),t.start_date&&t.end_date&&n.push(r)})),e.calendar.addEventSource(n)}(t,e)}(e)})),f(),w(),o.default.register("CoCreateCalendar",window,f),o.default.register("CoCreateCalendar_btn",window,w)}}]);