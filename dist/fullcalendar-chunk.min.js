(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[4568],{5850:(e,t,a)=>{"use strict";a.r(t);var n=a(5611),r=a.n(n),i=a(3232),d=a(366),l=a(9844),c=[],o="cal-container";const s=["#09efc6","#09ef1a","#efec09","#ef8609","#ef6009","#b609ef","#ef0986","#09efec","#ecef09","#09a6ef","#076692","#c0b507","#c04807","#6b07c0","#72aeb5","#69811e","#8d2b23"],u=["#8c489f","#f610e5","#1013f6","#1079f6","#109ff6","#49f610","#10f679","#f61013","#1310f6","#f65910","#f8996c","#3f4af8","#3fb7f8","#94f83f","#8d514a","#fff","#72d4dc"];function f(e){let t=e||document;if(!t.querySelectorAll)return;let a=t.querySelectorAll(".cal-container");0==a.length&&t!=document&&t.hasAttribute(o)&&(a=[t]);for(var n=0;n<a.length;n++){var r=a[n],l=r.id;if(!l)continue;var s=r.getAttribute("data-calendar_id"),u=r.getAttribute("data-dispaly_field");let e=i.default.setFilter(r,"data-calendar_id","calendar");if(e&&!d.default.getInitialized(r)){d.default.setInitialized(r);var f=new FullCalendar.Calendar(r,{plugins:["interaction","dayGrid","timeGrid","resourceTimeline","timeline","list"],height:"100%",editable:!0,timeZone:"local",eventResizableFromStart:!0,eventLimit:!0,selectable:!0,selectMirror:!0,nowIndicator:!0,selectMinDistance:100,header:{left:"prev,",center:"title",right:"next"},defaultView:"dayGridMonth",eventClick:function(e){y(e)},eventResize:function(e){g(e)},eventDrop:function(e){g(e)},select:function(e){p(e)}});f.render();var _={eId:l,calendar_id:s,calendar:f,displayName:u,filter:e};r.addEventListener("changeFilterInput",(function(e){_.filter.startIndex=0,CoCreate.filter.fetchData(_.filter)})),CoCreate.filter.fetchData(e),c.push(_)}}}function _(){var e=Math.floor(Math.random()*s.length);return{bg_color:s[e],text_color:u[e]}}function m(e,t){var a="";return e[t]&&t&&(a=e[t]),a}function h(e,t){var a=new Object;const{bg_color:n,text_color:r}=_();return a.id=e._id,a.title=m(e,t),a.textColor="black",a.backgroundColor=n,a.textColor=r,a.start=e.start_date,a.end=C(e.end_date,e.end_time,e.allDay),a.allDay=e.allDay,e.start_time&&(a.start+="T"+e.start_time),e.end_time&&(a.end+="T"+e.end_time),e.start_date&&e.end_date?a:null}function v(e,t){e.getEventById(t).remove()}function y(e){var t=e.event,a=t.id,n=t._calendar.el.querySelector(".eventLink");n.querySelectorAll("[data-pass_document_id]").forEach((e=>{e.getAttribute("data-pass_document_id")||e.setAttribute("data-pass_document_id",a)})),l.default.initDataPassValues(),l.default.setLinkProcess(n)}function g(e){var t=e.event,a=b(t.start),n=b(t.end),i=k(t.start),d=k(t.end),l=t._calendar.el.id,c=D(l);c&&r().updateDocument({collection:c.filter.collection,element:l,metadata:"",document_id:t.id,data:{start_date:a,end_date:n,start_time:i,end_time:d}})}function b(e){var t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate();return n<10&&(n="0"+n),a<10&&(a="0"+a),t+"-"+a+"-"+n}function k(e){var t=e.getHours(),a=e.getMinutes();return t<10&&(t="0"+t),a<10&&(a="0"+a),t+":"+a}function D(e){for(var t=0;t<c.length;t++){var a=c[t];if(e==a.eId)return a}return null}function p(e){var t=b(e.start),a=b(e.end),n=k(e.start),r=k(e.end);if(D(e.view.calendar.el.id)){const i=e.view.calendar.el.querySelector(".eventLink");i.querySelectorAll("[data-pass_document_id]").forEach((e=>{e.getAttribute("data-pass_document_id")||e.setAttribute("data-pass_document_id","")})),l.default.setDataPassValues({start_date:t,end_date:a,start_time:n,end_time:r}),l.default.setLinkProcess(i)}}function w(e){let t=e||document;if(t.querySelectorAll){var a=t.querySelectorAll("[data-calendar_id][data-btn_type]");0===a.length&&t!=document&&t.hasAttribute("data-btn_type")&&t.hasAttribute("data-calendar_id")&&(a=[t]);for(var n=0;n<a.length;n++){var r=a[n];d.default.getInitialized(r)||(d.default.setInitialized(r),r.addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-btn_type");A(this.getAttribute("data-calendar_id"),t)})))}}}function C(e,t,a){return e}function A(e,t){if(e)for(var a=0;a<c.length;a++){var n=c[a];if(n.eId==e){var r=n.calendar;switch(t){case"dayGridDay":r.changeView("dayGridDay");break;case"dayGridWeek":r.changeView("dayGridWeek");break;case"dayGridMonth":r.changeView("dayGridMonth");break;case"resourceTimelineDay":r.changeView("resourceTimelineDay");break;case"resourceTimelineThreeDays":r.changeView("resourceTimelineThreeDays");break;case"resourceTimelineFiveDays":r.changeView("resourceTimelineFiveDays");break;case"timeGridWeek":r.changeView("timeGridWeek");break;case"timeGridDay":r.changeView("timeGridDay");break;case"listDay":r.changeView("listDay");break;case"listWeek":r.changeView("listWeek");break;case"listMonth":r.changeView("listMonth");break;case"listYear":r.changeView("listYear");break;case"timelineWeek":r.changeView("timelineWeek");break;case"today":r.today()}}}}r().listen("updateDocument",(function(e){!function(e){for(var t=e.collection,a=0;a<c.length;a++){var n=c[a];if(n.filter.collection==t){var r=n.calendar,i=[],d=r.getEventById(e.document_id);if(d){var l=d.start,o=d.end,s=b(l),u=k(l),f=b(o),_=k(o),m=d.allDay;d.backgroundColor,d.textColor;const t=e.data;for(var v in t){if(v==n.displayName){var y=t[v];d.setProp("title",y)}"start_date"==v&&(s=t[v]),"end_date"==v&&(f=t[v]),"start_time"==v&&(u=t[v]),"end_time"==v&&(_=t[v]),"allDay"===v&&(m=t[v])}f=C(f),d.setAllDay(m),d.setStart(s+"T"+u),d.setEnd(f+"T"+_)}else{let t=h(e.data,n.displayName);t&&(i.push(t),r.addEventSource(i))}}}}(e)})),r().listen("deleteDocument",(function(e){!function(e){const t=e.document_id;for(var a=0;a<c.length;a++){var n=c[a];n.filter.collection==e.collection&&v(n.calendar,t)}}(e)})),r().listen("readDocumentList",(function(e){!function(e){let t=i.default.getObjectByFilterId(c,e.element);t&&function(e,t){var a=new Array;t.data.forEach((function(t,n){var r={};const{bg_color:i,text_color:d}=_();r.id=t._id,r.title=m(t,e.displayName),r.textColor=d,r.backgroundColor=i,r.start=t.start_date,r.end=C(t.end_date,t.end_time,t.allDay),r.allDay=t.allDay,t.start_time&&(r.start+="T"+t.start_time),t.end_time&&(r.end+="T"+t.end_time),t.start_date&&t.end_date&&a.push(r)})),e.calendar.addEventSource(a)}(t,e)}(e)})),f(),w(),d.default.register("CoCreateCalendar",window,f),d.default.register("CoCreateCalendar_btn",window,w)}}]);