(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[4568],{5850:()=>{var e=[],t="cal-container";const a=["#09efc6","#09ef1a","#efec09","#ef8609","#ef6009","#b609ef","#ef0986","#09efec","#ecef09","#09a6ef","#076692","#c0b507","#c04807","#6b07c0","#72aeb5","#69811e","#8d2b23"],r=["#8c489f","#f610e5","#1013f6","#1079f6","#109ff6","#49f610","#10f679","#f61013","#1310f6","#f65910","#f8996c","#3f4af8","#3fb7f8","#94f83f","#8d514a","#fff","#72d4dc"];function n(a){let r=a||document;if(!r.querySelectorAll)return;let n=r.querySelectorAll(".cal-container");0==n.length&&r!=document&&r.hasAttribute(t)&&(n=[r]);for(var i=0;i<n.length;i++){var d=n[i],l=d.id;if(!l)continue;var c=d.getAttribute("data-calendar_id"),u=d.getAttribute("data-dispaly_field");let t=CoCreate.filter.setFilter(d,"data-calendar_id","calendar");if(t&&!CoCreateInit.getInitialized(d)){CoCreateInit.setInitialized(d);var f=new FullCalendar.Calendar(d,{plugins:["interaction","dayGrid","timeGrid","resourceTimeline","timeline","list"],height:"100%",editable:!0,timeZone:"local",eventResizableFromStart:!0,eventLimit:!0,selectable:!0,selectMirror:!0,nowIndicator:!0,selectMinDistance:100,header:{left:"prev,",center:"title",right:"next"},defaultView:"dayGridMonth",eventClick:function(e){o(e)},eventResize:function(e){s(e)},eventDrop:function(e){s(e)},select:function(e){m(e)}});f.render();var _={eId:l,calendar_id:c,calendar:f,displayName:u,filter:t};d.addEventListener("changeFilterInput",(function(e){_.filter.startIndex=0,CoCreate.filter.fetchData(_.filter)})),CoCreate.filter.fetchData(t),e.push(_)}}}function i(){var e=Math.floor(Math.random()*a.length);return{bg_color:a[e],text_color:r[e]}}function d(e,t){var a="";return e[t]&&t&&(a=e[t]),a}function l(e,t){var a=new Object;const{bg_color:r,text_color:n}=i();return a.id=e._id,a.title=d(e,t),a.textColor="black",a.backgroundColor=r,a.textColor=n,a.start=e.start_date,a.end=h(e.end_date,e.end_time,e.allDay),a.allDay=e.allDay,e.start_time&&(a.start+="T"+e.start_time),e.end_time&&(a.end+="T"+e.end_time),e.start_date&&e.end_date?a:null}function c(e,t){e.getEventById(t).remove()}function o(e){var t=e.event,a=t.id,r=t._calendar.el.querySelector(".eventLink");r.querySelectorAll("[data-pass_document_id]").forEach((e=>{e.getAttribute("data-pass_document_id")||e.setAttribute("data-pass_document_id",a)})),CoCreateLogic.initDataPassValues(),CoCreateLogic.setLinkProcess(r)}function s(e){var t=e.event,a=u(t.start),r=u(t.end),n=f(t.start),i=f(t.end),d=t._calendar.el.id,l=_(d);l&&CoCreate.crud.updateDocument({collection:l.filter.collection,element:d,metadata:"",document_id:t.id,data:{start_date:a,end_date:r,start_time:n,end_time:i}})}function u(e){var t=e.getFullYear(),a=e.getMonth()+1,r=e.getDate();return r<10&&(r="0"+r),a<10&&(a="0"+a),t+"-"+a+"-"+r}function f(e){var t=e.getHours(),a=e.getMinutes();return t<10&&(t="0"+t),a<10&&(a="0"+a),t+":"+a}function _(t){for(var a=0;a<e.length;a++){var r=e[a];if(t==r.eId)return r}return null}function m(e){var t=u(e.start),a=u(e.end),r=f(e.start),n=f(e.end);if(_(e.view.calendar.el.id)){const i=e.view.calendar.el.querySelector(".eventLink");i.querySelectorAll("[data-pass_document_id]").forEach((e=>{e.getAttribute("data-pass_document_id")||e.setAttribute("data-pass_document_id","")})),CoCreateLogic.setDataPassValues({start_date:t,end_date:a,start_time:r,end_time:n}),CoCreateLogic.setLinkProcess(i)}}function C(e){let t=e||document;if(t.querySelectorAll){var a=t.querySelectorAll("[data-calendar_id][data-btn_type]");0===a.length&&t!=document&&t.hasAttribute("data-btn_type")&&t.hasAttribute("data-calendar_id")&&(a=[t]);for(var r=0;r<a.length;r++){var n=a[r];CoCreateInit.getInitialized(n)||(CoCreateInit.setInitialized(n),n.addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-btn_type");v(this.getAttribute("data-calendar_id"),t)})))}}}function h(e,t,a){return e}function v(t,a){if(t)for(var r=0;r<e.length;r++){var n=e[r];if(n.eId==t){var i=n.calendar;switch(a){case"dayGridDay":i.changeView("dayGridDay");break;case"dayGridWeek":i.changeView("dayGridWeek");break;case"dayGridMonth":i.changeView("dayGridMonth");break;case"resourceTimelineDay":i.changeView("resourceTimelineDay");break;case"resourceTimelineThreeDays":i.changeView("resourceTimelineThreeDays");break;case"resourceTimelineFiveDays":i.changeView("resourceTimelineFiveDays");break;case"timeGridWeek":i.changeView("timeGridWeek");break;case"timeGridDay":i.changeView("timeGridDay");break;case"listDay":i.changeView("listDay");break;case"listWeek":i.changeView("listWeek");break;case"listMonth":i.changeView("listMonth");break;case"listYear":i.changeView("listYear");break;case"timelineWeek":i.changeView("timelineWeek");break;case"today":i.today()}}}}CoCreateSocket.listen("updateDocument",(function(t){!function(t){for(var a=t.collection,r=0;r<e.length;r++){var n=e[r];if(n.filter.collection==a){var i=n.calendar,d=[],c=i.getEventById(t.document_id);if(c){var o=c.start,s=c.end,_=u(o),m=f(o),C=u(s),v=f(s),g=c.allDay;c.backgroundColor,c.textColor;const e=t.data;for(var y in e){if(y==n.displayName){var b=e[y];c.setProp("title",b)}"start_date"==y&&(_=e[y]),"end_date"==y&&(C=e[y]),"start_time"==y&&(m=e[y]),"end_time"==y&&(v=e[y]),"allDay"===y&&(g=e[y])}C=h(C),c.setAllDay(g),c.setStart(_+"T"+m),c.setEnd(C+"T"+v)}else{let e=l(t.data,n.displayName);e&&(d.push(e),i.addEventSource(d))}}}}(t)})),CoCreateSocket.listen("deleteDocument",(function(t){!function(t){const a=t.document_id;for(var r=0;r<e.length;r++){var n=e[r];n.filter.collection==t.collection&&c(n.calendar,a)}}(t)})),CoCreateSocket.listen("readDocumentList",(function(t){!function(t){let a=CoCreate.filter.getObjectByFilterId(e,t.element);a&&function(e,t){var a=new Array;t.data.forEach((function(t,r){var n={};const{bg_color:l,text_color:c}=i();n.id=t._id,n.title=d(t,e.displayName),n.textColor=c,n.backgroundColor=l,n.start=t.start_date,n.end=h(t.end_date,t.end_time,t.allDay),n.allDay=t.allDay,t.start_time&&(n.start+="T"+t.start_time),t.end_time&&(n.end+="T"+t.end_time),t.start_date&&t.end_date&&a.push(n)})),e.calendar.addEventSource(a)}(a,t)}(t)})),n(),C(),CoCreateInit.register("CoCreateCalendar",window,n),CoCreateInit.register("CoCreateCalendar_btn",window,C)}}]);