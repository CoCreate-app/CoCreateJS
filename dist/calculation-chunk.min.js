(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[3574],{2458:(t,e,l)=>{"use strict";l.r(e),l.d(e,{default:()=>f});var a=l(366),n=l(4752),i=l(5611),u=l.n(i),r=l(9484),c=l(4454),s=l(2643),o={init:function(){this.initCalculationElements()},initCalculationElements:function(t){const e=t||document;if(!e.querySelectorAll)return;let l=e.querySelectorAll("[data-calculation]")||[];l=Array.from(l),e!=document&&e.hasAttribute("data-calculation")&&l.push(e);for(let t=0;t<l.length;t++){if(a.default.getInitialized(l[t],"calculation_init"))return;a.default.setInitialized(l[t],"calculation_init"),this.initCalculationElement(l[t])}},initCalculationElement:function(t){const e=this;let l=t.getAttribute("data-calculation"),a=this.getIds(l),n=[];for(let l=0;l<a.length;l++){let i=a[l],u=null;try{u=document.querySelector(i)}catch(t){u=null}if(u)u.addEventListener("input",(function(){e.setCalcationResult(t)})),u.addEventListener("CoCreateInput-setvalue",(function(){})),u.hasAttribute("data-calculation")&&u.addEventListener("changedCalcValue",(function(l){e.setCalcationResult(t)}));else{let t=this.__getOperatorSelector(i);t&&n.push(t)}}n.length>0&&document.addEventListener("changedCalcValue",(function(l){let a=!1;n.forEach((t=>{l.target.matches(t)&&(a=!0)})),a&&e.setCalcationResult(t)}))},__getOperatorSelector(t){let e=/SUM\(\s*([\w\W]+)\s*\)/g.exec(t);return e&&e[1]?e[1].trim():null},calculationSpecialOperator(t){let e=this,l=null,a=/SUM\(\s*([\w\W]+)\s*\)/g.exec(t);if(a){let n=a[1].trim();if(0==t.trim().indexOf("SUM")){let t=document.querySelectorAll(n);l=0,t.forEach((t=>{let a=e.__getElementValue(t);a=Number(a),Number.isNaN(a)||(l+=a)}))}}return l},setCalcationResult:function(t){let e=t.getAttribute("data-calculation"),l=this.replaceIdWithValue(e);if(l){let e=d(l);"INPUT"==t.tagName||"TEXTAREA"==t.tagName||"SELECT"==t.tagName?(t.value=e,u().isCRDT(t)?(t.value="",n.default.replaceText({collection:t.getAttribute("data-collection"),document_id:t.getAttribute("data-document_id"),name:t.getAttribute("name"),value:e.toString()})):r.default.save(t),c.default&&c.default.update(t,t.value)):(t.innerHTML=e,s.default.save(t));var a=new CustomEvent("changedCalcValue",{bubbles:!0});t.dispatchEvent(a)}},__getElementValue:function(t){return"INPUT"==t.tagName||"TEXTAREA"==t.tagName||"SELECT"==t.tagName?t.value:t.innerHTML},replaceIdWithValue:function(t){let e=this.getIds(t);for(let l=0;l<e.length;l++){let a=e[l],n=null;try{n=document.querySelector(a)}catch(t){n=null}let i=null;i=n?Number(this.__getElementValue(n)):this.calculationSpecialOperator(a),null==i||Number.isNaN(i)||(t=t.replaceAll("{"+a+"}",i))}return t},getIds:function(t){let e=t,l=[];if(!e)return l;for(;e.length>0;){let t=e.indexOf("{"),a=e.indexOf("}",t);if(!(t>-1&&a>-1))return l;{let n=e.substring(t+1,a);-1==l.indexOf(n)&&l.push(n),e=e.substring(a+1)}}return l}};function d(t){let e,l,a,n;if(e=t.indexOf("+"),l=t.indexOf("-"),a=t.indexOf("*"),n=t.indexOf("/"),e>-1){let l=t.substr(0,e),a=t.substr(e+1);return d(l)+d(a)}if(l>-1){let e=t.substr(0,l),a=t.substr(l+1);return d(e)-d(a)}if(a>-1){let e=t.substr(0,a),l=t.substr(a+1);return d(e)*d(l)}if(n>-1){let e=t.substr(0,n),l=t.substr(n+1),a=d(e),i=d(l);return 0==i?0:a/i}{let e=Number(t);return isNaN(e)?0:e}}o.init(),a.default.init({name:"CoCreateCalculationChangeValue",observe:["attributes"],attributes:["value"],include:"input",callback:function(t){}}),a.default.init({name:"CoCreateCalculationInit",observe:["subtree","childList"],include:"[data-calculation]",callback:function(t){o.initCalculationElements(t.target)}});const f=o}}]);