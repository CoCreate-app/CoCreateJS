(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[93],{602:(e,t,n)=>{"use strict";n.d(t,{zO:()=>i,Ab:()=>s,BV:()=>l,LL:()=>c,i_:()=>r,sH:()=>o,fo:()=>a});const i="cocreate-select, div.select--field",s="input",l="selected",c="*",r="cc-option",o="cc-option",a='<span class="remove">x</span>'},2742:(e,t,n)=>{"use strict";n.r(t),n.d(t,{container:()=>r,default:()=>b,optionToSelected:()=>o,selectedToOption:()=>a});var i,s=n(366),l=n(602);function c(e){let t=e;for(;t.parentElement&&!t.matches(l.zO);)t=t.parentElement;return r.get(t)}i=e=>{return e.matches(`${l.LL} > ${l.i_}, ${t=l.zO,n=">"+l.i_,t.split(",").map((e=>e.trim()+n)).join(", ")}`);var t,n},Object.defineProperty(window.HTMLElement.prototype,"selected",{get:function(){if(i(this))return this.hasAttribute("selected")},set:function(e){if(i(this)){let t=c(this);e?(this.setAttribute("selected",""),t.selectOption(this,!1)):(this.removeAttribute("selected"),t.unselectOption(this))}}}),function(e){Object.defineProperty(window.HTMLElement.prototype,"options",{get:function(){if(e(this)&&r.has(this)){return r.get(this).getOptions()}}})}((e=>e.matches(l.zO))),function(e){Object.defineProperty(window.HTMLElement.prototype,"selectedOptions",{get:function(){if(e(this)&&r.has(this))return r.get(this).selectedContainer.children}})}((e=>e.matches(l.zO))),function(e){Object.defineProperty(window.HTMLElement.prototype,"selectedIndex",{get:function(){if(e(this)){let e=c(this),t=e.selectedContainer.children;if(t.length){let n=a.get(t[0]);return Array.prototype.indexOf.call(e.getOptions(),n)}return-1}},set:function(t){if(e(this)){let e=c(this);if(isFinite(t)){let n=e.getOptions()[t];e.selectOption(n,!1)}}}})}((e=>e.matches(l.zO)));const r=new Map,o=new Map,a=new Map,u=function(e){let t=(new DOMParser).parseFromString(e,"text/html");return t.head.children[0]?t.head.children[0]:t.body.children[0]}(l.fo);function d(e){this.init(e)}document.addEventListener("click",(function(e){let t=e.target;for(let[e,n]of r)e.contains(t)?t.matches(".remove")?n.unselectOption(t.parentNode):e.classList.contains("open")&&"INPUT"!==t.tagName?n.close():n.open():e.classList.contains("open")&&n.close()})),d.prototype={isMultiple:function(){return!!this.selectContainer.hasAttribute("multiple")},init:function(e){if(!e.matches(l.zO))return!1;if(e.querySelector(l.zO))return!1;if(r.has(e))return;this.selectContainer=e,this.selectedContainer=e.querySelector(`:scope > ${l.BV}`),this.selectedContainer||(this.selectedContainer=document.createElement(l.BV),e.prepend(this.selectedContainer)),this.input=e.querySelector(` :scope > ${l.Ab}`);e.children[e.children.length-1];for(let e of this.getOptions())e.hasAttribute("selected")&&this.selectOption(e);const t=this;this.input&&this.input.addEventListener("keydown",(function(e){let n=e.keyCode;if(13==n&&e.preventDefault(),13==n&&this.value.length>0)t.selectOption(this.value),this.value="";else if(8==n&&!this.value.length){let e=t.selectedContainer.children;if(!e.length)return;let n=a.get(e[e.length-1]);t.unselectOption(n)}})),this.selectContainer.addEventListener("click",(function(e){let n=e.target;for(;!n.matches(l.i_);)if(n=n.parentElement,!n)return;a.has(n)||o.has(n)||t.selectOption(n,!0)})),r.set(e,this)},open:function(){this.selectContainer.classList.add("open"),this.input&&this.input.focus(),this.selectContainer.dispatchEvent(new CustomEvent("CoCreateSelect-open"))},close:function(){this.input&&(this.input.value=""),this.selectContainer.classList.remove("open"),this.selectContainer.dispatchEvent(new CustomEvent("CoCreateSelect-close"))},getOptions:function(){return this.selectContainer.querySelectorAll(l.i_)},unselectAll:function(e){if(this.selectedContainer.children.length)for(let e of this.selectedContainer.children)a.has(e)&&this.unselectOption(a.get(e),!1);e&&this.__fireSelectedEvent({unselectOption:"all"})},getOptionCounterpart:function(e){return this.selectContainer.querySelector(`${l.i_.trim()}[value="${e}"]`)},isSelected:function(e){return this.selectedContainer.querySelector(`[value="${e}"]`)},validateSelect:function(){if(this.isMultiple()){let e=this.selectContainer.getAttribute("data-limit_option");if(e&&this.selectedContainer.children.length>=e)return}else this.selectedContainer.children.length&&this.unselectAll()},selectOption:function(e,t=!0,n,i=!0){if(!e)return;let s,c;if("string"==typeof e){if(this.isSelected(e))return;this.validateSelect();let r=this.getOptionCounterpart(e);if(r)return this.selectOption(r,t,n,i);s=document.createElement(l.sH),s.setAttribute("value",e),c=e,s.innerText=n||e,o.set(s,s),a.set(s,s)}else{if(c=e.getAttribute("value"),this.isSelected(c))return;this.validateSelect(),s=e.cloneNode(!0),e.setAttribute("selected",""),o.set(e,s),a.set(s,e)}s.appendChild(u.cloneNode(!0)),this.selectedContainer.appendChild(s),i&&this.__fireSelectedEvent({unselectOption:c})},unselectOption:function(e,t=!0){let n;"string"==typeof e?n=e:(a.has(e)&&(e=a.get(e)),e.removeAttribute("selected"),n=e.getAttribute("value"));let i=this.selectedContainer.querySelector(`[value="${n}"]`);i&&(o.delete(e),a.delete(i),i.remove(),t&&this.__fireSelectedEvent({unselectOption:n}))},__fireSelectedEvent:function(e){let t=new CustomEvent("input",{bubbles:!0,detail:e});Object.defineProperty(t,"target",{writable:!1,value:this.selectContainer}),this.selectContainer.dispatchEvent(t)}};const h={init:e=>new d(e)};var f=n(5611),p=n.n(f),m=n(8858),g=n(980),v=n.n(g);const C={init:function(){let e=document.querySelectorAll(l.zO);for(let t of e){let e=h.init(t),{name:n,document_id:i,collection:s}=p().getAttr(t);n&&i&&s&&this.read(t,e)}this.__initEvents()},__initEvents:function(){const e=this;document.addEventListener("dndsuccess",(function(e){const{dropedEl:t,dragedEl:n}=e.detail;t.matches(l.zO)&&r.get(t).__fireSelectedEvent({selectContainer:t})})),document.addEventListener("input",(function(t){let{name:n,document_id:i,is_realtime:s}=p().getAttr(t.target);t.target.matches(l.zO)&&("null"===i?v().send({broadcast_sender:!1,rooms:"",emit:{message:"select",data:{name:t.target.getAttribute("name"),values:e.getAllValue(t.target)}}}):s&&e.save(t.target))})),v().listen("select",(function(e){let{name:t,values:n}=e,i=document.querySelector(`[name="${t}"]`);if(!i||!r.has(i))return;let s=r.get(i);s.unselectAll(!1),n.forEach((e=>s.selectOption(e,!0,e,!1)))})),p().listen("updateDocument",(function(t){if("cocreate-select"==t.metadata)for(let n of Object.keys(t.data))e.writeSelect(t,n)}))},read:async function(e,t){let n=await p().read(e,!1),i=e.getAttribute("name"),s=n.data[i];s=Array.isArray(s)?s:[s],s.forEach((e=>t.selectOption(e,!0,void 0,!1)))},writeSelect:function(e,t){for(let[n,i]of r){let{name:s,document_id:l,collection:c,is_listen:r}=p().getAttr(n);if(r&&e.collection==c&&e.document_id==l&&t==s){if(e.data[s]){let t=e.data[s];t=Array.isArray(t)?t:[t],t.forEach((e=>i.selectOption(e,!0,void 0,!1)))}else""===e.data[s]&&i.unselectAll();break}}},getAllValue:function(e){return Array.from(e.selectedOptions).map((e=>a.has(e)?a.get(e).getAttribute("value"):""))},save:async function(e,t=!0){if(!t)return;let n=this.getAllValue(e);n=n.length<=1?n[0]:n,n=n||"";var i=[{element:e,value:n}];await p().save(i)}};m.default.init({name:"CoCreateSelect",callback:e=>{let t=e.querySelectorAll("cocreate-select");h.save(t)}});const O=C;O.init(),h.adapter=O,s.default.init({name:"CoCreateSelect",observe:["addedNodes"],callback:function(e){h.init(e.target)}}),m.default.init({name:"CoCreateSelect",selector:"cocreate-select",callback:function(e){O.save(e)}});const b=h}}]);