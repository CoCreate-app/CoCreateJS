(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[93],{166:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>r});var n=l(366);const c={init:function(){this.initElement()},initElement:function(e){const t=e||document;if(!t.querySelectorAll)return;let l=t.querySelectorAll("cocreate-select, div.select--field");for(let e=0;e<l.length;e++){let t=l[e];this.__initSelect(t)}},__initEvents:function(){const e=this;document.addEventListener("dndsuccess",(function(t){const{dropedEl:l,dragedEl:n}=t.detail;(void 0!==l.tagName&&"cocreate-select"==l.tagName.toLowerCase()||l.classList.contains("select--field"))&&(e.save(l),e.__fireSelectedEvent(l))}))},__initSelect:function(e){if(n.default.getInitialized(e,"cocreate-select"))return;n.default.setInitialized(e,"cocreate-select");let t=e.querySelector("input"),l=e.querySelector("ul.selectable--list");const c=this;t&&t.addEventListener("keydown",(function(t){let l=t.keyCode;if(13==l&&t.preventDefault(),13==l&&this.value.length>0)c.__selectValue(this.value,e),c.save(e),c.__fireSelectedEvent(e),this.value="";else if(8==l&&!this.value.length){let t=e.querySelectorAll("[selected]");t.length>0&&(t[t.length-1].remove(),c.save(e),c.__fireSelectedEvent(e))}})),document.addEventListener("click",(function(t){e.contains(t.target)||c.__closeDropDown(e)})),l.addEventListener("click",(function(t){if(!t.target.matches("li")){let l=t.target;for(;void 0!==l.tagName&&"li"!=l.tagName.toLowerCase();)l=l.parentNode;if(l.classList&&l.classList.contains("selectable")){let t=l.getAttribute("value"),n=c.getValue(e);if(t==n||n.indexOf(t)>-1)return;c.__selectItem(l,e),c.save(e),c.__fireSelectedEvent(e)}}})),e.addEventListener("click",(function(t){if(t.target.matches(".remove"))return t.target.parentNode.remove(),c.save(e),void c.__fireSelectedEvent(e);l.classList.contains("open")||c.__openDropDown(e);let n=e.querySelector("input");n&&n.focus()}),!0)},__openDropDown:function(e,t=!0){if(t){let t=e.querySelector("input");e.querySelector("ul.selectable--list");t&&(t.classList.add("open"),t.focus());let l=e.closest(".floating-label_field");l&&l.classList.add("active"),e.dispatchEvent(new CustomEvent("CoCreateSelect-open"))}},__closeDropDown:function(e){let t=e.querySelector("input"),l=e.querySelector("ul.selectable--list");t&&t.classList.contains("open")&&t.classList.remove("open");let n=t.value,c=e.closest(".floating-label_field");c.hasAttribute("active")||n&&0!=n.length||c.classList.remove("active"),l&&l.classList.contains("open")&&(l.classList.remove("open"),e.dispatchEvent(new CustomEvent("CoCreateSelect-close")))},setValue:function(e){const t=this;document.querySelectorAll("cocreate-select,.select--field").forEach((l=>{const n=l.getAttribute("data-collection")||"module_activity",c=l.getAttribute("data-document_id"),i=l.getAttribute("name");e.collection==n&&e.document_id==c&&i&&t.__renderValue(l,e.data[i])}))},renderValue:function(e,t){this.__renderValue(e,t)},__renderValue:function(e,t){if(!t)return;e.querySelectorAll("[selected]").forEach((e=>e.remove()));let l=e.querySelector("ul.selectable--list");t&&"string"==typeof t&&(t=[t]);for(let n=0;n<t.length;n++){const c=l.querySelector("li[value='"+t[n]+"']");c?this.__selectItem(c,e,!1):this.__selectValue(t[n],e,!1)}try{CoCreateFloatLabel&&CoCreateFloatLabel.update(e,t&&t.length>0)}catch(e){}},__selectValue:function(e,t){let l=this.getValue(t);if(l==e||l.indexOf(e)>-1)return;let n=t.querySelector("input"),c=t.querySelector("ul.selectable--list"),i=document.createElement("span");i.innerHTML="x",i.classList.add("remove");let a=document.createElement("li");a.setAttribute("value",e),a.innerHTML=e,a.setAttribute("selected",""),a.classList.remove("selectable"),a.appendChild(i),t.insertBefore(a,n||c)},__selectItem:function(e,t,l=!0){let n=t.hasAttribute("multiple")?"multiple":"single",c=t.querySelector("input"),i=t.querySelector("ul.selectable--list");if("single"==n){t.querySelectorAll("[selected]").forEach((e=>e.remove())),c&&(c.value="")}let a=document.createElement("span");a.innerHTML="x",a.classList.add("remove");let s=e.cloneNode(!0);s.setAttribute("selected",""),s.classList.remove("selectable"),s.appendChild(a),t.insertBefore(s,c||i),"single"==n&&this.__closeDropDown(t)},getValue:function(e){let t=e.hasAttribute("multiple")?"multiple":"single",l=e.querySelectorAll("[selected]"),n=[];return l.length>0&&l.forEach((e=>n.push(e.getAttribute("value")))),n="multiple"===t?n:n[0]||"",n},save:function(e){if(!e)return;let t=new CustomEvent("CoCreateSelect-save",{detail:{element:e}});document.dispatchEvent(t)},__fireSelectedEvent:function(e){e.dispatchEvent(new CustomEvent("selectedValue")),e.dispatchEvent(new CustomEvent("input",{bubbles:!0}));let t=this.getValue(e);document.dispatchEvent(new CustomEvent("CoCreate-selected",{detail:{element:e,value:t}}))}};var i=l(5611),a=l.n(i),s=l(8858);const o={init:function(){this.initElement(),this.__initEvents()},initElement:function(e){const t=e||document;if(!t.querySelectorAll)return;let l=t.querySelectorAll("cocreate-select, div.select--field");for(let e=0;e<l.length;e++)c.__initSelect(l[e]),this.__initElementEvent(l[e])},__initEvents:function(){const e=this;document.addEventListener("dndsuccess",(function(t){const{dropedEl:l,dragedEl:n}=t.detail;(void 0!==l.tagName&&"cocreate-select"==l.tagName.toLowerCase()||l.classList.contains("select--field"))&&(e.save(l),l.dispatchEvent(new CustomEvent("selectedValue")))})),document.addEventListener("CoCreateSelect-save",(function(t){const{detail:{element:l}}=t;l&&e.save(l)})),a().listen("readDocument",(function(e){"cocreate-select"==e.metadata&&c.setValue(e)})),a().listen("updateDocument",(function(e){"cocreate-select"==e.metadata&&c.setValue(e)})),document.addEventListener("CoCreate-selected",(function(e){const{detail:{element:t,value:l}}=e}))},__initElementEvent:function(e){const t=this;e.addEventListener("set-document_id",(function(){t.save(this)}));let l=e.getAttribute("data-collection")||"module_activity",n=e.getAttribute("data-document_id");l&&n&&a().readDocument({collection:l,document_id:n,metadata:"cocreate-select"})},__sendRequest:function(e){let t=e.getAttribute("data-collection")||"module_activity",l=e.getAttribute("data-document_id");t&&l&&a().readDocument({collection:t,document_id:l,metadata:"cocreate-select"})},save:function(e,t=!0){let l=c.getValue(e),n=e.getAttribute("data-collection")||"module_activity",i=e.getAttribute("data-document_id"),o=e.getAttribute("name"),r=e.getAttribute("data-realtime")||"true";o&&("true"==r||t)&&"false"!=e.getAttribute("data-save_value")&&(s.default.checkID(e)?i&&a().updateDocument({collection:n,document_id:i,data:{[o]:l},upsert:!0,metadata:"cocreate-select"}):(s.default.request({element:e,value:l,nameAttr:"name"}),e.setAttribute("data-document_id","pending")))}};o.init(),c.adapter=o,n.default.init({name:"CoCreateSelectAttributes",observe:["attributes"],attributes:["data-document_id"],include:"cocreate-select",callback:function(e){o.__sendRequest(e.target)}}),n.default.init({name:"CoCreateSelect",observe:["subtree","childList"],include:"cocreate-select",callback:function(e){o.initElement(e.target)}}),s.default.init({name:"CoCreateSelect",selector:"cocreate-select",callback:function(e){o.save(e)}});const r=c}}]);