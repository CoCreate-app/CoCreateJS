(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[560],{3501:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>K,initContainer:()=>G,initElement:()=>Z,initFunction:()=>U,initIframe:()=>Y});var n=i(4727),r=i(79);window.parent===window&&(window.addEventListener("load",(()=>{r.Z.listen("domEditor",(function(t){if(t.target&&(t.target=document.querySelector(`[data-element_id="${t.target}"]`)),t.value[1]&&(t.value[1]=document.querySelector(`[data-element_id="${t.value[1]}"]`)),!t.target)return;if(!t.value[1])return;let[e,i]=t.value;t.target.insertAdjacentElement(e,i)})),r.Z.listen("dndNewElement",(function(t){try{if(t.path.length){let e=document.querySelector(t.path[0]),i=e.contentWindow.document||e.contentDocument;t.target=i.querySelector(`[data-element_id=${t.target}]`)}else t.target=document.querySelector(`[data-element_id=${t.target}]`);if(t.value[1]=n.default.parseTextToHtml(t.value[1]),t.hiddenAttribute)for(let[e,i]of Object.entries(t.hiddenAttribute))t.value[1].setHiddenAttribute(e,i);let[e,i]=t.value;t.target.insertAdjacentElement(e,i)}catch(t){}}))})),window.addEventListener("dndsuccess",(t=>{let{dropedEl:e,dragedEl:i,position:o,dropType:s,path:a}=t.detail;if(i.ownerDocument!==e.ownerDocument?window.iframes.guests.canvas.window.CoCreate:window.CoCreate,e.getAttribute("data-element_id")||e.setAttribute("data-element_id",n.default.UUID()),e=e.getAttribute("data-element_id"),"data-cloneable"===s){let t=i.getAllHiddenAttribute();i=i.outerHTML,r.Z.send({broadcast_sender:!1,rooms:"",emit:{message:"dndNewElement",data:{target:e,method:"insertAdjacentElement",value:[o,i],path:a,hiddenAttribute:t}}})}else i.getAttribute("data-element_id")||i.setAttribute("data-element_id",n.default.UUID()),i=i.getAttribute("data-element_id"),r.Z.send({broadcast_sender:!0,rooms:"",emit:{message:"domEditor",data:{target:e,method:"insertAdjacentElement",value:[o,i]}}})})));var o=i(366);function s(t){t.querySelectorAll(".sortable").forEach((t=>{G({target:t})})),t.querySelectorAll(".cloneable").forEach((t=>{G({target:t,cloneable:!0})}))}i(4247);const a="data-droppable",d="data-exclude",l="data-draggable",c="data-cloneable",u="data-handle",h="data-group_name";let p=[];let f,m=window;for(;m!==window.parent;)m=window.parent;function g(t,e){return t.tagName||(t=t.parentElement),f.getContext(t,e)}function b(t,e){return t.tagName||(t=t.parentElement),f.getContexts(t,e)}function w(t){for(t.tagName||(t=t.parentElement);;){let e=t.getAttribute(h);if(e)return[t,e];if(!(t=t.parentElement))return[null,void 0]}}m.dndContext?f=m.dndContext:(f=new function(t){this.map=new Map,this.checkInitFunction=function(t,e){for(let i of p)if(i.target.contains(t)){let n=i.onDnd(t,e);if(Array.isArray(n))return n}},this.getContext=function(t,e){do{if("true"==t.getAnyAttribute(e))return t;if(this.checkInitFunction(t,[e]))return t;t=t.parentElement}while(t)},this.getContexts=function(t,e){do{for(let i of e){if("true"==t.getAnyAttribute(i))return[t,i];{let i=this.checkInitFunction(t,e);if(Array.isArray(i)&&e.includes(i[1]))return i}}t=t.parentElement}while(t)},this.setContext=function(t,e,i){t.setHiddenAttribute(e,i)}},m.dndContext=f);function y(t,e,i){this.effectCb,e.removeAttribute("CoC-dragging"),this.start=()=>{this.cloneEl=e.cloneNode(!0);let{width:t,height:n}=i.window.getComputedStyle(e);window.getComputedStyle(this.cloneEl);this.wrapper=document.createElement("div"),this.wrapper.style.height=n,this.wrapper.style.width=t,this.wrapper.append(this.cloneEl),this.wrapper.style.display="none",i.document.body.append(this.wrapper),this.wrapper.style.pointerEvents="none",this.wrapper.id="ghostEffect"},this.draw=(e,i)=>{this.wrapper.style.display="block";this.wrapper.getBoundingClientRect();let n,{marginTop:r,marginBottom:o,marginLeft:s,marginRight:a,width:d,height:l}=function(t,e){let i=window.getComputedStyle(t),n={};return e.forEach((t=>{n[t]=parseInt(i[t])})),n}(this.cloneEl,["marginTop","marginBottom","marginLeft","marginRight","width","height"]);n=i.frame?i.frame.getBoundingClientRect():{top:0,left:0},this.wrapper.style.top=n.top+e.y-t.offsetY+"px",this.wrapper.style.left=n.left+e.x-t.offsetX+"px"},this.hide=()=>{this.wrapper.remove()}}function A(t,e,i,n,r,o){var s,a,d=r-i,l=o-n,c=d*d+l*l,u=-1;0!=c&&(u=((t-i)*d+(e-n)*l)/c),u<0?(s=i,a=n):u>1?(s=r,a=o):(s=i+u*d,a=n+u*l);var h=t-s,p=e-a;return Math.sqrt(h*h+p*p)}function v(t,e){let i,n,r=1/0;for(let o of e){if(o.classList.contains("hidden"))continue;let[e,s]=C(t,o);s<r&&(r=s,i=o,n=e)}return[n,i]}let E=["left","top","right","bottom"];function C(t,e){let i,n=e.getBoundingClientRect(),r={p1:[n.top,n.left],p2:[n.bottom,n.left]},o={p1:[n.top,n.left],p2:[n.top,n.right]},s={p1:[n.top,n.right],p2:[n.bottom,n.right]},a={p1:[n.bottom,n.left],p2:[n.bottom,n.right]},d=[A(t[0],t[1],r.p1[1],r.p1[0],r.p2[1],r.p2[0]),A(t[0],t[1],o.p1[1],o.p1[0],o.p2[1],o.p2[0]),A(t[0],t[1],s.p1[1],s.p1[0],s.p2[1],s.p2[0]),A(t[0],t[1],a.p1[1],a.p1[0],a.p2[1],a.p2[0])],l=1/0;return d.forEach(((t,e)=>{t<l&&(l=t,i=E[e])})),[i,l]}function S(){this.listener={},this.on=function(t,e){Object.hasOwnProperty(t)||(this.listener[t]=[]),this.listener[t].push(e)},this.dispatch=function(t,e){this.listener.hasOwnProperty(t)&&this.listener[t].forEach((t=>t(e)))}}let x=["left","top"];i(5959);let M=new function(t){this.state=t,this.removeAttribute=(t,e)=>{this.state.has(t)&&delete this.state.get(t).attributes[e]},this.hasAttribute=(t,e)=>{if(this.state.has(t))return!!this.state.get(t).attributes[e]},this.getAttribute=(t,e)=>{if(this.state.has(t))return this.state.get(t).attributes[e]},this.setAttribute=(t,e,i)=>{this.state.has(t)?this.state.get(t).attributes[e]=i:this.state.set(t,{element:t,attributes:{[e]:i}})},this.getAllAttributes=t=>{if(this.state.has(t))return this.state.get(t).attributes},this.getDataset=t=>{let e={};for(let[i,n]of Object.entries(this.state.get(t).attributes))i.beginsWith("data-")&&(e[i.substr(5)]=n);return e}}(new Map);function k(t,e=M){let i=t.HTMLElement.prototype;if(i.setHiddenAttribute)return;let n=i.setAttribute;i.setAttribute=function(t,e){n.apply(this,[t,e])},i.setHiddenAttribute=function(t,i){e.setAttribute(this,t,i)},i.getHiddenAttribute=function(t){return e.getAttribute(this,t)},i.getAllHiddenAttribute=function(t){return e.getAllAttributes(this)},i.getAnyAttribute=function(t){return this.hasAttribute(t)?this.getAttribute(t):e.hasAttribute(this,t)?e.getAttribute(this,t):void 0},i.setAnyAttribute=function(t,i){this.setAttribute(t,i),e.setAttribute(this,t,i)},i.removeAnyAttribute=function(t){this.removeAnyAttribute(t),e.removeAttribute(this,t)},i.hasAnyAttribute=function(t,i){return this.hasAttribute(t)||e.hasAttribute(this,t)},i.hideAttribute=function(t){if(this.hasAttribute(t)){if(e.hasAttribute(this,t))return!1;e.setAttribute(this,t,this.getAttribute(t)),this.removeAttribute(t)}},i.unhideAttribute=function(t){if(e.hasAttribute(this,t)){if(this.hasAttribute(t))return!1;this.setAttribute(t,e.getAttribute(this,t)),e.removeAttribute(this,t)}}}window.domContext=M,function(){let t=Array.from(window.frames);t.unshift(window);for(let e of t)k(e.window)}();const D={register:k,domContext:M};let H,L,T,B,O;let _,q,I={scroller:new function({speed:t,threshold:e}){this.lastScrollingElement,this.onElement,this.mouse,this.speed,this.interval,this.isActive,this.update=function(t,e){this.mouse={x:t,y:e}},this.calculateScroll=function({x:i,y:n,element:r,onMouseScrollMove:o}){for(;!(r&&r.tagName&&(r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth))&&r.parentElement;)r=r.parentElement;let s=r.scrollWidth>r.clientWidth,a=r.scrollHeight>r.clientHeight,d=r.clientWidth/e,l=r.clientHeight/e,[c,u]=[];if(a?[c,u]=function(t,e){let i,n=e.getBoundingClientRect(),r={p1:[0,n.left],p2:[0,n.right]},o={p1:[e.clientHeight,n.left],p2:[e.clientHeight,n.right]},s=[A(t[0],t[1],r.p1[1],r.p1[0],r.p2[1],r.p2[0]),A(t[0],t[1],o.p1[1],o.p1[0],o.p2[1],o.p2[0])],a=1/0;return s.forEach(((t,e)=>{t<a&&(a=t,i=["top","bottom"][e])})),[i,a]}([i,n],r):s&&([c,u]=function(t,e){let i,n=e.getBoundingClientRect(),r={p1:[n.top,0],p2:[n.bottom,0]},o={p1:[n.top,e.clientWidth],p2:[n.bottom,e.clientWidth]},s=[A(t[0],t[1],r.p1[1],r.p1[0],r.p2[1],r.p2[0]),A(t[0],t[1],o.p1[1],o.p1[0],o.p2[1],o.p2[0])],a=1/0;return s.forEach(((t,e)=>{t<a&&(a=t,i=["left","right"][e])})),[i,a]}([i,n],r)),c){let e;switch(c){case"top":case"bottom":this.speed=l/(u+1)*t,e=u<l;break;case"left":case"right":this.speed=d/(u+1)*t,e=u<d}e?this.isActive?this.isActive&&this.lastScrollingElement!==r&&(this.deactivateScroll(r),this.__activateScroll(r,c,o)):(this.isActive=!0,this.__activateScroll(r,c,o)):this.isActive&&(this.isActive=!1,this.deactivateScroll(r))}},this.__activateScroll=function(t,e,i){t.style.scrollBehavior="auto",this.lastScrollingElement=t,this.interval=setInterval((()=>{switch(e){case"top":t.scrollBy(0,-this.speed);break;case"bottom":t.scrollBy(0,this.speed);break;case"left":t.scrollBy(-this.speed,0);break;case"right":t.scrollBy(this.speed,0)}}),10)},this.deactivateScroll=function(t){t&&(t.style.scrollBehavior=""),clearInterval(this.interval)}}({speed:4,threshold:3}),myDropMarker:new function(t){t=Object.assign({borderSize:2,dropMarkerMargin:5},t);let e=document.createElement("div");e.id="dropMarker",e.style.pointerEvents="none",this.lastOrigntaion=void 0,document.body.append(e),this.obj=e,this.draw=function(i,n,r,o,s){e.style.display="block";let a,d=n.getBoundingClientRect();switch(d.width||d.height||(d=i.getBoundingClientRect(),r="top"),r){case"top":case"bottom":e.style.height=t.borderSize+"px",e.style.width=d.width+"px";break;case"left":case"right":e.style.width=t.borderSize+"px",e.style.height=d.height+"px";break;default:throw new Error("one type of orientation must be specified")}if(i!=n){let e=i.getBoundingClientRect()[r],n=d[r];Math.abs(e-n)<2*t.dropMarkerMargin&&(o=!0)}switch(a=s.frame?s.frame.getBoundingClientRect():{top:0,left:0},e.style.transition="top,left 0.2s ease-in-out",r){case"top":e.style.top=a.top+d.top-t.borderSize/2+window.scrollY+(o?t.dropMarkerMargin:-t.dropMarkerMargin)+"px",e.style.left=a.left+d.left-t.borderSize/2+window.scrollX+"px";break;case"bottom":e.style.top=a.top+d.bottom-t.borderSize/2+window.scrollY+(o?-t.dropMarkerMargin:t.dropMarkerMargin)+"px",e.style.left=a.left+d.left-t.borderSize/2+window.scrollX+"px";break;case"left":e.style.top=a.top+d.top-t.borderSize/2+window.scrollY+"px",e.style.left=a.left+d.left-t.borderSize/2+window.scrollX+(o?t.dropMarkerMargin:-t.dropMarkerMargin)+"px";break;case"right":e.style.top=a.top+d.top-t.borderSize/2+window.scrollY+"px",e.style.left=a.left+d.right-t.borderSize/2+window.scrollX+(o?-t.dropMarkerMargin:t.dropMarkerMargin)+"px";break;default:throw new Error("one type of orientation must be specified")}this.lastOrigntaion=r},this.hide=function(t){e.style.display="none"}}},{myDropMarker:W,scroller:R}=I,N=new function(t){this.dragedEl,this.dropedEl,this.position,this.id,this.type;let e=new S;this.on=function(){e.on.apply(e,arguments)},this.dragStart=(t,i,n,r,o)=>{this.id=n,this.dropType=o,this.dragedEl=i,e.dispatch("dragStart",{e:t,el:i,ref:r})},this.dragEnd=(i,r)=>{try{if(this.dragedEl&&this.dragedEl.removeAttribute("CoC-dragging"),this.position){if(this.dropedEl===this.dragedEl)throw"dnd cancelled. you can't dnd on the same element.";if(this.dragedEl.contains(this.dropedEl))throw"dnd cancelled, you can't dnd from parent to its children.";let e,i=n.default.getElementPath(this.dropedEl),r={position:this.position,dragedEl:this.dragedEl,dropedEl:this.dropedEl,dropType:this.dropType,path:i};t&&(e=t(r)),Object.assign(r,e);const o=new CustomEvent("dndsuccess",{bubbles:!1,detail:r});r.dropedEl,r.position,r.dragedEl;this.dropedEl.insertAdjacentElement(this.position,this.dragedEl),window.dispatchEvent(o,{bubbles:!1})}}catch(i){}finally{this.type&&(this.position=null),e.dispatch("dragEnd",{e:i,ref:r})}},this.dragOver=(t,i,n)=>{if(this.dragedEl&&this.dragedEl.setAttribute("CoC-dragging",!0),0===i.children.length){let[r,o]=v([t.x,t.y],[i]);e.dispatch("dragOver",{e:t,el:i,closestEl:o,orientation:r,hasChild:!0,ref:n}),this.position=x.includes(r)?"afterbegin":"beforeend",this.dropedEl=i,this.type="normal"}else{let[r,o]=v([t.x,t.y],i.children);if("true"==o.getAttribute("data-exclude")){this.dropedEl=o.parentElement;let[e,i]=v([t.x,t.y],[this.dropedEl]);r=e}else this.dropedEl=o;e.dispatch("dragOver",{e:t,el:i,closestEl:o,orientation:r,hasChild:!1,ref:n}),this.position=x.includes(r)?"beforebegin":"afterend",this.type="children"}}}((function(){return L?L.apply(null,arguments):{}}));N.on("dragStart",(t=>{W.hide(),_=new y(t.e,t.el,{window,document}),_.start()})),N.on("dragEnd",(t=>{W.hide(),_&&_.hide(t.ref)})),N.on("dragOver",(t=>{W.draw(t.el,t.closestEl,t.orientation,!!t.hasChild,t.ref)}));let j=!1;function z(t,e){let i=b(t.target,[l,c,u]);if(!Array.isArray(i))return;let[n,r]=i;switch(r){case c:let t=n.getAttribute("data-insert-html");if(t){if(n=function(t){let e=(new DOMParser).parseFromString(t,"text/html");return e.head.children[0]?e.head.children[0]:e.body.children[0]}(t),!n)return}else n=n.cloneNode(!0);break;case l:if(n.getAnyAttribute(u))return;break;default:n=g(n,l)}let o=w(n);q=o[1],e.document.body.style.cursor="crosshair !important",j=!0,N.dragStart(t,n,null,e,r)}function F(t,e){e.document.body.style.cursor="",j=!1,N.dragEnd(t),W.hide(),R.deactivateScroll()}function P({x:t,y:e,target:i,isTouch:n},r,o){if(!j)return;if(_&&_.draw({x:t,y:e},r),R.update(t,e),j){let[t,e]=w(i);if(q&&e){if(q!==e)for(;;){let n=w(t);if(!n[0])return;if(t=n[0].parentElement,e=n[1],q===e){i=n[0];break}}}else if(q!==e)return}else _&&_.hide();if(!i)return;let s=g(i,a);s&&(o||R.calculateScroll({x:t,y:e,element:s.parentElement,onMouseScrollMove:t=>P(t,r,!0)}),N.dragOver({x:t,y:e,target:s},s,r))}O=(t,e)=>{1==t.which&&z(t,e)},B=(t,e)=>{1==t.which&&F(t,e)},T=(t,e)=>{P(t,e)};let X=new Map;const Y=({isIframe:t,frame:e,document:i,window:n})=>{let r,o,s,a,d,u,h;if(t){let t=e.contentWindow,i=t.document||e.contentDocument,n=e.getBoundingClientRect();r={x:n.left,y:n.top,frame:e,window:t,document:i,isIframe:!0}}else r={x:0,y:0,window:n,document:i,isIframe:!1};if(D.register(r.window),!r.window.CoCreateDnd||!r.window.CoCreateDnd.hasInit){if(!r.document.querySelector("#dnd-style")){let t=r.document.createElement("style");t.id="dnd-style",t.innerHTML='    /* dnd specic */\n      [data-draggable="true"], [data-cloneable="true"]  {\n        touch-action: none;\n      }\n      /* dnd specic */',r.document.head.append(t)}r.document.addEventListener("dragstart",(t=>(t.preventDefault(),!1))),r.document.addEventListener("selectstart",(t=>{let e=b(t.target,[l,c]);Array.isArray(e)&&t.preventDefault()}),{passive:!1}),X.has(r.window)?({mousemovee:o,mouseupe:s,mousedowne:a,touchmovee:d,touchheade:u,touchstarte:h}=X.get(r.window)):(h=function(t){H&&clearTimeout(H),H=setTimeout((()=>{r.document.body.style.touchAction="none",t.preventDefault(),z(t,r)}),1e3)},u=function(t){r.document.body.style.touchAction="auto",j?(t.preventDefault(),F(t,r)):H&&clearTimeout(H)},d=function(t){if(!j)return void(H&&clearTimeout(H));t.preventDefault();let e=t.touches[0],i=e.clientX,n=e.clientY,o=r.document.elementFromPoint(i,n);o&&P({x:i,y:n,target:o,isTouch:!0},r)},a=function(t){O.apply(this,[t,r])},s=function(t){B.apply(this,[t,r])},o=function(t){T.apply(this,[t,r])},X.set(r.window,{mousemovee:o,mouseupe:s,mousedowne:a,touchmovee:d,touchheade:u,touchstarte:h})),r.document.removeEventListener("touchstart",h),r.document.addEventListener("touchstart",h),r.document.removeEventListener("touchend",u,{passive:!1}),r.document.addEventListener("touchend",u,{passive:!1}),r.document.removeEventListener("touchmove",d,{passive:!1}),r.document.addEventListener("touchmove",d,{passive:!1}),r.document.removeEventListener("mousedown",a),r.document.addEventListener("mousedown",a),r.document.removeEventListener("mouseup",s),r.document.addEventListener("mouseup",s),r.document.removeEventListener("mousemove",o),r.document.addEventListener("mousemove",o)}};window.addEventListener("load",(()=>{window.parent===window&&(Y({document,window}),o.default.init({name:"dnd-config",observe:["childList"],include:".sortable, .cloneable",callback:t=>{s(t.target.parentElement.parentElement)}}),s(document))}));const U=function({target:t,onDnd:e,onDndSuccess:i}){"function"==typeof i&&(L=i),p.push({target:t,onDnd:e})},Z=function({target:t,dropable:e,draggable:i,cloneable:n,handle:r,group:o,exclude:s,beforeDndSuccess:u}){try{if("function"==typeof u&&(L=u),o&&t.setHiddenAttribute(h,o),s)try{t.querySelectorAll(s).forEach((t=>{t.setHiddenAttribute(d,"true")}))}catch(t){if(t instanceof HTMLElement){}throw t}e&&t.querySelectorAll(e).forEach((t=>{t.setHiddenAttribute(a,"true")})),i&&t.querySelectorAll(i).forEach((t=>{t.setHiddenAttribute(l,"true")})),n&&t.querySelectorAll(n).forEach((t=>{t.setHiddenAttribute(c,"true")}))}catch(t){if(t instanceof DOMException){throw t}throw t}};function $(t,e){t.children.length&&Array.from(t.children).forEach((t=>{$(t),t.setHiddenAttribute(d,"true"),t.setHiddenAttribute(l,"true"),e&&t.setHiddenAttribute(c,"true")}))}const G=function({target:t,cloneable:e=!1,nested:i=!1,handle:n,group:r,exclude:o}){if(r&&t.setHiddenAttribute(h,r),o)try{t.querySelectorAll(o).forEach((t=>{t.setHiddenAttribute(d,"true")}))}catch(t){if(t instanceof DOMException){throw"Dnd Sortable: exclude must be valid selector"}throw t}if(!t.tagName){throw"Dnd Sortable: Please provide a valid element"}if("boolean"!=typeof e){throw"Dnd Sortable: please provide valid data type for cloneable"}if("boolean"!=typeof i){throw"Dnd Sortable: please provide valid data type for nested"}i?$(t,e):(t.setHiddenAttribute(a,"true"),t.children.length&&Array.from(t.children).forEach((t=>{e?t.setHiddenAttribute(c,"true"):t.setHiddenAttribute(l,"true");try{let e=t.querySelectorAll(n);n&&e.length&&(t.setHiddenAttribute(l,"true"),e.forEach((t=>{t.setHiddenAttribute(l,"true")})))}catch(t){if(t instanceof DOMException){throw"Dnd Sortable: handle must be a valid selector"}throw t}})))};let J={initContainer:G,initElement:Z,initFunction:U};const K={initIframe:Y,init:function(t){let{mode:e}=t;if(delete t.mode,!["function","element","container"].includes(e))throw new Error("invalid mode provided");let i="init"+e.charAt(0).toUpperCase()+e.slice(1);J[i].apply(null,[t])}}},4247:()=>{window.addEventListener("load",(()=>{let t={host:{document,window},guests:{}};window.iframes=t;let e=document.getElementsByTagName("iframe"),i=1;for(let n of e){let e=n.id||"iframe"+i++;t.guests[e]={frame:n,document:n.contentDocument,window:n.contentWindow},n.contentWindow.iframes=t}new MutationObserver((function(e,n){for(let n of e)if("childList"===n.type)for(let e of n.addedNodes)if("IFRAME"===e.tagName){let n=e.id||"iframe"+i++;t.guests[n]={frame:e,document:e.contentDocument,window:e.contentWindow},e.contentWindow.iframes=t}})).observe(document.body,{attributes:!0,childList:!0,subtree:!0})}))},5959:()=>{let t=null,e=null;document.addEventListener("mousedown",(i=>{1===i.which&&(t=i.target,e=(new Date).getTime())})),document.addEventListener("mouseup",(i=>{let n=(new Date).getTime();if(t==i.target&&n<e+500){const t=new CustomEvent("CoCreateClickLeft",{bubbles:!0});i.target.dispatchEvent(t)}}))}}]);