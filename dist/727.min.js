(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[727],{727:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>h});var i=a(58295),n=a(70874),r=a(66749),l=a.n(r);const o={items:[],ioInstance:null,moduleAttribues:[],module_items:[],__init:function(){this.__initIntesection(),this.__initSocket(),this.__initEvents()},__initIntesection:function(){const t=this;this.ioInstance=new IntersectionObserver(((e,a)=>{e.forEach((e=>{if(e.isIntersecting){const a=t.__getMainAttribue(e.target);a.id&&document.dispatchEvent(new CustomEvent("CoCreateFilter-loadMore",{detail:{attrName:a.name,attrId:a.id}})),t.ioInstance.unobserve(e.target)}}))}),{threshold:1})},__runLoadMore:function(t,e){if(!e||!t)return;let a=this.items.find((a=>a.attrName===t&&a.id===e));a&&a.count>0&&this.fetchData(a)},__getMainAttribue:function(t){const e=this.moduleAttribues.find((e=>""!==(t.getAttribute(e)||"")));return e?{name:e,id:t.getAttribute(e)}:{}},__initSocket:function(){const t=this;l().listen("readDocumentList",(function(e){let a=e.element,i=t.items.find((t=>t.id===a));if(i){const a=e.data;let n=document.querySelector(`[${i.attrName}="${i.id}"][data-fetch_type="scroll"]`);a.length>0&&n&&t.ioInstance.observe(n);const r=e.operator.total,l=document.querySelectorAll(`[${i.attrName}="${i.id}"][data-fetch_type="total"]`);l&&l.forEach((t=>t.innerHTML=r))}}))},__initEvents:function(){const t=this;document.addEventListener("CoCreateFilter-loadMore",(function(e){const a=e.detail.attrId,i=e.detail.attrName;t.__runLoadMore(i,a)})),document.querySelectorAll('[data-fetch_type="loadmore"]').forEach((e=>{e.addEventListener("click",(function(a){a.preventDefault();const i=t.__getMainAttribue(e);i.id&&t.__runLoadMore(i.attrName,i.attrId)}))}))},setFilter:function(t,e,a){if(!e)return;let i=t.getAttribute(e);if(!i)return;this.moduleAttribues.includes(e)||this.moduleAttribues.push(e);let n=t.getAttribute("data-fetch_collection"),r="collection"==t.getAttribute("data-fetch_value_type"),l=t.getAttribute("data-order_by"),o=t.getAttribute("data-order_type")||"asc",s=parseInt(t.getAttribute("data-fetch_count")),c={el:t,id:i,eId:i,type:a,attrName:e,collection:n,startIndex:0,options:{},fetch:{},is_collection:r,search:{type:"or",value:[]},orders:[],filters:[]};return!isNaN(s)&&s>0&&(c.count=s),l&&c.orders.push({name:l,type:"asc"==o?1:-1}),this._initFilter(c,i,e),this._initOrder(c,i,e),this.items.push(c),this._initInputForm(c,e),this._initExportImport(c,i,e),c},_initFilter:function(t,e,a){let i=t.el.getRootNode().querySelectorAll("["+a+'="'+e+'"]');for(var n=0;n<i.length;n++){let r=i[n],l=r.getAttribute("data-filter_name"),o=r.getAttribute("data-filter_operator")?r.getAttribute("data-filter_operator"):"$contain",s=r.getAttribute("data-filter_value_type")?r.getAttribute("data-filter_value_type"):"string",c=r.getAttribute("data-filter_type"),u=r.getAttribute("data-filter_value");if(null!=u)if("raw"!==s&&(u=u.replace(/\s/g,"").split(",")),l){let e=this.getFilterByName(t,l,o);if("string"!=s)for(let t=0;t<u.length;t++)u[t]=Number(u[t]);this.insertArrayObject(t.filters,e,{name:l,value:u,operator:o,type:c})}else t.search.value=this._makeSearchOption(e,a)}},_initOrder:function(t,e,a){let i=t.el.getRootNode().querySelectorAll("["+a+'="'+e+'"]');const n=this;for(var r=0;r<i.length;r++){let e=i[r],a=e.getAttribute("data-order_by"),l=e.getAttribute("value");a&&l&&(["A","BUTTON"].includes(e.tagName)?e.addEventListener("click",(function(){let e=this.getAttribute("data-order_by"),a=this.getAttribute("value");n._applyOrder(t,e,a),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))})):this._applyOrder(t,a,l))}this._initToggleOrderEvent(t,e,a)},_initToggleOrderEvent:function(t,e,a){let i=document.querySelectorAll(`[${a}="${e}"][data-toggle_order]`);const n=this;i.forEach((e=>{e.addEventListener("click",(function(){let a=this.getAttribute("data-toggle_order")||"",r=this.getAttribute("data-order_by");a="asc"===a?"desc":"asc";for(let t=0;t<i.length;t++)i[t]!==e&&i[t].setAttribute("data-toggle_order","");t.orders=[],n._applyOrder(t,r,a),e.setAttribute("data-toggle_order",a),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))}))}))},_initExportImport:function(t,e,a){let i=document.querySelector(`[data-export_type][${a}="${e}"]`),n=document.querySelector(`[data-import="true"][${a}="${e}"]`);const r=this;i&&i.addEventListener("click",(function(){if(!t)return;let e=r.makeFetchOptions(t);e.export={collection:e.collection,type:i.getAttribute("data-export_type")||"json"},l().readDocumentList(e)})),n&&n.addEventListener("click",(function(){var e=document.createElement("input");if(e.type="file",!t)return;let a=t.collection;e.onchange=t=>{var e=t.target.files[0];l().importCollection({collection:a,file:e})},e.click()}))},_applyOrder:function(t,e,a){if(!a)return;let i=0,n=this.getOrderByName(t,e);i="asc"==a?1:"desc"==a?-1:[],this.insertArrayObject(t.orders,n,{name:e,type:i},i)},changeCollection:function(t){let e=t.el.getAttribute("data-fetch_collection");t.collection=e,t.startIndex=0},_makeSearchOption:function(t,e){let a=document.querySelectorAll("form["+e+"="+t+"]"),i="["+e+"="+t+"]",n=document.querySelectorAll("input"+i+",textarea"+i+", select"+i),r=[];for(let t=0;t<a.length;t++){let e=a[t].querySelectorAll("input, textarea, select");e=Array.prototype.slice.call(e),r=r.concat(e)}n=Array.prototype.slice.call(n),r=r.concat(n);let l=[];for(var o=0;o<r.length;o++){let t=r[o].getAttribute("data-filter_name"),e=r[o].getAttribute("data-order_by"),a=r[o],i=a.getAttribute("data-value_type")?a.getAttribute("data-value_type"):"string",n=null;t||e||("checkbox"!=a.type||a.checked?(n=a.value,"string"!=i&&(n=Number(n)),n&&!l.includes(n)&&l.push(n)):n=null)}return l},_initInputForm:function(t,e){if(!t)return;let a="["+e+'="'+t.id+'"]',i=t.el.getRootNode().querySelectorAll("form"+a+" input, form"+a+" textarea, form"+a+" select"),n=t.el.getRootNode().querySelectorAll("input"+a+",textarea"+a+", select"+a);this.setCheckboxName(t.id,e),i=Array.prototype.slice.call(i),n=Array.prototype.slice.call(n),i=i.concat(n);for(let e=0;e<i.length;e++){let a=i[e];a.getAttribute("data-order_by")?this._initOrderInput(t,a):this._initFilterInput(t,a,t.id)}},_initOrderInput:function(t,e){var a=this;e.addEventListener("change",(function(e){e.preventDefault();let i=this.getAttribute("data-order_by"),n=0,r=a.getOrderByName(t,i);n="asc"==this.value?1:"desc"==this.value?-1:[],a.insertArrayObject(t.orders,r,{name:i,type:n},n),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))}))},_initFilterInput:function(t,e,a){var i,n=this;e.addEventListener("input",(function(r){r.preventDefault();let l=this.getAttribute("data-filter_name"),o=this.getAttribute("data-filter_operator")||"$contain",s=this.getAttribute("data-filter_type"),c=this.getAttribute("data-filter_value_type")||"string";clearTimeout(i),i=setTimeout((function(){if(l){let a=n.getFilterByName(t,l,o),d=e.type,_=[];if("checkbox"==d)for(var i=document.querySelectorAll("input[name="+e.name+"]:checked"),r=0;r<i.length;r++)_.push(i[r].value);else if("raido"==d);else if("range"==d)_=[Number(e.min),Number(e.value)];else{var u=e.value;"string"!=c&&(u=Number(u)),"none"!=u&&(_=[u]),"raw"===c&&(_=u)}n.insertArrayObject(t.filters,a,{name:l,value:_,operator:o,type:s})}else t.search.value=n._makeSearchOption(a,t.attrName);t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"filter"}}))}),500)}))},setCheckboxName:function(t,e){for(var a=document.querySelectorAll("form["+e+'="'+t+'"]'),i=0;i<a.length;i++)for(var n=a[i].querySelectorAll("input[type=checkbox], form input[type=radio]"),r=0;r<n.length;r++){var l=n[r].getAttribute("name"),o=n[r].getAttribute("data-filter_name");!l&&o&&n[r].setAttribute("name","_"+t+"-"+o+"_"+i)}},getFilterByName:function(t,e,a){for(var i=0;i<t.filters.length;i++){var n=t.filters[i];if(n.name==e&&n.operator==a)return i}return-1},insertArrayObject:function(t,e,a,i){return i||(i=a.value),"object"==typeof i&&0==i.length?-1!=e&&t.splice(e,1):-1!=e?t[e]=a:t.push(a),t},getOrderByName:function(t,e){for(var a=0;a<t.orders.length;a++)if(t.orders[a].name==e)return a;return-1},defineEvent:function(t){t.el.addEventListener("fetchFilterData",(function(t){}))},fetchData:function(t){let e=this.makeFetchOptions(t);l().readDocumentList(e)},getObjectByFilterId:function(t,e){for(var a=0;a<t.length;a++){let i=t[a].filter;if(i&&i.id==e)return t[a]}},getObjectByElement:function(t,e){for(var a=0;a<t.length;a++){let i=t[a].filter;if(i&&i.el.isSameNode(e))return t[a]}},makeFetchOptions:function(t){let e={collection:t.collection,element:t.eId,metadata:{isRefresh:t.isRefresh},operator:{filters:t.filters,orders:t.orders,search:t.search,startIndex:t.startIndex},is_collection:t.is_collection};return t.count&&(e.operator.count=t.count),e},init:function({name:t,attribute:e,callback:a}){let i=document.querySelectorAll(`[data-fetch_collection][${e}]`);const n=this;i.forEach((a=>{n.__initFilterElement(a,e,t)})),l().listen("readDocumentList",(function(t){a.call(null,t)}))},__initFilterElement:function(t,e,a){let i=t.getAttribute(e);const n=this;if(!i)return;let r=this.setFilter(t,e,a);r&&(this.module_items.push({el:t,filter:r,id:i,name:a}),t.addEventListener("changeFilterInput",(function(t){n.fetchData(r)})),this.fetchData(r))}};o.__init();const s=o;var c=a(53339);const u={mainInfo:{},init:function(){const t=this;l().listen("updateDocument",(function(e){t.render(e)})),l().listen("readDocument",(function(e){t.render(e)})),l().listen("connect",(function(e){t.__getRequest()}))},initElement:function(t){const e=this.__getRequest(t);e&&e.forEach((t=>{l().readDocument({collection:t.collection,document_id:t.document_id})}))},render:function(t){const e=t.collection,a=t.document_id;for(let i in t.data){const n=this.__makeKey(e,a,i),r=t.data[i];this.mainInfo[n]&&this.mainInfo[n].forEach((t=>{t.el.setAttribute(t.attr,r),t.el.dispatchEvent(new CustomEvent("CoCreateAttribute-run",{eventType:"rendered",item:t.el}))}))}},setValue:function(t,e){},__getRequest:function(t){let e=t||document,a=e.querySelectorAll("[fetch-for]"),i=this,n=[];return 0===a.length&&e!=document&&e.hasAttributes("fetch-for")&&(a=[e]),a.forEach((t=>{const e=t.getAttribute("data-collection"),a=t.getAttribute("data-document_id"),r=t.getAttribute("name"),l=t.getAttribute("value"),o=t.attributes;for(let s=0;s<o.length;s++){let c=i.__jsonParse(o[s].value);if(c){let u=c.collection||e,d=c.document_id||a,_=c.name||r,f=c.value||l;if(c["data-pass_id"]){let t=i.__checkPassId(c["data-pass_id"]);t?(u=t.collection,d=t.document_id,f=t.value):(u=null,d=null,f=null)}const m=i.__makeKey(u,d,_);u&&d&&_&&(i.mainInfo[m]||(i.mainInfo[m]=[]),i.mainInfo[m].push({el:t,attr:o[s].name}),n.some((t=>t.collection===u&&t.document_id===d))||n.push({collection:u,document_id:d}))}}})),n},__jsonParse:function(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e?e:null}catch(t){return null}},__checkPassId:function(t){var e=localStorage.getItem("dataParams");if(!(e=JSON.parse(e))||0==e.length)return null;for(var a=0;a<e.length;a++)if(e[a].pass_to==t)return{collection:e[a].collection,document_id:e[a].document_id,value:e[a].value};return null},__makeKey:function(t,e,a){return`${t}_${e}_${a}`}};u.init(),i.default.init({name:"CoCreateAttributes",observe:["subtree","childList"],include:"[data-for]",callback:function(t){u.initElement(t.target)}});const d={attributes:u,init:function(){this.__initKeys(),this.__initPassSessionIds(),this.__initPassParams(),this.__initPassValueParams(),this.__initGetValueInput(),this.initAtagElement()},__initKeys:function(){window.localStorage.getItem("apiKey")&&(config.apiKey=window.localStorage.getItem("apiKey")),window.localStorage.getItem("securityKey")&&(config.securityKey=window.localStorage.getItem("securityKey")),window.localStorage.getItem("organization_id")&&(config.organization_Id=window.localStorage.getItem("organization_id"))},__initPassSessionIds:function(){let t=window.localStorage.getItem("organization_id"),e=window.localStorage.getItem("user_id"),a=window.localStorage.getItem("adminUI_id"),i=window.localStorage.getItem("builderUI_id");this.__initPassItems(t,".sessionOrg_Id",!0),this.__initPassItems(e,".sessionUser_Id"),this.__initPassItems(a,".sessionAdminUI_Id"),this.__initPassItems(i,".sessionBuilderUI_Id")},initElement:function(t){const e=this;let a=t||document;if(!a.querySelectorAll)return;let n=a.querySelectorAll("[data-pass_id]");n=Array.from(n),a!=document&&a.hasAttribute("data-pass_id")&&n.push(a);let r=window.localStorage.getItem("dataParams");r=JSON.parse(r),r&&0!=r.length&&n.forEach((t=>{if(i.default.getInitialized(t))return;const a=t.getAttribute("data-pass_id"),n=r.find((t=>t.pass_to==a));if(!n)return;const{collection:l,document_id:o,pass_to:s,prefix:c}=n;i.default.setInitialized(t),"FORM"===t.tagName&&!t.getAttribute("data-colleciton")&&l&&t.setAttribute("data-colleciton",l),e.__setPassAttributes(t,n)}))},initAtagElement:function(){const t=this;document.addEventListener("click",(function(e){const a=e.target.closest("a, button");if(!a)return;if("modal"===a.getAttribute("target")&&a.getAttribute("data-pass_to"))return e.preventDefault(),void t.setLinkProcess(a);const i=a.getAttribute("href");if("modal"!==a.getAttribute("target")){if(a.hasAttribute("data-actions"))return;if(!t.passSubmitProcess(a))return;const n=a.getAttribute("data-pass_to");i?(e.preventDefault(),t.storePassData(a),t.openAnother(a)):(t.storePassData(a),n&&t.__initPassParams(n))}}))},__initPassParams:function(t){var e=window.localStorage.getItem("dataParams");if(!(e=JSON.parse(e))||0==e.length)return;let a=this;e.forEach((function(e){var i=e.collection,n=(e.document_id,e.prefix,e.pass_to);t&&n!=t||(document.querySelectorAll("form").forEach((t=>{var e=t.getAttribute("data-pass_id");e&&e==n&&i&&""!=i&&(t.getAttribute("data-collection")||t.setAttribute("data-collection",i))})),document.querySelectorAll("[data-pass_id]").forEach((t=>{var i=t.getAttribute("data-pass_id");i&&i==n&&a.__setPassAttributes(t,e)})))}))},__initPassValueParams:function(t){var e=window.localStorage.getItem("valueParams");(e=JSON.parse(e))&&0!=e.length&&e.forEach((function(e){var a=e.pass_value_to;(t||document).querySelectorAll("[data-pass_value_id]").forEach((t=>{let i=t.getAttribute("data-pass_value_id");i&&i==a&&(["INPUT","TEXTAREA","SELECT"].includes(t.tagName)?(t.value=e.value,CoCreate.floatingLabel&&CoCreate.floatingLabel.update(t)):t.innerHTML=e.value)}))}))},__getPassAttributes:function(t){return{collection:t.getAttribute("data-pass_collection")||t.getAttribute("data-pass_fetch_collection"),document_id:t.getAttribute("data-pass_document_id"),name:t.getAttribute("data-pass_name"),value:t.getAttribute("data-pass_value"),pass_to:t.getAttribute("data-pass_to"),filter_name:t.getAttribute("data-pass_filter_name"),filter_value:t.getAttribute("data-pass_filter_value"),prefix:t.getAttribute("data-pass_prefix")||""}},__setPassAttributes:function(t,e){const{collection:a,document_id:i,name:n,value:r,pass_to:l,filter_name:o,filter_value:s,prefix:c}=e,u=t.getAttribute("data-pass_id"),d=!!t.hasAttribute("data-pass_refresh");u==l&&(a&&(this.__setAttributeValueOfElement(t,"data-collection",a,d),this.__setAttributeValueOfElement(t,"data-fetch_collection",a,d),this.__setAttributeValueOfElement(t,"data-pass_fetch_collection",a,d),this.__setAttributeValueOfElement(t,"data-pass_collection",a,d)),i&&(this.__setAttributeValueOfElement(t,"data-document_id",i,d),this.__setAttributeValueOfElement(t,"data-fetch_document_id",i,d),this.__setAttributeValueOfElement(t,"data-pass_fetch_document_id",i,d),this.__setAttributeValueOfElement(t,"data-pass_document_id",i,d)),n&&(this.__setAttributeValueOfElement(t,"name",n,d),this.__setAttributeValueOfElement(t,"data-fetch_name",n,d),this.__setAttributeValueOfElement(t,"data-pass_name",n,d)),r&&(this.__setAttributeValueOfElement(t,"value",r,d),this.__setAttributeValueOfElement(t,"data-pass_value",r,d)),c&&(this.__setAttributeValueOfElement(t,"name",c+t.getAttribute("name"),d,!0),this.__setAttributeValueOfElement(t,"data-fetch_name",c+t.getAttribute("data-fetch_name"),d,!0),this.__setAttributeValueOfElement(t,"data-pass_prefix",c,d)),o&&(this.__setAttributeValueOfElement(t,"data-filter_name",o,d),this.__setAttributeValueOfElement(t,"data-pass_filter_name",o,d)),s&&(this.__setAttributeValueOfElement(t,"data-filter_value",s,d),this.__setAttributeValueOfElement(t,"data-pass_filter_value",s,d)))},__setAttributeValueOfElement:function(t,e,a,i,n){if(a){if(t.hasAttribute(e)&&n)return void t.setAttribute(e,a);if(t.hasAttribute(e)&&(!t.getAttribute(e)||i))return void t.setAttribute(e,a)}},storePassData:function(t){let e=[];const a=this;let i=this.__getPassAttributes(t);t.hasAttribute("data-actions")||(i.pass_to&&e.push(i),t.querySelectorAll("[data-pass_to]").forEach((t=>{let i=a.__getPassAttributes(t);i.pass_to&&e.push(i)})),e.length>0&&localStorage.setItem("dataParams",JSON.stringify(e)))},__initValuePassBtns:function(){},__initGetValueInput:function(){var t=document.querySelectorAll("input, textarea");let e=this;for(var a=0;a<t.length;a++){var i=t[a];i.id&&(i.addEventListener("input",(function(t){e.__setGetValueProcess(this.id,this.value)})),i.addEventListener("updated_by_fetch",(function(t){e.__setGetValueProcess(this.id,this.value)})))}},__registerValuePassBtnEvent:function(t,e){},passProcessAction:function(t){let e=t.closest("form");if(!e)return;let a=e.querySelectorAll("input, textarea, select"),i=[];a.forEach((t=>{const e=t.getAttribute("data-pass_value_to"),a=t.value;e&&i.push({pass_value_to:e,value:a})})),i.length>0&&window.localStorage.setItem("valueParams",JSON.stringify(i)),this.__initPassValueParams(),document.dispatchEvent(new CustomEvent("passValueActionEnd",{detail:{}}))},setDataPassValues:function(t){const e=[];for(let a in t)e.push({pass_value_to:a,value:t[a]});e.length>0&&window.localStorage.setItem("valueParams",JSON.stringify(e))},initDataPassValues:function(){window.localStorage.removeItem("valueParams")},openAnother:function(t){var e=t.getAttribute("href"),a=t.getAttribute("target");"_blank"==a?window.open(e,"_blank"):"_window"==a?window.open(e,"_blank","location=yes,height=570,width=520,scrollbars=yes,status=yes"):window.open(e,"_self")},setLinkProcess:function(t){if(t.hasAttribute("data-actions"))return;const e=t.getAttribute("data-pass_to"),a=t.getAttribute("href");this.storePassData(t),this.checkOpenCocreateModal(t)?void 0!==CoCreate.modal&&CoCreate.modal.open(t):a?this.openAnother(t):e&&this.__initPassParams(e)},checkOpenCocreateModal:function(t){return"modal"===t.getAttribute("target")},passSubmitProcess:function(t){return!t.parentNode.classList.contains("submitBtn")||!(!t.getAttribute("data-pass_to")||!t.getAttribute("data-pass_document_id"))},__setGetValueProcess:function(t,e){t&&document.querySelectorAll('[data-get_value="'+t+'"]').forEach((t=>{if(void 0!==t.value?t.value=e:void 0!==t.textContent&&(t.textContent=e),CoCreate.floatingLabel&&CoCreate.floatingLabel.update(t),t.dispatchEvent(new Event("input",{bubbles:!0})),t.classList.contains("searchInput")){let e=new KeyboardEvent("keydown",{keyCode:13});t.dispatchEvent(e)}}))},__initPassItems:function(t,e,a){const i=this;if(t){document.querySelectorAll(e).forEach((e=>{i.__setAttributeValueOfElement(e,"data-document_id",t),i.__setAttributeValueOfElement(e,"data-filter_value",t)}))}}};d.init(),i.default.init({name:"CoCreateAttributes",observe:["subtree","childList"],include:"[data-for]",callback:function(t){d.attributes.initElement(t.target)}}),i.default.init({name:"CoCreateLogic",observe:["subtree","childList"],include:"[data-pass_id]",callback:function(t){d.initElement(t.target)}}),c.Z.init({action:"passValueAction",endEvent:"passValueActionEnd",callback:(t,e)=>{d.passProcessAction(t)}});const _=d,f={__getValueFromObject:function(t,e){try{if(void 0===t||!e)return!1;let a=t,i=e.split(".");for(let t=0;t<i.length;t++)if(a=a[i[t]],!a)return!1;return a}catch(t){return!1}},__getValue:function(t,e){let a=/{{\s*([\w\W]+)\s*}}/g.exec(e);return!!a&&this.__getValueFromObject(t,a[1].trim())},__createObject:function(t,e){try{if(!e)return t;let i=e.split("."),n=t;for(var a=i.length-1;a>=0;a--)n={[i[a]]:n};return n}catch(t){return!1}},__replaceValue:function(t,e){let a=!1,i=this,n=null,r=e.match(/{{([A-Za-z0-9_.,\- ]*)}}/g);return r&&(r.forEach((n=>{let r=i.__getValue(t,n);r&&"object"!=typeof r&&(a=!0,e=e.replace(n,r))})),a&&(n=e)),n},setArray:function(t,e){const a=t.getAttribute("data-render_array")||"data",i=t.getAttribute("data-render_key")||a,n=this,r=this.__getValueFromObject(e,a);a&&Array.isArray(r)&&r.forEach(((e,r)=>{let l=t.cloneNode(!0);l.classList.remove("template"),l.classList.add("clone_"+a),"object"!=typeof e?e={"--":e}:e.index=r;let o=n.__createObject(e,i);n.setValue([l],o),t.insertAdjacentHTML("beforebegin",l.outerHTML)}))},setValue:function(t,e,a,i){if(!e)return;const n=this;Array.from(t).forEach((t=>{let i=t.getAttribute("data-pass_id");if(!a||i==a){if(Array.from(t.attributes).forEach((a=>{let i=a.name.toLowerCase(),r=a.value;if(r=n.__replaceValue(e,r),r){if("value"==i){switch(t.tagName.toLowerCase()){case"input":t.setAttribute(i,r);break;case"textarea":t.setAttribute(i,r),t.textContent=r;break;default:0===t.children.length&&(t.innerHTML=r)}}t.setAttribute(i,r)}})),0==t.children.length&&t.textContent){let a=t.textContent;a=n.__replaceValue(e,a),a&&(t.textContent=a)}t.children.length>0&&(n.setValue(t.children,e),t.classList.contains("template")&&n.setArray(t,e))}}))},data:function({selector:t,data:e,elements:a,passTo:i}){t?this.render(t,e):a&&this.setValue(a,e,i)},render:function(t,e){let a=document.querySelector(t);a&&(Array.isArray(e)?(a.setAttribute("data-render_array","test"),this.setValue([a],{test:e})):this.setValue(a.children,e))}},m={selector:"[data-template_id][data-fetch_collection]",items:[],init:function(){this.initElement(),this.__initSocketEvent(),this.__initEvents()},initElement:function(t){let e=t||document;const a=this;if(!e.querySelectorAll)return;let i=e.querySelectorAll(this.selector);0==i.length&&e!=document&&e.hasAttribute("data-template_id")&&e.hasAttribute("data-fetch_collection")&&(i=[e]),i.forEach((t=>{a.__initEachElement(t,!0,!0)}))},refershElement:function(t){const{target:e}=t;e&&e.hasAttribute("data-fetch_collection")&&this.__initEachElement(e,!1,!1,!0)},reload:function(t){},__initSocketEvent:function(){const t=this;l().listen("readDocumentList",(function(e){t.__fetchedItem(e)})),l().listen("readCollectionList",(function(e){t.__fetchedItem(e)})),l().listen("createDocument",(function(e){t.__createItem(e)})),l().listen("deleteDocument",(function(e){t.__deleteItem(e)}))},__initEvents:function(){const t=this;window.addEventListener("dndsuccess",(function(e){const{dropedEl:a,dragedEl:i}=e.detail;let n=i.getAttribute("data-template_id"),r=document.querySelector(`[data-fetch_collection][data-template_id='${n}']`),l=t.findTemplateElByChild(a);r&&l&&(r.isSameNode(l)||(t.updateParentTemplateOfChild(l,i),t.reorderChildrenOfTemplate(r)),t.reorderChildrenOfTemplate(l))}))},__initEachElement:function(t,e,a,n){let r=t.getAttribute("data-template_id");if(!r)return;if(!t.getAttribute("data-fetch_collection"))return;if(i.default.getInitialized(t,"fetch")&&e)return;let l=s.getObjectByFilterId(this.items,r),o=null;const c=this;if(!e||!l){if(i.default.setInitialized(t,"fetch"),l)o=l.filter,s.changeCollection(o),n&&(l.filter.isRefresh=!0,c.__removeOldData(t),o.isRefresh=!0,o.startIndex=0);else{o=s.setFilter(t,"data-template_id","template");let e=t.getAttribute("data-fetch_value_type")||"string";if(!o)return;"collection"===e&&(o.is_collection=!0),l={el:t,filter:o,templateId:r,fetch_type:e},this.items.push(l),t.addEventListener("changeFilterInput",(function(t){c.__removeOldData(l.el),l.filter.startIndex=0,l.filter.isRefresh=!0,s.fetchData(l.filter)}))}s.fetchData(o)}},__runLoadMore:function(t){if(!t)return;let e=s.getObjectByFilterId(this.items,t);e&&e.filter.count>0&&s.fetchData(e.filter)},__removeOldData:function(t){let e=t.getAttribute("data-template_id");t.querySelectorAll("[templateId='"+e+"']").forEach((t=>t.remove()))},__cloneElement:function(t,e,a){let i=document.createElement(t.parentNode.tagName||"div"),n=t.cloneNode(!0);return n.setAttribute("templateId",e),a||(a="data"),n.getAttribute("data-render_array")||n.setAttribute("data-render_array",a),i.appendChild(n.cloneNode(!0)),i},__renderData:function(t,e,a="data"){let i=t.getAttribute("data-template_id"),n=t.querySelector(`.template[data-template_id='${i}'`);if(!n)return;let r=t.getAttribute("data-render_id"),l=t.getAttribute("data-pass_to"),o=r?{[r]:e}:e;a=a||"data",a=r?`${r}.${a}`:a;let s=this.__cloneElement(n,i,a);f.data({elements:s.children,data:o,passTo:l});let c=s.querySelector(`.template[data-template_id="${i}"]`);if(!c)return;c.remove(),n.insertAdjacentHTML("beforebegin",s.innerHTML);var u=new CustomEvent("fetchedTemplate",{bubbles:!0});t.dispatchEvent(u);let d=t.parentNode.getElementsByTagName("form");for(let t=0;t<d.length;t++){let e=d[t],a=e.querySelector(".passValueBtn");a&&_.__registerValuePassBtnEvent(e,a)}},__deleteItem:function(t){let e=t.collection,a=t.document_id;for(let t=0;t<this.items.length;t++){let r=this.items[t];if(r.filter.collection==e){var i=r.el.getAttribute("data-template_id"),n=r.el.querySelectorAll("[templateId='"+i+"'][data-document_id='"+a+"']");for(let t=0;t<n.length;t++)n[t].remove(),r.startIndex--}}},__fetchedItem:function(t){let e=t.element,a=s.getObjectByFilterId(this.items,e);if(a){a.filter.startIndex+=t.data.length;let e=a.el.getAttribute("data-fetch_name");e&&(t=t.data[0]),t&&(t.metadata&&t.metadata.isRefresh&&this.__removeOldData(a.el),this.__renderData(a.el,t,e))}},__createItem:function(t){let e=t.collection;const a=this;let i=t.data,n=t;n.data=[i],this.items.forEach((t=>{const{filter:r}=t;t.fetch_ids=[],r.collection===e&&!t.el.getAttribute("data-fetch_name")&&a.__checkItemByFilters(i,r.filters)&&a.__renderData(t.el,n)}))},findTemplateElByChild:function(t){return n.default.getParentFromElement(t,null,["data-template_id","data-fetch_collection"])},updateParentTemplateOfChild:function(t,e){const a=t.getAttribute("data-filter_name"),i=t.getAttribute("data-filter_value"),n=t.getAttribute("data-filter_operator");a&&"$eq"==n&&l().updateDocument({collection:t.getAttribute("data-fetch_collection"),document_id:e.getAttribute("data-document_id"),data:{[a]:i},broadcast:!1})},reorderChildrenOfTemplate:function(t){const e=t.getAttribute("data-order_by"),a=t.getAttribute("data-template_id");if(!e||!a)return;const i=t.querySelectorAll(`[data-template_id="${a}"][data-document_id]:not(.template)`),n="asc"!==t.getAttribute("data-order_type")?-1:1;i.forEach(((a,i)=>{a.classList.contains("template")||l().updateDocument({collection:t.getAttribute("data-fetch_collection"),document_id:a.getAttribute("data-document_id"),data:{[e]:i*n},broadcast:!1})}))},__checkItemByFilters:function(t,e){let a=!0;return!(!t||!e)&&(!Array.isArray(t)&&(e.forEach((({name:e,operator:i,type:n,value:r})=>{const l=t[e];if(a)switch(i){case"$contain":Array.isArray(l)&&l.some((t=>r.includes(t)))||(a=!1);break;case"$range":null!==r[0]&&null!==r[1]?(r[0]>l||r[1]<=l)&&(a=!1):(null==t.value[0]&&r[1]>=l||null==t.value[1]&&r[0]<=l)&&(a=!1);break;case"$eq":l!=r[0]&&(a=!1);break;case"$ne":null!=l&&l!=r[0]||(a=!1);break;case"$lt":l>=r[0]&&(a=!1);break;case"$lte":l>r[0]&&(a=!1);break;case"$gt":l<=r[0]&&(a=!1);break;case"$gte":l<r[0]&&(a=!1);break;case"$in":Array.isArray(l)&&l.some((t=>r.includes(t)))||(a=!1);break;case"$nin":Array.isArray(l)&&l.some((t=>r.includes(t)))&&(a=!1)}})),a))}};i.default.init({name:"CoCreateFetchObserver",observe:["attributes"],attributes:["data-fetch_collection","data-filter_name"],callback:function(t){m.refershElement(t)}}),i.default.init({name:"CoCreateFetchInit",observe:["subtree","childList"],include:"[data-fetch_collection]",callback:function(t){m.initElement(t.target)}}),m.init();const h=m}}]);