(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[1305],{2643:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var n=a(366),i=a(6515),r=(a(4727),a(5611)),o=a.n(r);const d={selector:"h1, h2, h3, h4, h5, h6, p, i, q, a, b, li, span, code, html, head, meta, style, body, header, div, div.domEditor, iframe, img, nav, navbar, sidenav, menu, main, section, article, aside, dialog, details, label, strong, quote, footer",init:function(){this.__initSocket(),this.initElement(document)},initElement:async function(e){const t=this.__getReqeust(e);if(t&&t.length>0)for(var a of t){var n=await o().readDocument({collection:a.collection,document_id:a.document_id,metadata:a.metadata});this.render(n)}},save:async function(e){if("object"==typeof e){const t=new CustomEvent("changed-element",{});e.dispatchEvent(t)}if(!e.classList.contains("domEditor"))return;let t="";t="IFRAME"===el.tagName?el.srcdoc:el.innerHTML;var a=[{element:e,value:t}];await o().save(a)},render:function(e,t){const a=this.__addAttributeSelectorTags(this.selector);let n=document.querySelectorAll(a),i=!1,r=!1;if(!e)return;let d=o().encodeObject(e.data);if(n.forEach((a=>{const{collection:n,document_id:c,name:l,is_read:s,is_update:u}=o().getAttr(a),m=(e.metadata,a.getAttribute("data-request_id"));if(s&&(!t||u)&&!(m&&e.metadata&&e.metadata.request_id!==m||e.collection!=n||e.document_id!=c||a.isContentEditable)){const e=d[l];if(null==e)return;if("IMG"===a.tagName)a.src=e;else if("IFRAME"===a.tagName){a.srcdoc=e;let t=a;r=!0,a.onload=function(e){t.removeAttribute("srcdoc");let a=new CustomEvent("CoCreateHtmlTags-rendered",{detail:{window:t.contentWindow}});window.parent.dispatchEvent(a)}}else if("DIV"===a.tagName){if(a.hasAttribute("value")&&a.setAttribute("value",e),a.classList.contains("domEditor"))if("replace"==a.getAttribute("data-domEditor")){let t=document.createElement("div");t.innerHTML=e;let n=a.parentNode;n&&(t.children[0]?n.replaceChild(t.children[0],a):n.replaceChild(t,a))}else a.innerHTML=e}else a.innerHTML=e,a.hasAttribute("value")&&a.setAttribute("value",e);if("HEAD"==a.tagName||"BODY"==a.tagName){a.removeAttribute("data-collection"),a.removeAttribute("data-document_id"),a.removeAttribute("data-pass_id");for(var h=a.querySelectorAll("script"),v=0;v<h.length;v++){var f=document.createElement("script");f.type="text/javascript";var b=h[v].getAttribute("src"),_=h[v].innerHTML;""!=_&&(f.innerHTML=_),b&&(f.src=b),a.appendChild(f),h[v].remove()}}i=!0}})),i){const t=new CustomEvent("CoCreateHtmlTags-rendered",{eventType:"rendered",detail:{data:e}});document.dispatchEvent(t)}if(r){const t=new CustomEvent("CoCreateHtmlTags-iframe-rendered",{eventType:"rendered",detail:{data:e}});document.dispatchEvent(t)}},__getReqeust:function(e){let t=e||document;if(!t.querySelectorAll)return;const a=this.__addAttributeSelectorTags(this.selector);let n=t.querySelectorAll(a),i=[];return 0==n.length&&t!=document&&t.hasAttribute("data-document_id")&&(n=[t]),n.forEach((e=>{if(e.hasAttribute("rendered"))return void e.removeAttribute("rendered");const{collection:t,document_id:a,is_read:n}=o().getAttr(e);n&&o().checkAttrValue(a)?i.push({collection:t,document_id:a,metadata:{}}):n&&o().checkAttrValue(a)&&!i.some((e=>e.collection===t&&e.document_id===a))&&i.push({collection:t,document_id:a})})),i},__initSocket:function(){const e=this;o().listen("updateDocument",(function(t){e.render(t,!0)}))},__addAttributeSelectorTags:function(e){return e.trim().split(/\s*,\s*/).map((function(e){return e+"[data-collection][data-document_id][name]"})).join(", ")}};d.init(),n.default.init({name:"CoCreateHtmlTags",observe:["addedNodes"],attributeFilter:["data-collection","data-document_id","name"],callback:function(e){let t=e.target;t.hasAttribute("data-collection")&&t.hasAttribute("data-document_id")&&t.hasAttribute("name")&&d.initElement(e.target)}}),i.default.init({action:"saveHtml",endEvent:"changed-element",callback:(e,t)=>{let a=e.closet("form");d.save(a)}});const c=d}}]);