(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[1305],{2643:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var i=n(366),a=n(6515),o=n(4727),d=n(5611),r=n.n(d);const c={selector:"h1, h2, h3, h4, h5, h6, p, i, q, a, b, li, span, code, html, head, meta, style, body, header, div, div.domEditor, iframe, img, nav, navbar, sidenav, menu, main, section, article, aside, dialog, details, label, strong, quote, footer",init:function(){this.__initAttribute(),this.__initSocket(),this.__initEvents(),this.initElement(document)},initElement:function(t){const e=this.__getReqeust(t);e&&e.length>0&&e.forEach((t=>{r().readDocument({collection:t.collection,document_id:t.document_id,metadata:t.metadata})}))},save:function(t,e,n){if("object"==typeof t){const e=new CustomEvent("changed-element",{});t.dispatchEvent(e)}if(!t.classList.contains("domEditor"))return;const{collection:i,document_id:a,name:o}=r().getAttr(t);let d=t.getAttribute("data-broadcast")||"true",c=t.getAttribute("data-namespace")||"",l=t.getAttribute("data-room")||"";d="true"===d,e||(e=d);let s="";s="IFRAME"===t.tagName?t.srcdoc:t.innerHTML,window.CoCreate.crdt?(window.CoCreateCrdt.init({collection:i,document_id:a,name:t}),window.CoCreate.crdt.replaceText({collection:i,document_id:a,name:o,value:s,updateCrud:!0,broadcast:e,broadcast_sender:n,upsert:!0})):r().updateDocument({namespace:c,room:l,collection:i,document_id:a,upsert:!0,broadcast_sender:n,data:{[o]:s},broadcast:e})},render:function(t,e){const n=this.__addAttributeSelectorTags(this.selector);let i=document.querySelectorAll(n),a=!1,o=!1;let d=r().encodeObject(t.data);if(i.forEach((n=>{const{collection:i,document_id:c,name:l}=r().getAttr(n),{is_read:s,is_update:u}=r().getFlagAttr(n),m=(t.metadata,n.getAttribute("data-request_id"));if(s&&(!e||u)&&!(m&&t.metadata&&t.metadata.request_id!==m||t.collection!=i||t.document_id!=c||n.isContentEditable)){const t=d[l];if(null==t)return;if("IMG"===n.tagName)n.src=t;else if("IFRAME"===n.tagName){n.srcdoc=t;let e=n;o=!0,n.onload=function(t){e.removeAttribute("srcdoc");let n=new CustomEvent("CoCreateHtmlTags-rendered",{detail:{window:e.contentWindow}});window.parent.dispatchEvent(n)}}else if("DIV"===n.tagName){if(n.hasAttribute("value")&&n.setAttribute("value",t),n.classList.contains("domEditor"))if("replace"==n.getAttribute("data-domEditor")){let e=document.createElement("div");e.innerHTML=t;let i=n.parentNode;i&&(e.children[0]?i.replaceChild(e.children[0],n):i.replaceChild(e,n))}else n.innerHTML=t}else n.innerHTML=t,n.hasAttribute("value")&&n.setAttribute("value",t);if("HEAD"==n.tagName||"BODY"==n.tagName){n.removeAttribute("data-collection"),n.removeAttribute("data-document_id"),n.removeAttribute("data-pass_id");for(var h=n.querySelectorAll("script"),_=0;_<h.length;_++){var f=document.createElement("script");f.type="text/javascript";var g=h[_].getAttribute("src"),b=h[_].innerHTML;""!=b&&(f.innerHTML=b),g&&(f.src=g),n.appendChild(f),h[_].remove()}}a=!0}})),a){const e=new CustomEvent("CoCreateHtmlTags-rendered",{eventType:"rendered",detail:{data:t}});document.dispatchEvent(e)}if(o){const e=new CustomEvent("CoCreateHtmlTags-iframe-rendered",{eventType:"rendered",detail:{data:t}});document.dispatchEvent(e)}},__getReqeust:function(t){let e=t||document;if(!e.querySelectorAll)return;const n=this.__addAttributeSelectorTags(this.selector);let a=e.querySelectorAll(n),o=[];return 0==a.length&&e!=document&&e.hasAttribute("data-document_id")&&(a=[e]),a.forEach((t=>{if(i.default.getInitialized(t,"htmltags"))return;const{collection:e,document_id:n}=r().getAttr(t),a=r().isReadAttr(t),d=t.getAttribute("data-request_id");if(a&&r().checkValue(n)&&d)return i.default.setInitialized(t,"htmltags"),void o.push({collection:e,document_id:n,metadata:{request_id:d}});a&&r().checkValue(n)&&!o.some((t=>t.collection===e&&t.document_id===n))&&o.push({collection:e,document_id:n})})),o},__initAttribute:function(t){const e=t||document;if(!e.querySelectorAll)return;const n=this.__addAttributeSelectorTags(this.selector);let i=e.querySelectorAll(n);0==i.length&&e!=document&&e.hasAttribute("data-document_id")&&(i=[e]),i.forEach((t=>{const{collection:e,document_id:n,name:i}=r().getAttr(t);e&&n&&i&&null==t.getAttribute("data-realtime")&&t.setAttribute("data-realtime",!0)}))},__initSocket:function(){const t=this;r().listen("updateDocument",(function(e){t.render(e,!0)})),r().listen("readDocument",(function(e){t.render(e)}))},__initEvents:function(){window.addEventListener("newCoCreateCssStyles",(function(t){const{isOnload:e,styleList:n}=t.detail;let i=document.querySelector("link[data-collection][data-document_id][name]");if(i){const{collection:t,document_id:e,name:a}=r().getAttr(i),{is_read:o,is_update:d}=r().getFlagAttr(i);d&&r().updateDocument({collection:t,document_id:e,upsert:!0,broadcast_sender:!1,data:{[a]:n},broadcast:!1})}}))},__addAttributeSelectorTags:function(t){return t.trim().split(/\s*,\s*/).map((function(t){return t+"[data-collection][data-document_id][name]"})).join(", ")},findElementByChild:function(t){return o.default.getParentFromElement(t,"domEditor")},__getValueFromJonDeep:function(t,e){try{if(void 0===t)return!1;let n=e.split("."),i=n.shift();return n.length>0?this.__getValueFromJonDeep(t[i],n.join(".")):t[i]}catch(t){return!1}}};c.init(),i.default.init({name:"CoCreateHtmlTags",observe:["subtree","childList"],include:"[data-collection][data-document_id][name]",callback:function(t){c.initElement(t.target)}}),a.default.init({action:"saveHtml",endEvent:"changed-element",callback:(t,e)=>{let n=t.closet("form");c.save(n)}});const l=c}}]);