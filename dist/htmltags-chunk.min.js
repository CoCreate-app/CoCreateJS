(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[1305],{2643:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>r});var n=a(366),i=a(6515),o=(a(4727),a(5611)),c=a.n(o);const d={selector:"h1, h2, h3, h4, h5, h6, p, i, q, a, b, li, span, code, html, head, meta, style, body, header, div, div.domEditor, iframe, img, nav, navbar, sidenav, menu, main, section, article, aside, dialog, details, label, strong, quote, footer",init:function(){this.__initSocket(),this.initElement(document)},initElement:async function(t){const e=this.__getReqeust(t);if(e&&e.length>0)for(var a of e){var n=await c().readDocument({collection:a.collection,document_id:a.document_id,metadata:a.metadata});this.render(n)}},save:async function(t){if("object"==typeof t){const e=new CustomEvent("changed-element",{});t.dispatchEvent(e)}if(!t.classList.contains("domEditor"))return;let e="";e="IFRAME"===el.tagName?el.srcdoc:el.innerHTML;var a=[{element:t,value:e}];await c().save(a)},render:function(t,e){const a=this.__addAttributeSelectorTags(this.selector);let n=document.querySelectorAll(a),i=!1,o=!1;let d=c().encodeObject(t.data);if(n.forEach((a=>{const{collection:n,document_id:r,name:l,is_read:s,is_update:u}=c().getAttr(a),m=(t.metadata,a.getAttribute("data-request_id"));if(s&&(!e||u)&&!(m&&t.metadata&&t.metadata.request_id!==m||t.collection!=n||t.document_id!=r||a.isContentEditable)){const t=d[l];if(null==t)return;if("IMG"===a.tagName)a.src=t;else if("IFRAME"===a.tagName){a.srcdoc=t;let e=a;o=!0,a.onload=function(t){e.removeAttribute("srcdoc");let a=new CustomEvent("CoCreateHtmlTags-rendered",{detail:{window:e.contentWindow}});window.parent.dispatchEvent(a)}}else if("DIV"===a.tagName){if(a.hasAttribute("value")&&a.setAttribute("value",t),a.classList.contains("domEditor"))if("replace"==a.getAttribute("data-domEditor")){let e=document.createElement("div");e.innerHTML=t;let n=a.parentNode;n&&(e.children[0]?n.replaceChild(e.children[0],a):n.replaceChild(e,a))}else a.innerHTML=t}else a.innerHTML=t,a.hasAttribute("value")&&a.setAttribute("value",t);if("HEAD"==a.tagName||"BODY"==a.tagName){a.removeAttribute("data-collection"),a.removeAttribute("data-document_id"),a.removeAttribute("data-pass_id");for(var h=a.querySelectorAll("script"),v=0;v<h.length;v++){var f=document.createElement("script");f.type="text/javascript";var _=h[v].getAttribute("src"),b=h[v].innerHTML;""!=b&&(f.innerHTML=b),_&&(f.src=_),a.appendChild(f),h[v].remove()}}i=!0}})),i){const e=new CustomEvent("CoCreateHtmlTags-rendered",{eventType:"rendered",detail:{data:t}});document.dispatchEvent(e)}if(o){const e=new CustomEvent("CoCreateHtmlTags-iframe-rendered",{eventType:"rendered",detail:{data:t}});document.dispatchEvent(e)}},__getReqeust:function(t){let e=t||document;if(!e.querySelectorAll)return;const a=this.__addAttributeSelectorTags(this.selector);let n=e.querySelectorAll(a),i=[];return 0==n.length&&e!=document&&e.hasAttribute("data-document_id")&&(n=[e]),n.forEach((t=>{const{collection:e,document_id:a,is_read:n}=c().getAttr(t);n&&c().checkAttrValue(a)?i.push({collection:e,document_id:a,metadata:{}}):n&&c().checkAttrValue(a)&&!i.some((t=>t.collection===e&&t.document_id===a))&&i.push({collection:e,document_id:a})})),i},__initSocket:function(){const t=this;c().listen("updateDocument",(function(e){t.render(e,!0)}))},__addAttributeSelectorTags:function(t){return t.trim().split(/\s*,\s*/).map((function(t){return t+"[data-collection][data-document_id][name]"})).join(", ")}};d.init(),n.default.init({name:"CoCreateHtmlTags",observe:["addedNodes"],attributeFilter:["data-collection","data-document_id","name"],callback:function(t){let e=t.target;e.hasAttribute("data-collection")&&e.hasAttribute("data-document_id")&&e.hasAttribute("name")&&d.initElement(t.target)}}),i.default.init({action:"saveHtml",endEvent:"changed-element",callback:(t,e)=>{let a=t.closet("form");d.save(a)}});const r=d}}]);