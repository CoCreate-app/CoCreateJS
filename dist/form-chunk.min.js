(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[4142],{8858:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>d});var c=a(366),n=a(5611),o=a.n(n),u=a(6515);const l={disableAutoFill:function(t){"TEXTAREA"==t.tagName&&(t.value="",t.setAttribute("autocomplete","off")),t.hasAttribute("autocomplete")||t.setAttribute("autocomplete","off")},setAttribute:function(t){const{collection:e,document_id:a,name:c}=o().getAttr(t),n=t.getAttribute("data-realtime"),u=t.getAttribute("data-flat");t.querySelectorAll("[name], [data-pass_to]").forEach((function(t){t.parentNode.classList.contains("template")||(null==t.getAttribute("data-realtime")&&n&&t.setAttribute("data-realtime",n),t.getAttribute("name")&&!t.hasAttribute("data-collection")&&e&&t.setAttribute("data-collection",e),t.getAttribute("data-pass_to")&&!t.hasAttribute("data-pass_collection")&&e&&t.setAttribute("data-pass_collection",e),t.getAttribute("name")&&!t.getAttribute("data-document_id")&&a&&t.setAttribute("data-document_id",a),t.hasAttribute("data-document_id")||null==a||t.setAttribute("data-document_id",a),t.hasAttribute("data-flat")||null==u||t.setAttribute("data-flat",u))}))},checkFormValidate:function(t){return void 0===CoCreate.unique||CoCreate.unique.checkValidate(t)},isTemplateInput:function(t){if(t.classList.contains("template"))return!0;let e=t.parentNode;for(;e;){if(e.classList&&e.classList.contains("template"))return!0;e=e.parentNode}return!1},getFormData:function(t,e,a){let c={};if(!a)return{};return t.querySelectorAll(`[name][data-collection='${a}']`).forEach((t=>{let a=t.getAttribute("data-document_id")||"",n=t.getAttribute("name"),o=t.value||t.getAttribute("value");"_id"!==n&&n&&o&&e==a&&(c[n]=t.value)})),c},getCOllections:function(t){let e=[];return t?(t.querySelectorAll("[name][data-collection]").forEach((t=>{let a=t.getAttribute("data-collection");a&&!e.includes(a)&&e.push(a)})),e):e}},i={requestAttr:"data-document_request",modules:[],init:function({name:t,selector:e,callback:a}){this.modules.push({name:t,callback:a})},checkID:function(t,e="data-document_id"){let a=t.getAttribute(e)||"";return!(""===a||!o().checkAttrValue(a))},initElement:function(t){const e=t||document;if(!e.querySelectorAll)return;let a=e.querySelectorAll("form");0===a.length&&e!=document&&"FORM"===e.tagName&&(a=[e]),a.forEach((t=>{l.setAttribute(t),l.disableAutoFill(t)}))},__init:function(){document.querySelectorAll("form").forEach((t=>{l.setAttribute(t)}))},__deleteDocumentAction:function(t){const{collection:e,document_id:a}=o().getAttr(t);o().checkAttrValue(e)&&o().checkAttrValue(a)&&(o().deleteDocument({collection:e,document_id:a,metadata:"deleteDocument-action"}),document.dispatchEvent(new CustomEvent("deletedDocument",{detail:{}})))},__deleteDocumentsAction:function(t){const{collection:e,document_id:a}=o().getAttr(t),c=t.getAttribute("data-document_target");if(!c)return;const n=document.querySelectorAll(c);o().checkAttrValue(e)&&(n.forEach((t=>{const a=t.getAttribute("data-document_id");o().checkAttrValue(a)&&o().deleteDocument({collection:e,document_id:a,metadata:""})})),document.dispatchEvent(new CustomEvent("deletedDocuments",{detail:{}})))},__createDocumentAction:function(t){const e=t.closest("form");l.getCOllections(e).forEach((t=>{let a=l.getFormData(e,"",t);0==Object.keys(a).length&&a.constructor===Object||o().checkAttrValue(t)&&(o().createDocument({collection:t,data:a,metadata:"createDocument-action",element:"empty"}),document.dispatchEvent(new CustomEvent("createdDocument",{detail:{}})))}))},__saveDocumentAction:async function(t){const e=t.closest("form");l.checkFormValidate(e)?(await this.__requestDocumentId(e),this.modules.forEach((({callback:t})=>{t.call(null,e)}))):alert("Values are not unique")},__requestDocumentId:async function(t){let e=this,a=t.querySelectorAll("[name], [data-pass_to]"),c=[];for(var n=0;n<a.length;n++){let u=a[n];if(u.parentNode.classList.contains("template"))continue;const l=u.getAttribute("data-collection")||u.getAttribute("data-pass_collection")||"";if(""!==l&&!c.includes(l)&&!e.checkID(u,"data-document_id")&&!e.checkID(u,"data-pass_document_id")){c.push(l);let e=await o().createDocument({collection:l,data:{},metadata:""});e&&this.setDocumentId(t,e)}}},setDocumentId:function(t,e){if(!e.document_id)return;let a=this;const c=e.collection,n=e.document_id;if(t&&n){t.querySelectorAll(`[data-collection=${c}], [data-pass_collection=${c}]`).forEach((function(t){t.hasAttribute("name")&&!a.checkID(t)&&t.setAttribute("data-document_id",n),t.hasAttribute("data-pass_to")&&!a.checkID(t,"data-pass_document_id")&&t.setAttribute("data-pass_document_id",n)}))}}};i.__init(),c.default.init({name:"CoCreateForm",observe:["addedNodes"],callback:t=>"FORM"===t.target.tagName&&i.initElement(t.target)}),u.default.init({action:"createDocument",endEvent:"createdDocument",callback:(t,e)=>{i.__createDocumentAction(t)}}),u.default.init({action:"deleteDocument",endEvent:"deletedDocument",callback:(t,e)=>{i.__deleteDocumentAction(t)}}),u.default.init({action:"deleteDocuments",endEvent:"deletedDocuments",callback:(t,e)=>{CoCreateDocument.__deleteDocumentsAction(t)}}),u.default.init({action:"saveDocument",endEvent:"savedDocument",callback:(t,e)=>{i.__saveDocumentAction(t)}});const d=i}}]);