(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[4142],{8858:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>m});var c=n(366),o=n(4727),a=n(5611),i=n.n(a),u=n(6515);const l={disableAutoFill:function(t){"TEXTAREA"==t.tagName&&(t.value="",t.setAttribute("autocomplete","off")),t.hasAttribute("autocomplete")||t.setAttribute("autocomplete","off")},setAttribute:function(t){const{collection:e,document_id:n,name:c}=i().getAttr(t),o=t.getAttribute("data-realtime"),a=t.getAttribute("data-flat");t.querySelectorAll("[name], [data-pass_to]").forEach((function(t){t.parentNode.classList.contains("template")||(null==t.getAttribute("data-realtime")&&o&&t.setAttribute("data-realtime",o),t.getAttribute("name")&&!t.hasAttribute("data-collection")&&e&&t.setAttribute("data-collection",e),t.getAttribute("data-pass_to")&&!t.hasAttribute("data-pass_collection")&&e&&t.setAttribute("data-pass_collection",e),t.getAttribute("name")&&!t.getAttribute("data-document_id")&&n&&t.setAttribute("data-document_id",n),t.hasAttribute("data-document_id")||null==n||t.setAttribute("data-document_id",n),t.hasAttribute("data-flat")||null==a||t.setAttribute("data-flat",a))}))},checkFormValidate:function(t){return void 0===CoCreate.unique||CoCreate.unique.checkValidate(t)},isTemplateInput:function(t){if(t.classList.contains("template"))return!0;let e=t.parentNode;for(;e;){if(e.classList&&e.classList.contains("template"))return!0;e=e.parentNode}return!1},getFormData:function(t,e,n){let c={};if(!n)return{};return t.querySelectorAll(`[name][data-collection='${n}']`).forEach((t=>{let n=t.getAttribute("data-document_id")||"",o=t.getAttribute("name"),a=t.value||t.getAttribute("value");"_id"!==o&&o&&a&&e==n&&(c[o]=t.value)})),c},getParents:function(t,e="form"){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),n=e.length;--n>=0&&e.item(n)!==this;);return n>-1});t&&t!==document;t=t.parentNode)if(t.matches(e))return t;return null},setDocumentIDOfElement:function(t,e){let n=t.getAttribute("data-document_id");n&&""!=n&&"pending"!=n||t.setAttribute("data-document_id",e)},getCOllections:function(t){let e=[];return t?(t.querySelectorAll("[name][data-collection]").forEach((t=>{let n=t.getAttribute("data-collection");n&&!e.includes(n)&&e.push(n)})),e):e}};var r=n(212),s=n.n(r);const d={requestAttr:"data-document_request",selectors:[],modules:[],init:function({name:t,selector:e,callback:n}){this.modules.push({name:t,selector:e,callback:n}),e&&this.selectors.push(e)},get:function(){return{selectors:this.selectors}},checkID:function(t,e="data-document_id"){let n=t.getAttribute(e)||"";return!(""===n||"pending"===n||!o.default.checkValue(n))},request:function({form:t,element:e,nameAttr:n,value:c}){!t&&e&&(t=e.closest("form")),t?this.__requestDocumentIdOfForm(t):e&&(n=n||"name",this.__requestDocumentId(e,n,c))},initElement:function(t){const e=t||document;if(!e.querySelectorAll)return;let n=e.querySelectorAll("form");0===n.length&&e!=document&&"FORM"===e.tagName&&(n=[e]),n.forEach((t=>{l.setAttribute(t),l.disableAutoFill(t)}))},__init:function(){const t=document.querySelectorAll("form");this.__initEvent(),t.forEach((t=>{l.setAttribute(t)}))},__initEvent:function(){const t=this;i().listen("createDocument",(function(e){const{metadata:n}=e;t.__receivedDocumentId(e)})),i().listen("deleteDocument",(function(t){const{metadata:e}=t})),document.addEventListener("clicked-submitBtn",(function(e){const{element:n}=e.detail;t.modules.forEach((({selector:t,callback:e})=>{e&&n.matches(t)&&e.call(null,n)}))}))},__deleteDocumentAction:function(t){const{collection:e,document_id:n}=i().getAttr(t);o.default.checkValue(e)&&o.default.checkValue(n)&&(i().deleteDocument({collection:e,document_id:n,metadata:"deleteDocument-action"}),document.dispatchEvent(new CustomEvent("deletedDocument",{detail:{}})))},__deleteDocumentsAction:function(t){const{collection:e,document_id:n}=i().getAttr(t),c=t.getAttribute("data-document_target");if(!c)return;const o=document.querySelectorAll(c);l.checkValue(e)&&(o.forEach((t=>{const n=t.getAttribute("data-document_id");i().checkValue(n)&&i().deleteDocument({collection:e,document_id:n,metadata:""})})),document.dispatchEvent(new CustomEvent("deletedDocuments",{detail:{}})))},__createDocumentAction:function(t){const e=t.closest("form");l.getCOllections(e).forEach((t=>{let n=l.getFormData(e,"",t);0==Object.keys(n).length&&n.constructor===Object||o.default.checkValue(t)&&(i().createDocument({collection:t,data:n,metadata:"createDocument-action",element:"empty"}),document.dispatchEvent(new CustomEvent("createdDocument",{detail:{}})))}))},__saveDocumentAction:function(t){const e=t.closest("form");if(!l.checkFormValidate(e))return void alert("Values are not unique");const n=this.selectors||[],c=e.querySelectorAll(n.join(","));let o=!1;for(var a=0;a<c.length;a++){let t=c[a];const{document_id:e,name:n}=i().getAttr(t);if(i().isSaveAttr(t))if(i().checkValue(e)){if(!i().isCRDT(t)){if(l.isTemplateInput(t))return;var u=new CustomEvent("clicked-submitBtn",{bubbles:!0,detail:{type:"submitBtn",element:t}});t.dispatchEvent(u)}}else n&&(o=!0)}o&&this.requestDocumentIdOfForm(e),document.dispatchEvent(new CustomEvent("savedDocument",{detail:{}}))},__requestDocumentId:function(t,e="name",n=null){const{collection:c,name:o}=i().getAttr(t);if(!c||!o)return;const a=s().generate();t.setAttribute(this.requestAttr,a),i().createDocument({collection:c,element:a,metadata:""})},__requestDocumentIdOfForm:function(t){let e=this,n=t.querySelectorAll("[name], [data-pass_to]"),c=[];for(var o=0;o<n.length;o++){let a=n[o];if(a.parentNode.classList.contains("template"))continue;const u=a.getAttribute("data-collection")||a.getAttribute("data-pass_collection")||"";if(""!==u&&!c.includes(u)&&!e.checkID(a,"data-document_id")&&!e.checkID(a,"data-pass_document_id")){const e=s().generate();c.push(u),a.setAttribute(this.requestAttr,e);let n=l.getFormData(t,"",u);i().createDocument({collection:u,element:e,data:n,metadata:""})}}},__setNewIdProcess:function(t,e,n){if(!t)return;t.removeAttribute(this.requestAttr);const c={document_id:e};n||this.checkID(t)||!t.hasAttribute("name")||t.setAttribute("data-document_id",e),n&&!this.checkID(t,"data-pass_document_id")&&t.hasAttribute("data-pass_to")&&(t.setAttribute("data-pass_document_id",e),t.parentNode.classList.contains("submitBtn")&&t.click());var o=new CustomEvent("set-document_id",{detail:c});t.dispatchEvent(o)},__receivedDocumentId:function(t){if(!t.document_id)return;let e=document.querySelector(`[${this.requestAttr}="${t.element}"]`);if(!e)return;let n=this;const c="FORM"===e.tagName?e:l.getParents(e,"form"),o=t.collection,a=t.document_id;if(c&&a){c.setAttribute("data-form_id",t.element);c.querySelectorAll(`[data-collection=${o}], [data-pass_collection=${o}]`).forEach((function(t){t.removeAttribute(n.requestAttr),t.hasAttribute("name")&&n.__setNewIdProcess(t,a),t.hasAttribute("data-pass_to")&&n.__setNewIdProcess(t,a,!0)}))}else e&&this.__setNewIdProcess(e,a)}};d.__init(),c.default.init({name:"CoCreateForm",observe:["subtree","childList"],include:"form",callback:function(t){d.initElement(t.target)}}),u.default.init({action:"createDocument",endEvent:"createdDocument",callback:(t,e)=>{d.__createDocumentAction(t)}}),u.default.init({action:"deleteDocument",endEvent:"deletedDocument",callback:(t,e)=>{d.__deleteDocumentAction(t)}}),u.default.init({action:"deleteDocuments",endEvent:"deletedDocuments",callback:(t,e)=>{CoCreateDocument.__deleteDocumentsAction(t)}}),u.default.init({action:"saveDocument",endEvent:"savedDocument",callback:(t,e)=>{d.__saveDocumentAction(t)}});const m=d}}]);