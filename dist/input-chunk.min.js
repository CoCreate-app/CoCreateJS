(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[9573],{9484:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(366),a=n(8858),c=n(5611),r=n.n(c),l=n(4752);const u={selector:"input, textarea, select",init:function(){this.initElement(document),this.__initSocketEvent()},__checkMultiple:function(e){return"INPUT"==e.tagName&&"checkbox"==e.getAttribute("type")||!("SELECT"!=e.tagName||!e.hasAttribute("multiple"))},refreshElement:async function(e){if(!e||!e.matches(this.selector))return;if(r().isCRDT(e))return;i.default.setInitialized(e,"text");const t=await r().read(e,!this.__checkMultiple(e));t&&this.renderElement(t,e)},initElement:async function(e){let t=e||document;if(!t.querySelectorAll)return;let n=t.querySelectorAll(this.selector);for(var i=0;i<n.length;i++){const e=n[i];if(r().isCRDT(e))continue;const t=await r().read(e,!this.__checkMultiple(e));t&&this.renderElement(t,e),this.__initEvents(e)}},__initSocketEvent:function(){const e=this;r().listen("updateDocument",(function(t){e.render(t)}))},save:async function(e){const t=!this.__checkMultiple(e);var n=[{element:e,value:this.getValue(e),is_flat:t}];await r().save(n)},renderElement:function(e,t){if(r().isCRDT(t))return;const{collection:n,document_id:i,name:a}=r().getAttr(t);if(e.collection==n&&e.document_id==i){const n=r().getValueByPath(a,e.data);n&&(this.setValue(t,n),t.dispatchEvent(new CustomEvent("CoCreateInput-run",{eventType:"rendered",item:t})))}},render:function(e,t){let n=document.querySelectorAll(this.selector),i=this;n.forEach((n=>{!t&&r().isCRDT(n)||i.renderElement(e,n)}))},getValue:function(e){let t=e.value,n=e.getAttribute("data-prefix_value")||"",i=e.getAttribute("data-suffix_value")||"";if("checkbox"===e.type){let n=e.getAttribute("name"),i=document.querySelectorAll(`input[type=checkbox][name='${n}']`);i.length>1?(t=[],i.forEach((e=>{e.checked&&t.push(e.value)}))):t=e.checked}else"number"===e.type?t=Number(t):"password"===e.type&&(t=this.__encryptPassword(t));if("string"==typeof t&&(t=n+t+i),"SELECT"==e.tagName&&e.hasAttribute("multiple")){let n=e.selectedOptions;t=[];for(let e=0;e<n.length;e++)t.push(n[e].value)}return t},setValue:function(e,t){if("checkbox"==e.type){if(Array.isArray(t)){let n=e.getAttribute("name");return void document.querySelectorAll(`input[type=checkbox][name='${n}']`).forEach((e=>{t.includes(e.value)&&(e.checked=!0)}))}e.checked=!0}else"radio"===e.type?e.value==t?e.checked=!0:e.checked=!1:"password"===e.type&&(t=this.__decryptPassword(t));if(e.value=t,"SELECT"==e.tagName&&e.hasAttribute("multiple")&&Array.isArray(t)){let n=e.options;for(let e=0;e<n.length;e++)t.includes(n[e].value)&&(n[e].selected="selected")}e.dispatchEvent(new CustomEvent("CoCreateInput-setvalue",{eventType:"rendered"}))},__initEvents:function(e){const t=this;e.addEventListener("input",(function(e){r().isRealtimeAttr(this)&&t.save(this)})),e.addEventListener("change",(function(e){"SELECT"==this.tagName&&r().isRealtimeAttr(this)&&t.save(this)}));const{collection:n,document_id:i,name:a}=r().getAttr(e);r().checkAttrValue(n)&&r().checkAttrValue(i)&&CoCreate.crdt&&l.default.init({collection:n,document_id:i,name:a,element:e})},__encryptPassword:function(e){return btoa(e)},__decryptPassword:function(e){return e?atob(e):""}};u.init(),i.default.init({name:"CoCreateInput",observe:["addedNodes"],attributeFilter:["data-collection","data-document_id","name"],callback:function(e){let t=e.target;t.hasAttribute("data-collection")&&t.hasAttribute("data-document_id")&&t.hasAttribute("name")&&u.initElement(e.target)}}),i.default.init({name:"CoCreateInputDocumentObserver",observe:["attributes"],attributeFilter:["data-document_id"],callback:function(e){u.refreshElement(e.target)}}),a.default.init({name:"CoCreateInput",selector:"input, textarea, select",callback:function(e){u.save(e)}});const s=u}}]);