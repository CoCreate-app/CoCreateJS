(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[9573],{9484:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(366),c=n(8858),u=n(4727),l=n(5611),o=n.n(l),a=n(4752);const r={selector:"input, textarea, select",init:function(){this.initElement(document),this.__initSocketEvent()},__checkMultiple:function(e){return"INPUT"==e.tagName&&"checkbox"==e.getAttribute("type")||!("SELECT"!=e.tagName||!e.hasAttribute("multiple"))},initElement:function(e){let t=e||document;if(!t.querySelectorAll)return;const n=this;t.querySelectorAll(this.selector).forEach((e=>{if(i.default.getInitialized(e,"input"))return;i.default.setInitialized(e,"input");const{collection:t,document_id:c}=o().getAttr(e),l=!this.__checkMultiple(e);u.default.isJsonString(t)||o().isCRDT(e)||(c&&t&&o().readDocument({collection:t,document_id:c,is_flat:l}),n.__initEvents(e))}))},__initSocketEvent:function(){const e=this;o().listen("updateDocument",(function(t){e.render(t)})),o().listen("connect",(function(t){e.__getReqeust()})),o().listen("readDocument",(function(t){e.render(t)}))},save:function(e){const t=this.getValue(e),{collection:n,document_id:i,name:c}=o().getAttr(e),u=!this.__checkMultiple(e);o().updateDocument({collection:n,document_id:i,is_flat:u,data:{[c]:t}})},render:function(e,t){let n=document.querySelectorAll(this.selector),i=this;n.forEach((n=>{if(!t&&o().isCRDT(n))return;if(o().isCRDT(n))return;const{collection:c,document_id:u,name:l}=o().getAttr(n);if("false"!==n.getAttribute("data-fetch_value")&&o().isReadAttr(n)&&e.collection==c&&e.document_id==u){const t=o().getValueByPath(l,e.data);t&&(i.setValue(n,t),n.dispatchEvent(new CustomEvent("CoCreateInput-run",{eventType:"rendered",item:n})))}}))},getValue:function(e){let t=e.value,n=e.getAttribute("data-prefix_value")||"",i=e.getAttribute("data-suffix_value")||"";if("checkbox"===e.type){let n=e.getAttribute("name"),i=document.querySelectorAll(`input[type=checkbox][name='${n}']`);i.length>1?(t=[],i.forEach((e=>{e.checked&&t.push(e.value)}))):t=e.checked}else"number"===e.type?t=Number(t):"password"===e.type&&(t=this.__encryptPassword(t));if("string"==typeof t&&(t=n+t+i),"SELECT"==e.tagName&&e.hasAttribute("multiple")){let n=e.selectedOptions;t=[];for(let e=0;e<n.length;e++)t.push(n[e].value)}return t},setValue:function(e,t){if("checkbox"==e.type){if(Array.isArray(t)){let n=e.getAttribute("name");return void document.querySelectorAll(`input[type=checkbox][name='${n}']`).forEach((e=>{t.includes(e.value)&&(e.checked=!0)}))}e.checked=!0}else"radio"===e.type?e.value==t?e.checked=!0:e.checked=!1:"password"===e.type&&(t=this.__decryptPassword(t));if(e.value=t,"SELECT"==e.tagName&&e.hasAttribute("multiple")&&Array.isArray(t)){let n=e.options;for(let e=0;e<n.length;e++)t.includes(n[e].value)&&(n[e].selected="selected")}e.dispatchEvent(new CustomEvent("CoCreateInput-setvalue",{eventType:"rendered"}))},__initEvents:function(e){const t=this;e.addEventListener("set-document_id",(function(){t.save(this)})),e.addEventListener("input",(function(e){o().isRealtimeAttr(this)&&t.save(this)})),e.addEventListener("change",(function(e){"SELECT"==this.tagName&&o().isRealtimeAttr(this)&&t.save(this)}));const{collection:n,document_id:i,name:c}=o().getAttr(e);o().checkValue(n)&&o().checkValue(i)&&CoCreate.crdt&&a.default.init({collection:n,document_id:i,name:c,element:e})},__getReqeust:function(e){let t=(e||document).querySelectorAll(this.selector),n=[],i=this;return t.forEach((e=>{if(o().isCRDT(e))return;const{collection:t,document_id:c,name:u}=o().getAttr(e),l=!i.__checkMultiple(e);c&&!n.some((e=>e.collection===t&&e.document_id===c&&e.is_flat==l))&&n.push({collection:t,document_id:c,is_flat:l})})),n},__encryptPassword:function(e){return btoa(e)},__decryptPassword:function(e){return e?atob(e):""}};r.init(),i.default.init({name:"CoCreateInput",observe:["subtree","childList"],include:"[data-collection][data-document_id][name]",callback:function(e){r.initElement(e.target)}}),c.default.init({name:"CoCreateInput",selector:"input, textarea, select",callback:function(e){r.save(e)}});const s=r}}]);