(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[5634],{5375:function(t,e,n){var o,r;"undefined"!=typeof self&&self,o=[n(9446),n(4965)],void 0===(r=function(t,e){return function(t,e,n){return{socket:null,setSocket:function(t){this.socket=t},readDocumentList:async function(t){if(!t)return!1;let n=e.getCommonParams();if(!t.collection)return!1;n={...n,...t},e.generateSocketClient(t.namespace,t.room);const o=this.socket.send("readDocumentList",n);try{return await this.socket.listenAsync(o)}catch(t){return null}},createDocument:async function(n){if(null===n)return!1;let o=e.getCommonParamsExtend(n),r={...n,...o},c=n.data||{};c.organization_id||(c.organization_id=t.config.organization_Id),n.data&&(c={...c,...n.data}),r.data=c;const a=e.generateSocketClient(n.namespace,n.room);let i=this.socket.send("createDocument",r,a);try{return await this.socket.listenAsync(i)}catch(t){return null}},updateDocument:async function(t){if(!t)return!1;if(t.document_id&&!n.checkDocumentId(t.document_id))return!1;let o=e.getCommonParamsExtend(t),r={...t,...o};if("object"==typeof t.data&&(r.set=t.data),Array.isArray(t.delete_fields)&&(r.unset=t.delete_fields),!r.set&&!r.unset)return!1;!1===t.broadcast&&(r.broadcast=!1),void 0===t.broadcast_sender&&(r.broadcast_sender=!0);const c=e.generateSocketClient(t.namespace,t.room);let a=this.socket.send("updateDocument",r,c);try{return await this.socket.listenAsync(a)}catch(t){return null}},readDocument:async function(t){if(null===t)return null;if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),r={...t,...o},c=this.socket.send("readDocument",r);try{return e.generateSocketClient(t.namespace,t.room),await this.socket.listenAsync(c)}catch(t){return null}},deleteDocument:async function(t){if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),r={...t,...o};const c=e.generateSocketClient(t.namespace,t.room);let a=this.socket.send("deleteDocument",r,c);try{return await this.socket.listenAsync(a)}catch(t){return null}},exportCollection:function(t){if(null===t)return;let n=e.getCommonParamsExtend(t);n.collection=t.collection,n.export_type=t.export_type,n.metadata=t.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof t.File))return;const r=o.name.split(".").pop();if(!["json","csv"].some((t=>t===r)))return;let c=e.getCommonParamsExtend(n);c.collection=n.collection,c.import_type=r,this.socket.send("importDB",c),this.socket.sendFile(o)},listen:function(t,e){this.socket.listen(t,e)},listenAsync:function(t){return this.socket.listenAsync(t)},createSocket:function(t,e){e?(this.socket.create({namespace:e,room:null,host:t}),this.socket.setGlobalScope(e)):this.socket.create({namespace:null,room:null,host:t})},read:async function(t,e){const{collection:o,document_id:r,name:c,namespace:a,room:i,is_read:s}=n.getAttr(t);if(!n.checkAttrValue(r))return!1!==e&&(e=!0),n.isJsonString(o)||n.isJsonString(r)?null:r&&o&&s?await this.readDocument({namespace:a,room:i,collection:o,document_id:r,name:c,is_flat:e}):null},save:async function(t){if(t)for(let e=0;e<t.length;e++)await this.saveElement(t[e])},saveElement:async function({element:e,value:o,is_flat:r}){if(!e||null===o)return;const{collection:c,document_id:a,name:i,namespace:s,room:u,broadcast:l,broadcast_sender:d,is_save:m}=n.getAttr(e);if(m&&c&&i)if(n.isCRDT(e)&&t.CoCreate.crdt)t.CoCreate.crdt.replaceText({collection:c,name:i,document_id:a,name:i,value:o});else{let t=await this.updateDocument({namespace:s,room:u,collection:c,document_id:a,upsert:!0,broadcast:l,broadcast_sender:d,is_flat:!1!==r,data:{[i]:o}});t.document_id&&a!==t.document_id&&await this.setDocumentId({element:e,docuement_id:t.document_id})}},setDocumentId:async function({element:t,form:e,document_id:n}){!e&&t&&(e=t.closest("form")),e?await CoCreate.form.setDocumentId(e):t&&t.setAttribute("data-document_id",n)},...n}}(window,t,e)}.apply(e,o))||(t.exports=r)},5611:function(t,e,n){var o,r;"undefined"!=typeof self&&self,o=[n(8585),n(5375)],void 0===(r=function(t,e){return function(t,e,n){if(t){let t=window.CoCreateCrudSocket;t||(t=new e("ws"),window.CoCreateCrudSocket=t),n.setSocket(t),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,t,e)}.apply(e,o))||(t.exports=r)},4965:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function t(e,n){e=e||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],t(e[o],n[o]));return Object.assign(e||{},n),e}function e(t,e){if(!e)return t;let n=e.split("."),o=t;for(var r=n.length-1;r>=0;r--)o={[n[r]]:o};return o}function n(t,e){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(t);if(n&&3==n.length){let o=n[1],r=parseInt(n[2]);e[o]&&Array.isArray(e[o])||(e[o]=[]),e[o][r]=e[t],delete e[t],t=o}}catch{}return t}function o(t,e){try{if(!t||!e)return null;if(e[t])return e[t];let o=t.split("."),r={...e};for(var n=0;n<o.length&&r;n++)r=r[o[n]];return r}catch{return null}}function r(t){return!!t&&t.constructor===Object}function c(t){return!!t&&t.constructor===Array}function a(o){let r=Object.keys(o),c={};return r.forEach((r=>{if((r=n(r,o)).split(".").length>1){let n=e(o[r],r);delete o[r],c=t(c,n)}else c[r]=o[r]})),c}function i(t){let e=Object.keys(t),n={};return e.forEach((e=>{let o=t[e];if(r(t[e])){let o=i(t[e]);Object.keys(o).forEach((t=>{let r=o[t];n[t=e+"."+t]=r}))}else c(o)?o.forEach(((t,o)=>{n[`${e}[${o}]`]=t})):n[e]=t[e]})),n}function s(t){if(!t)return;let e=t.getAttribute("data-collection"),n=t.getAttribute("data-document_id"),o=t.getAttribute("name"),r=t.getAttribute("data-room");return{collection:e,document_id:n,name:o,is_realtime:h(t),is_save:l(t),is_read:u(t),is_update:d(t),is_listen:p(t),broadcast:m(t),broadcast_sender:f(t),room:r}}const u=t=>y(t,"data-read_value"),l=t=>y(t,"data-save_value"),d=t=>y(t,"data-update_value"),m=t=>y(t,"data-broadcast"),f=t=>y(t,"data-broadcast_sender"),p=t=>y(t,"data-listen"),h=t=>y(t,"data-realtime");function y(t,e){return!!t&&"false"!==t.getAttribute(e)}function _(t){return!!t&&!/{{\s*([\w\W]+)\s*}}/g.test(t)&&"null"!==t.toLowerCase()}function k(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}function g(t){const{collection:e,document_id:n,name:o}=s(t);return!(k(e)||k(o)||!("INPUT"===t.tagName&&["text","email","tel","url"].includes(t.type)||"TEXTAREA"===t.tagName)||!o||!h(t)||"true"===t.getAttribute("data-unique")||"password"===t.type||!u(t))}function C(t){try{return!!t&&"null"!==t.toLowerCase()}catch(t){return!1}}function k(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}return{decodeObject:a,encodeObject:i,getAttr:s,isRealtimeAttr:h,isReadAttr:u,isSaveAttr:l,isUpdateAttr:d,isFlatAttr:t=>y(t,"data-flat"),checkAttrValue:_,isCRDT:g,checkDocumentId:C,getValueByPath:o,isJsonString:k}}()}.apply(e,[]))||(t.exports=n)}}]);