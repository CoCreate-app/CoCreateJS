/*! For license information please see attributes-chunk.min.js.LICENSE.txt */
(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[2732],{8659:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>g});var a=r(2742);function i(t,e){return this.getAttribute(t)!==e&&(e?this.setAttribute(t,e):this.removeAttribute(t),!0)}function n({property:t,camelProperty:e,value:r,computedStyles:a}){return!(!a[e]||a[e]===r)&&(this.style[t]=r,!0)}function l(t){let e=parseFloat(t);if(isNaN(e))return[t,""];{let r=(e+"").length;return[e,t.substr(r)]}}function u(t){let e=0;for(;;){if(e=t.indexOf("-",e),-1===e)break;{let r=t.substring(0,e);r+=String.fromCharCode(t.charCodeAt(e+1)-32),r+=t.substr(e+2),t=r}}return t}var s=r(366),o=r(4752),c=r(1700),p=r(980),y=r.n(p),d=r(602);let h=new function(){this.cache=new Map,this.spread=function(t,e){this.cache.set(t,{...this.cache.get(t),...e})},this.set=function(t,e,r){this.cache.set(t,{...this.cache.get(t),[e]:r})},this.get=function(t,e){let r=this.cache.get(t);return r?r[e]:void 0},this.reset=function(t){this.cache.delete(t)}},m=["attribute","classstyle","style","innerText"];function f({document:t,exclude:e="",callback:r=(()=>{})}){this.exclude=e,this.callback=r,this.initDocument=t}f.prototype.init=function(){this.scanNewElement(),s.default.init({name:"ccAttribute",observe:["attributes"],attributesFilter:["data-attributes_target","value","data-attributes_unit"],callback:async t=>t.target.matches("INPUT, .pickr, cocreate-select")&&await this.watchInputChange(t)}),this.initDocument.addEventListener("input",(async t=>{let e=t.target;this.perInput(e,((t,r)=>this.updateElement({...t,input:e,element:r,isColl:!0})))})),this.observerElements(this.initDocument.defaultView),y().listen("ccStyle",(t=>this.listen(t)))},f.prototype.listen=async function({value:t,unit:e,type:r,property:a,camelProperty:i,elementId:n,elementSelector:l}){let u=a?`[data-attributes="${r}"][data-attributes_property="${a}"]:not(${this.exclude})`:`[data-attributes="${r}"]:not(${this.exclude})`,s=this.initDocument.querySelector(u),o=await this.complexSelector(l,((t,e)=>t.querySelector(e)));this.updateElement({type:r,property:a,camelProperty:i,input:s,element:o,collValue:t,unit:e,isColl:!1})},f.prototype.collaborate=function({element:t,...e}){let r=t.getAttribute("data-element_id");if(!r)return;let a=e.input.getAttribute("data-attributes_target");y().send({broadcast_sender:!1,rooms:"",emit:{message:"ccStyle",data:{...e,elementId:r,elementSelector:a}}})},f.prototype.scanNewElement=function(){this.initDocument.querySelectorAll(`[data-attributes]:not(${this.exclude})`).forEach((async t=>{this.perInput(t,((e,r)=>this.updateInput({...e,input:t,element:r,isColl:!0})))}))},f.prototype.observerElements=function(t){t.CoCreate.observer.init({name:"ccAttribute",observe:["attributes"],callback:t=>{let e=t.target;this.getInputFromElement(e).forEach((t=>{let r=this.validateInput(t);r&&this.updateInput({...r,input:t,element:e})}))}})},f.prototype.getInputFromElement=function(t){let e=t.getAttribute("data-element_id")||t.id&&"#"+t.id;return e?this.initDocument.querySelectorAll(`[data-attributes_target="${e}"]`):[]},f.prototype.watchInputChange=async function(t){try{let e,r=t.target,a=this.validateInput(r);if(e=a&&await this.getElementFromInput(r),!e)return;"data-attributes_target"===t.attributeName?this.updateInput({...a,input:r,element:e}):"data-attributes_unit"===t.attributeName&&this.updateElement({...a,input:r,element:e,isColl:!0})}catch(t){}},f.prototype.perInput=async function(t,e){let r,a;r=this.validateInput(t),a=r&&await this.getElementFromInput(t),a&&e(r,a)},f.prototype.validateInput=function(t){let e=t.getAttribute("data-attributes");if(!e)return;e=e.toLowerCase();let r,a=t.getAttribute("data-attributes_property");return a&&(r=u(a),a=a.toLowerCase()),{type:e,property:a,camelProperty:r}},f.prototype.updateElementByValue=function({type:t,property:e,camelProperty:r,input:a,element:l,inputValue:u,hasCollValue:s}){let o,c,p;switch(t){case"classstyle":return p=a.getAttribute("data-attributes_unit")||"",c=(u=Array.isArray(u)?u.value:u)&&!s?u+p:u,c=c||"",o=this.getRealStaticCompStyle(l),function(t,{property:e,camelProperty:r,value:a,computedStyles:i}){let n=t.classList,l=new Map;n.forEach((t=>{let[e,r]=t.split(":");r&&l.set(e,r)}));let u=l.get(e);if(a){if(u){if(u!=a)return n.replace(`${e}:${u}`,`${e}:${a}`)}else if(i[r]!=a&&!n.contains(`${e}:${a}`))return n.add(`${e}:${a}`),!0}else if(n.contains(`${e}:${u}`))return n.remove(`${e}:${u}`),!0;return!1}(l,{property:e,camelProperty:r,value:c,computedStyles:o});case"style":return p=a.getAttribute("data-attributes_unit")||"",c=(u=Array.isArray(u)?u.value:u)&&!s?u+p:u,c=c||"",o=this.getRealStaticCompStyle(l),n.call(l,{property:e,camelProperty:r,value:c,computedStyles:o});case"innerText":return l.innerText!=u&&(l.innerText=u,!0);default:if("string"==typeof u)return i.call(l,t,u);if(!u.length)return i.call(l,t,"");if("class"===t)return c=u.map((t=>t.value)).join(" "),i.call(l,t,c);for(let e of u)if(e.checked)return i.call(l,t,e.value)}},f.prototype.removeZeros=function(t){let e=0;for(let r=t.length;e<r&&"0"===t[e];e++);return t.substr(e)||t&&"0"},f.prototype.updateElement=function({input:t,element:e,collValue:r,isColl:a,unit:i,type:n,property:l,...u}){let s=null!=r?r:this.getInputValue(t);if(!s)return;Array.isArray(s)?s.forEach((t=>this.removeZeros(t.value))):(s=i&&s?s+i:s,s=this.removeZeros(s));let o,c=this.updateElementByValue({...u,type:n,property:l,input:t,element:e,inputValue:s,hasCollValue:null!=r});h.reset(e),c&&a&&this.collaborate({value:s,unit:t.getAttribute("data-attributes_unit"),input:t,element:e,type:n,property:l,...u}),m.includes(n)||(l=n,n="attribute"),o=Array.isArray(s)?"class"===l?s.map((t=>t.value)).join(" "):s[0].value:s,c&&a&&this.callback({value:o,unit:t.getAttribute("data-attributes_unit"),input:t,element:e,type:n,property:l,...u})},f.prototype.updateInput=function({type:t,property:e,camelProperty:r,element:a,input:n}){let s,o,c,p,y;if(n){switch(t){case"class":o=Array.from(a.classList);break;case"classstyle":let e=function(t){let e={};return t.forEach((t=>{let[r,a]=t.split(":");e[u(r)]=a})),e}(a.classList);if(e[r]?c=e[r]:(s=this.getRealStaticCompStyle(a),c=s[r]),!c)return;[p,y]=l(c),o=p,i.call(n,"data-attributes_unit",y);break;case"style":if(s=this.getRealStaticCompStyle(a),c=s[r],!c)return;[p,y]=l(c),o=p,i.call(n,"data-attributes_unit",y);case"innerText":o=a.innerText;break;default:o=a.getAttribute(t)}this.setInputValue(n,null!=o?o:"")}},f.prototype.setInputValue=function(t,e){switch((t.classList.contains("pickr")?"pickr":t.matches(d.zO)&&"cocreate-select")||t.tagName.toLowerCase()){case"select":let r=Array.from(t.options);r.forEach((a=>{e==a.value&&(t.selectedIndex=r.indexOf(a))}));break;case"cocreate-select":e=e?Array.isArray(e)?e:[e]:[],function(t,e){if(a.container.has(t)){let r=a.container.get(t);e.length?e.forEach((t=>r.selectOption(t))):r.unselectAll(!1)}}(t,e);break;case"pickr":c.default.refs.get(t).setColor(e);break;default:o.default.replaceText({collection:"builder",document_id:"null",name:t.getAttribute("name"),value:e+"",position:"0"})}},f.prototype.packMultiValue=function({inputs:t,stateProperty:e,valueProperty:r="value",forceState:a}){let i=[];return Array.from(t).forEach((t=>{i.push({checked:a||t[e],value:t[r]||t.getAttribute(r)})})),i},f.prototype.getInputValue=function(t){if(!t)return;switch((t.classList.contains("pickr")?"pickr":t.matches(d.zO)&&"cocreate-select")||t.tagName.toLowerCase()){case"input":switch(t.type){case"checkbox":case"radio":return this.packMultiValue({inputs:this.initDocument.getElementsByName(t.name),stateProperty:"checked"});default:return t.value}case"textarea":return t.value;case"select":return this.packMultiValue({inputs:t.options,stateProperty:"selected"});case"cocreate-select":return this.packMultiValue({inputs:t.selectedOptions,forceState:!0});case"pickr":let e=c.default.refs.get(t);return e?e.getColor():"";default:return!1}},f.prototype.getElementFromInput=async function(t){let e=t.getAttribute("data-attributes_target");if(e){if(-1!==e.indexOf(";")){return await this.complexSelector(e,((t,e)=>t.querySelector(e)))}return this.initDocument.querySelector(e)}return!1},f.prototype.getRealStaticCompStyle=function(t){if(h.get(t,"valid"))return h.get(t,"computedStyles");setTimeout((()=>{h.reset(t)}),5e3);let e=t.style.display;t.style.display="none";let r=window.getComputedStyle(t),a=Object.assign({},r);return a.display=e,t.style.display=e,""==t.getAttribute("style")&&t.removeAttribute("style"),t.removeAttribute("no-observe"),h.spread(t,{computedStyles:a,valid:!0}),a};let b=new Map;f.prototype.complexSelector=async function(t,e){let[r,a]=t.split(";"),i=document.querySelector(r);if(i){if("loading"===i.contentDocument.readyState)try{await new Promise(((t,e)=>{i.contentWindow.addEventListener("load",(e=>t()))}))}catch(t){}return i.contentWindow.CoCreate.observer&&!b.has(i.contentWindow)&&(this.observerElements(i.contentWindow),b.set(i.contentWindow)),e(i.contentWindow.document,a)}};const g={init:t=>{let e=new f(t);return e.init(),e}}}}]);