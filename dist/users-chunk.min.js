(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[891],{1145:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>d});o(8858);var r=o(5611),i=o.n(r),n=(o(9484),o(6515),o(1737));const s="users",d={init:function(){this.updatedCurrentOrg=!1,this.created_userId="",this.created_orgId="",this.checkSession(),this.initSocket(),this.fetchUser(),this.initLoginForm(),this.initLoginForm(),this.initCurrentOrgEles()},initSocket:()=>{const e=void 0;i().listen("fetchedUser",e.checkPermissions),i().listen("login",e.loginResult),i().listen("createDocument",e.registerResult),i().listen("changedUserStatus",e.changedUserStatus),i().listen("usersCurrentOrg",e.setCurrentOrg)},setCurrentOrg:e=>{(void 0).updatedCurrentOrg=!0,window.localStorage.setItem("apiKey",e.apiKey),window.localStorage.setItem("organization_id",e.current_org),window.localStorage.setItem("adminUI_id",e.adminUI_id),window.localStorage.setItem("builderUI_id",e.builderUI_id),document.dispatchEvent(new CustomEvent("fetchedUsersCurrentOrg")),e.href&&(window.location.href=e.href)},checkPermissions:e=>{document.querySelectorAll(".checkPermission").forEach((t=>{let o=t.getAttribute("data-document_id")?t.getAttribute("data-document_id"):t.getAttribute("data-pass_document_id"),r=t.getAttribute("data-permission");if(-1==e["permission-"+o].indexOf(r))switch(r){case"create":case"read":case"delete":t.style.display="none";break;case"delete":t.readOnly=!0}else r}))},fetchUser:e=>{const t=window.localStorage.getItem("user_id");if(t){var o={apiKey:window.config.apiKey,organization_id:window.config.organization_Id,"data-collection":s,user_id:t};i().socket.send("fetchUser",o)}},initLoginForm:e=>{const t=document.querySelectorAll("form"),o=void 0;t.forEach((e=>{const t=e.querySelector(".loginBtn");t&&t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),o.requestLogin(e)}))}))},requestLogin:(e,t)=>{let o=e.getAttribute("data-collection"),r={};e.querySelectorAll("input, textarea").forEach((e=>{const t=e.getAttribute("name");let i=e.value;"password"==e.type&&(i=btoa(i)),o=e.getAttribute("data-collection")||o,t&&(r[t]=i)})),i().socket.send("login",{apiKey:window.config.apiKey,organization_id:window.config.organization_Id,"data-collection":o,loginData:r})},loginResult:e=>{const{success:t,status:o,message:r,token:i}=e;if(window.localStorage.setItem("token",i),document.cookie=`token=${i};path=/`,n.default.data({selector:"[data-template_id='afterLoginResponse']",render:e}),t){window.localStorage.setItem("user_id",e.id);let t="",o=document.querySelector("form .loginBtn a");o&&(t=o.getAttribute("href")),getCurrentOrg(e.id,e.collection,t)}},getCurrentOrg:(e,t,o)=>{i().socket.send("usersCurrentOrg",{"data-collection":t||s,user_id:e,href:o})},userRegisterAction:e=>{if(e){var t=e.closest("form");t&&t.request({form:t})}},registerResult:e=>{"organizations"===e.collection&&((void 0).created_orgId=e.document_id),e.collection===s&&((void 0).created_userId=e.document_id),(void 0).created_orgId&&(void 0).created_userId&&(i().updateDocument({broadcast:!1,collection:s,document_id:(void 0).created_userId,data:{current_org:(void 0).created_orgId,connected_orgs:[(void 0).created_orgId]},broadcast:!1}),window.localStorage.setItem("user_id",(void 0).created_userId),(void 0).getCurrentOrg((void 0).created_userId,s,null))},initCurrentOrgEles:()=>{},initLogoutBtn:()=>{let e=document.querySelectorAll(".logoutBtn");const t=void 0;e.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),window.localStorage.clear(),t.deleteCookie();let o=this.getAttribute("href");o&&(document.location.href=o)}))}))},deleteCookie:()=>{let e=document.cookie.split(";");for(var t=0;t<e.length;t++)document.cookie=e[t]+"=;expires="+new Date(0).toUTCString()},checkSession:()=>{if(window.localStorage.getItem("user_id")){let e=document.querySelector(".sessionTrue");if(e){let t=e.getAttribute("href");t&&(document.location.href=t)}}else{let e=document.querySelector(".sessionFalse");if(e){let t=e.getAttribute("href");t&&(window.localStorage.clear(),(void 0).deleteCookie(),document.location.href=t)}}},changedUserStatus:e=>{if(!e.user_id)return;document.querySelectorAll(`[data-user_status][data-document_id='${e.user_id}']`).forEach((t=>{t.setAttribute("data-user_status",e.status)}))}}}}]);