(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[891],{1145:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>A});o(8858);var n=o(5611),r=o.n(n),i=(o(9484),o(6515),o(1737)),a="users",c="",l="";y(),u(),d(),m(),p(),b();var s=!1;function u(){r().listen("fetchedUser",(function(e){g(e)})),r().listen("login",(function(e){_(e)})),r().listen("createDocument",(function(e){S(e)})),r().listen("usersCurrentOrg",(function(e){s=!0,!0,localStorage.setItem("apiKey",e.apiKey),localStorage.setItem("organization_id",e.current_org),localStorage.setItem("adminUI_id",e.adminUI_id),localStorage.setItem("builderUI_id",e.builderUI_id),document.dispatchEvent(new CustomEvent("fetchedUsersCurrentOrg")),e.href&&(window.location.href=e.href)}))}function d(){var e=localStorage.getItem("user_id");if(e){var t={apiKey:config.apiKey,organization_id:config.organization_Id,"data-collection":a,user_id:e};r().socket.send("fetchUser",t)}}function g(e){f(e)}function f(e){for(var t=document.querySelectorAll(".checkPermission"),o=0;o<t.length;o++){var n=t[o],r=n.getAttribute("data-document_id")?n.getAttribute("data-document_id"):n.getAttribute("data-pass_document_id"),i=n.getAttribute("data-permission");if(-1==e["permission-"+r].indexOf(i))switch(i){case"create":case"read":case"delete":n.style.display="none";break;case"delete":n.readOnly=!0}else i}}function m(){for(var e=document.querySelectorAll("form"),t=0;t<e.length;t++)h(e[t])}function h(e){var t=e.querySelector(".loginBtn");t&&t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation();let o=e.getAttribute("data-collection")||"module_activity",n={};e.querySelectorAll("input, textarea").forEach((e=>{const t=e.getAttribute("name");let r=e.value;"password"==e.type&&(r=btoa(r)),o=e.getAttribute("data-collection")||o,t&&(n[t]=r)}));var i={apiKey:config.apiKey,organization_id:config.organization_Id,"data-collection":o,loginData:n};r().socket.send("login",i)}))}function _(e){const{success:t,status:o,message:n,token:r}=e;if(localStorage.setItem("token",r),document.cookie=`token=${r}`,i.default.data({selector:"[data-template_id='afterLoginResponse']",render:e}),e.success){localStorage.setItem("user_id",e.id);let t="",o=document.querySelector("form .loginBtn a");o&&(t=o.getAttribute("href")),v(e.id,e.collection,t)}}function v(e,t,o){var n={"data-collection":t||a,user_id:e,href:o};r().socket.send("usersCurrentOrg",n)}function S(e){"organizations"===e.collection&&(l=e.document_id),e.collection===a&&(c=e.document_id),l&&c&&(r().updateDocument({broadcast:!1,collection:a,document_id:c,data:{current_org:l,connected_orgs:[l]},broadcast:!1}),localStorage.setItem("user_id",c),v(c,a,null))}function p(){var e=localStorage.getItem("user_id");if(!e)return;let t=document.querySelectorAll(".org-changer");for(let r=0;r<t.length;r++){let i=t[r];var o=i.getAttribute("data-collection")?i.getAttribute("data-collection"):"module_activity",n=i.getAttribute("data-document_id");"users"==o&&n==e&&i.addEventListener("selectedValue",(function(t){setTimeout((function(){v(e);var t=setInterval((function(){s&&(location.reload(),clearInterval(t))}),100)}),300)}))}}function b(){let e=document.querySelectorAll(".logoutBtn");for(let t=0;t<e.length;t++){e[t].addEventListener("click",(function(e){e.preventDefault(),localStorage.clear();let t=this.getAttribute("href");t&&(document.location.href=t)}))}}function y(){var e;if(localStorage.getItem("user_id")){if(e=document.querySelector(".sessionTrue")){let t=e.getAttribute("href");t&&(document.location.href=t)}}else if(e=document.querySelector(".sessionFalse")){let t=e.getAttribute("href");t&&(localStorage.clear(),document.location.href=t)}}const A={initSocketsForUsers:u,fetchUser:d,fetchedUser:g,checkPermissions:f,initLoginForms:m,initLoginForm:h,loginResult:_,getCurrentOrg:v,userRegisterAction:function(e){if(e){var t=e.closest("form");t&&t.request({form:t})}},registerResult:S,initCurrentOrgEles:p,initLogoutBtn:b,checkSession:y,changedUserStatus:function(e){if(!e.user_id)return;document.querySelectorAll(`[data-user_status][data-document_id='${e.user_id}']`).forEach((t=>{t.setAttribute("data-user_status",e.status)}))}}}}]);