(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[891],{1145:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>S});var r="users",n="",i="";C(),c(),s(),d(),_(),y();var a=!1;function c(){CoCreate.socket.listen("fetchedUser",(function(e){u(e)})),CoCreate.socket.listen("login",(function(e){f(e)})),CoCreate.socket.listen("createDocument",(function(e){h(e)})),CoCreate.socket.listen("usersCurrentOrg",(function(e){a=!0,!0,localStorage.setItem("apiKey",e.apiKey),localStorage.setItem("securityKey",e.securityKey),localStorage.setItem("organization_id",e.current_org),localStorage.setItem("adminUI_id",e.adminUI_id),localStorage.setItem("builderUI_id",e.builderUI_id),document.dispatchEvent(new CustomEvent("fetchedUsersCurrentOrg")),e.href&&(window.location.href=e.href)})),CoCreate.crud.listenMessage("changedUserStatus",(function(e){v(e)}))}function s(){var e=localStorage.getItem("user_id");if(e){var t={apiKey:config.apiKey,securityKey:config.securityKey,organization_id:config.organization_Id,"data-collection":r,user_id:e};CoCreate.socket.send("fetchUser",t)}}function u(e){l(e)}function l(e){for(var t=document.querySelectorAll(".checkPermission"),o=0;o<t.length;o++){var r=t[o],n=r.getAttribute("data-document_id")?r.getAttribute("data-document_id"):r.getAttribute("data-pass_document_id"),i=r.getAttribute("data-permission");if(-1==e["permission-"+n].indexOf(i))switch(i){case"create":case"read":case"delete":r.style.display="none";break;case"delete":r.readOnly=!0}else i}}function d(){for(var e=document.querySelectorAll("form"),t=0;t<e.length;t++)g(e[t])}function g(e){var t=e.querySelector(".loginBtn");t&&t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation();let o=e.getAttribute("data-collection")||"module_activity",r={};e.querySelectorAll("input, textarea").forEach((e=>{const t=e.getAttribute("name");let n=e.value;"password"==e.type&&(n=btoa(n)),o=e.getAttribute("data-collection")||o,t&&(r[t]=n)}));var n={apiKey:config.apiKey,securityKey:config.securityKey,organization_id:config.organization_Id,"data-collection":o,loginData:r};CoCreate.socket.send("login",n)}))}function f(e){const{success:t,status:o,message:r}=e;if(CoCreate.render.data({selector:"[data-template_id='afterLoginResponse']",render:e}),e.success){localStorage.setItem("user_id",e.id);let t="",o=document.querySelector("form .loginBtn a");o&&(t=o.getAttribute("href")),m(e.id,e.collection,t)}}function m(e,t,o){var n={"data-collection":t||r,user_id:e,href:o};CoCreate.socket.send("usersCurrentOrg",n)}function h(e){"organizations"===e.collection&&(i=e.document_id),e.collection===r&&(n=e.document_id),i&&n&&(CoCreate.crud.updateDocument({broadcast:!1,collection:r,document_id:n,data:{current_org:i,connected_orgs:[i]},broadcast:!1}),localStorage.setItem("user_id",n),m(n,r,null))}function _(){var e=localStorage.getItem("user_id");if(!e)return;let t=document.querySelectorAll(".org-changer");for(let n=0;n<t.length;n++){let i=t[n];var o=i.getAttribute("data-collection")?i.getAttribute("data-collection"):"module_activity",r=i.getAttribute("data-document_id");"users"==o&&r==e&&i.addEventListener("selectedValue",(function(t){setTimeout((function(){m(e);var t=setInterval((function(){a&&(location.reload(),clearInterval(t))}),100)}),300)}))}}function y(){let e=document.querySelectorAll(".logoutBtn");for(let t=0;t<e.length;t++){e[t].addEventListener("click",(function(e){e.preventDefault(),localStorage.clear();let t=this.getAttribute("href");t&&(document.location.href=t)}))}}function C(){var e;if(localStorage.getItem("user_id")){if(e=document.querySelector(".sessionTrue")){let t=e.getAttribute("href");t&&(document.location.href=t)}}else if(e=document.querySelector(".sessionFalse")){let t=e.getAttribute("href");t&&(localStorage.clear(),document.location.href=t)}}function v(e){if(!e.user_id)return;document.querySelectorAll(`[data-user_status][data-document_id='${e.user_id}']`).forEach((t=>{t.setAttribute("data-user_status",e.status)}))}const S={initSocketsForUsers:c,fetchUser:s,fetchedUser:u,checkPermissions:l,initLoginForms:d,initLoginForm:g,loginResult:f,getCurrentOrg:m,userRegisterAction:function(e){if(e){var t=e.closest("form");t&&CoCreate.form.request({form:t})}},registerResult:h,initCurrentOrgEles:_,initLogoutBtn:y,checkSession:C,changedUserStatus:v}}}]);