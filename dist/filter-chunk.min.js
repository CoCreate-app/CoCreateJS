(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[225],{3232:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>l});r(4727);var i=r(5611),n=r.n(i);const a={items:[],ioInstance:null,moduleAttribues:[],module_items:[],__init:function(){this.__initIntesection(),this.__initSocket(),this.__initEvents()},__initIntesection:function(){const t=this;this.ioInstance=new IntersectionObserver(((e,r)=>{e.forEach((e=>{if(e.isIntersecting){const r=t.__getMainAttribue(e.target);r.id&&document.dispatchEvent(new CustomEvent("CoCreateFilter-loadMore",{detail:{attrName:r.name,attrId:r.id}})),t.ioInstance.unobserve(e.target)}}))}),{threshold:1})},__runLoadMore:function(t,e){if(!e||!t)return;let r=this.items.find((r=>r.attrName===t&&r.id===e));r&&r.count>0&&this.fetchData(r)},__getMainAttribue:function(t){const e=this.moduleAttribues.find((e=>""!==(t.getAttribute(e)||"")));return e?{name:e,id:t.getAttribute(e)}:{}},__initSocket:function(){const t=this;n().listen("readDocumentList",(function(e){let r=e.element,i=t.items.find((t=>t.id===r));if(i){const r=e.data;let n=document.querySelector(`[${i.attrName}="${i.id}"][data-fetch_type="scroll"]`);r.length>0&&n&&t.ioInstance.observe(n);const a=e.operator.total,l=document.querySelectorAll(`[${i.attrName}="${i.id}"][data-fetch_type="total"]`);l&&l.forEach((t=>t.innerHTML=a))}}))},__initEvents:function(){const t=this;document.addEventListener("CoCreateFilter-loadMore",(function(e){const r=e.detail.attrId,i=e.detail.attrName;t.__runLoadMore(i,r)})),document.querySelectorAll('[data-fetch_type="loadmore"]').forEach((e=>{e.addEventListener("click",(function(r){r.preventDefault();const i=t.__getMainAttribue(e);i.id&&t.__runLoadMore(i.attrName,i.attrId)}))}))},setFilter:function(t,e,r){if(!e)return;let i=t.getAttribute(e);if(!i)return;this.moduleAttribues.includes(e)||this.moduleAttribues.push(e);let n=t.getAttribute("data-fetch_collection"),a="collection"==t.getAttribute("data-fetch_value_type"),l=t.getAttribute("data-order_by"),o=t.getAttribute("data-order_type")||"asc",c=parseInt(t.getAttribute("data-fetch_count")),u={el:t,id:i,eId:i,type:r,attrName:e,collection:n,startIndex:0,options:{},fetch:{},is_collection:a,search:{type:"or",value:[]},orders:[],filters:[]};return!isNaN(c)&&c>0&&(u.count=c),l&&u.orders.push({name:l,type:"asc"==o?1:-1}),this._initFilter(u,i,e),this._initOrder(u,i,e),this.items.push(u),this._initInputForm(u,e),this._initExportImport(u,i,e),u},_initFilter:function(t,e,r){let i=t.el.getRootNode().querySelectorAll("["+r+'="'+e+'"]');for(var n=0;n<i.length;n++){let a=i[n],l=a.getAttribute("data-filter_name"),o=a.getAttribute("data-filter_operator")?a.getAttribute("data-filter_operator"):"$contain",c=a.getAttribute("data-filter_value_type")?a.getAttribute("data-filter_value_type"):"string",u=a.getAttribute("data-filter_type"),s=a.getAttribute("data-filter_value");if(null!=s)if("raw"!==c&&(s=s.replace(/\s/g,"").split(",")),l){let e=this.getFilterByName(t,l,o);if("string"!=c)for(let t=0;t<s.length;t++)s[t]=Number(s[t]);this.insertArrayObject(t.filters,e,{name:l,value:s,operator:o,type:u})}else t.search.value=this._makeSearchOption(e,r)}},_initOrder:function(t,e,r){let i=t.el.getRootNode().querySelectorAll("["+r+'="'+e+'"]');const n=this;for(var a=0;a<i.length;a++){let e=i[a],r=e.getAttribute("data-order_by"),l=e.getAttribute("value");r&&l&&(["A","BUTTON"].includes(e.tagName)?e.addEventListener("click",(function(){let e=this.getAttribute("data-order_by"),r=this.getAttribute("value");n._applyOrder(t,e,r),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))})):this._applyOrder(t,r,l))}this._initToggleOrderEvent(t,e,r)},_initToggleOrderEvent:function(t,e,r){let i=document.querySelectorAll(`[${r}="${e}"][data-toggle_order]`);const n=this;i.forEach((e=>{e.addEventListener("click",(function(){let r=this.getAttribute("data-toggle_order")||"",a=this.getAttribute("data-order_by");r="asc"===r?"desc":"asc";for(let t=0;t<i.length;t++)i[t]!==e&&i[t].setAttribute("data-toggle_order","");t.orders=[],n._applyOrder(t,a,r),e.setAttribute("data-toggle_order",r),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))}))}))},_initExportImport:function(t,e,r){let i=document.querySelector(`[data-export_type][${r}="${e}"]`),a=document.querySelector(`[data-import="true"][${r}="${e}"]`);const l=this;i&&i.addEventListener("click",(function(){if(!t)return;let e=l.makeFetchOptions(t);e.export={collection:e.collection,type:i.getAttribute("data-export_type")||"json"},n().readDocumentList(e)})),a&&a.addEventListener("click",(function(){var e=document.createElement("input");if(e.type="file",!t)return;let r=t.collection;e.onchange=t=>{var e=t.target.files[0];n().importCollection({collection:r,file:e})},e.click()}))},_applyOrder:function(t,e,r){if(!r)return;let i=0,n=this.getOrderByName(t,e);i="asc"==r?1:"desc"==r?-1:[],this.insertArrayObject(t.orders,n,{name:e,type:i},i)},changeCollection:function(t){let e=t.el.getAttribute("data-fetch_collection");t.collection=e,t.startIndex=0},_makeSearchOption:function(t,e){let r=document.querySelectorAll("form["+e+"="+t+"]"),i="["+e+"="+t+"]",n=document.querySelectorAll("input"+i+",textarea"+i+", select"+i),a=[];for(let t=0;t<r.length;t++){let e=r[t].querySelectorAll("input, textarea, select");e=Array.prototype.slice.call(e),a=a.concat(e)}n=Array.prototype.slice.call(n),a=a.concat(n);let l=[];for(var o=0;o<a.length;o++){let t=a[o].getAttribute("data-filter_name"),e=a[o].getAttribute("data-order_by"),r=a[o],i=r.getAttribute("data-value_type")?r.getAttribute("data-value_type"):"string",n=null;t||e||("checkbox"!=r.type||r.checked?(n=r.value,"string"!=i&&(n=Number(n)),n&&!l.includes(n)&&l.push(n)):n=null)}return l},_initInputForm:function(t,e){if(!t)return;let r="["+e+'="'+t.id+'"]',i=t.el.getRootNode().querySelectorAll("form"+r+" input, form"+r+" textarea, form"+r+" select"),n=t.el.getRootNode().querySelectorAll("input"+r+",textarea"+r+", select"+r);this.setCheckboxName(t.id,e),i=Array.prototype.slice.call(i),n=Array.prototype.slice.call(n),i=i.concat(n);for(let e=0;e<i.length;e++){let r=i[e];r.getAttribute("data-order_by")?this._initOrderInput(t,r):this._initFilterInput(t,r,t.id)}},_initOrderInput:function(t,e){var r=this;e.addEventListener("change",(function(e){e.preventDefault();let i=this.getAttribute("data-order_by"),n=0,a=r.getOrderByName(t,i);n="asc"==this.value?1:"desc"==this.value?-1:[],r.insertArrayObject(t.orders,a,{name:i,type:n},n),t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"order"}}))}))},_initFilterInput:function(t,e,r){var i,n=this;e.addEventListener("input",(function(a){a.preventDefault();let l=this.getAttribute("data-filter_name"),o=this.getAttribute("data-filter_operator")||"$contain",c=this.getAttribute("data-filter_type"),u=this.getAttribute("data-filter_value_type")||"string";clearTimeout(i),i=setTimeout((function(){if(l){let r=n.getFilterByName(t,l,o),d=e.type,f=[];if("checkbox"==d)for(var i=document.querySelectorAll("input[name="+e.name+"]:checked"),a=0;a<i.length;a++)f.push(i[a].value);else if("raido"==d);else if("range"==d)f=[Number(e.min),Number(e.value)];else{var s=e.value;"string"!=u&&(s=Number(s)),"none"!=s&&(f=[s]),"raw"===u&&(f=s)}n.insertArrayObject(t.filters,r,{name:l,value:f,operator:o,type:c})}else t.search.value=n._makeSearchOption(r,t.attrName);t.el&&t.el.dispatchEvent(new CustomEvent("changeFilterInput",{detail:{type:"filter"}}))}),500)}))},setCheckboxName:function(t,e){for(var r=document.querySelectorAll("form["+e+'="'+t+'"]'),i=0;i<r.length;i++)for(var n=r[i].querySelectorAll("input[type=checkbox], form input[type=radio]"),a=0;a<n.length;a++){var l=n[a].getAttribute("name"),o=n[a].getAttribute("data-filter_name");!l&&o&&n[a].setAttribute("name","_"+t+"-"+o+"_"+i)}},getFilterByName:function(t,e,r){for(var i=0;i<t.filters.length;i++){var n=t.filters[i];if(n.name==e&&n.operator==r)return i}return-1},insertArrayObject:function(t,e,r,i){return i||(i=r.value),"object"==typeof i&&0==i.length?-1!=e&&t.splice(e,1):-1!=e?t[e]=r:t.push(r),t},getOrderByName:function(t,e){for(var r=0;r<t.orders.length;r++)if(t.orders[r].name==e)return r;return-1},defineEvent:function(t){t.el.addEventListener("fetchFilterData",(function(t){}))},fetchData:function(t){let e=this.makeFetchOptions(t);n().readDocumentList(e)},getObjectByFilterId:function(t,e){for(var r=0;r<t.length;r++){let i=t[r].filter;if(i&&i.id==e)return t[r]}},getObjectByElement:function(t,e){for(var r=0;r<t.length;r++){let i=t[r].filter;if(i&&i.el.isSameNode(e))return t[r]}},makeFetchOptions:function(t){let e={collection:t.collection,element:t.eId,metadata:{isRefresh:t.isRefresh},operator:{filters:t.filters,orders:t.orders,search:t.search,startIndex:t.startIndex},is_collection:t.is_collection};return t.count&&(e.operator.count=t.count),e},init:function({name:t,attribute:e,callback:r}){let i=document.querySelectorAll(`[data-fetch_collection][${e}]`);const a=this;i.forEach((r=>{a.__initFilterElement(r,e,t)})),n().listen("readDocumentList",(function(t){r.call(null,t)}))},__initFilterElement:function(t,e,r){let i=t.getAttribute(e);const n=this;if(!i)return;let a=this.setFilter(t,e,r);a&&(this.module_items.push({el:t,filter:a,id:i,name:r}),t.addEventListener("changeFilterInput",(function(t){n.fetchData(a)})),this.fetchData(a))}};a.__init();const l=a}}]);