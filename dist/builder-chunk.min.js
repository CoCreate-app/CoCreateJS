(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[8653],{3359:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});a(7388);var n=a(366),l=a(4752);function c(e){return new Promise((function(t){setTimeout((()=>{t()}),e)}))}let d,o,r,i;d=document.querySelector("#canvas"),i={collection:d.getAttribute("data-collection"),document_id:d.getAttribute("data-document_id"),name:d.getAttribute("name")},window.crdtCon=i,l.default.init(i);const s=new Promise((async function(e,t){setTimeout((()=>{if(window.location.href.endsWith("/CoCreate-builder/dist/index.html")){for(;;){if(!l.default.getText({crud:!1,...i}))break;l.default.replaceText({crud:!1,...i,value:""}),c(200)}l.default.replaceText({crud:!1,...i,value:'<!DOCTYPE html><html>\n  \n\t<body data-element_id="body" style="padding:1;">\n\t\n\t\t<h1 name="4" class="color:red" data-element_id="445797c5-e01b-42cf-a8a5-f753ab60c8f6">test 5</h1>\n\t\t<h1 data-element_id="t1" name="1">test 1</h1>\n\t\t<h1 data-element_id="t3" name="3">test 3</h1>\n\t\t<h1 data-element_id="t2" name="2">test 2</h1>\n\t\t<h1 data-element_id="t4" name="4">test 4</h1>\n\t\t\n\t\t<script>\n        var config = {\n            apiKey: \'c2b08663-06e3-440c-ef6f-13978b42883a\',\n            organization_Id: \'5de0387b12e200ea63204d6c\',\n            host: \'wss://server.cocreate.app:8088\'\n        }\n    <\/script>\n    \n     <script src="./CoCreate-builder-canvas.js"><\/script>\n        \n   \n\t</body>\n</html>'})}let t=l.default.getText({crud:!1,...i}),a=document.createElement("iframe");a.srcdoc=t;for(let e of d.attributes)a.setAttribute(e.name,e.value);d.replaceWith(a),a.addEventListener("load",(()=>{a.removeAttribute("srcdoc"),r=a.contentWindow,o=r.document||a.contentDocument,o.ccdefaultView=r,e({crdtCon:i,canvas:a,canvasDocument:o,canvasWindow:r})}))}),2e3)}));var u=a(8659),m=a(8249);const b=s.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){let c=l.default.getText({crud:!1,...e}),d=new m.default(c,a.documentElement);d.setCallback({addCallback:function({value:t,position:a}){l.default.getText({crud:!1,...e});l.default.insertText({crud:!1,...e,value:t,position:a})},removeCallback:function({from:t,to:a}){l.default.deleteText({crud:!1,...e,position:t,length:a-t})}});let o=new m.default(c,a.documentElement);return window.addEventListener("cocreate-crdt-update",(function(t){try{let t=event.detail;if(t.collection!==e.collection||t.name!==e.name||t.document_id!==e.document_id)return;let a=l.default.getText(e);o.html=d.html=a;let n=t.eventDelta;window.savedDelta?window.savedDelta.push(n):window.savedDelta=[];let c=0;for(let e=0;e<n.length;e++)if(n[e].retain)c=n[e].retain;else if(n[e].insert){let t=n[e].insert;o.addToDom({pos:c,changeStr:t})}else{let t=n[e].delete;o.removeFromDom({pos:c,removeLength:t})}}catch(e){}})),d}));s.then((async function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){const l=await b;return u.default.init({document,exclude:"#ghostEffect, .vdom-item, #selectedElementcoc, #hoveredElementcoc",callback:({value:e,type:t,property:n,element:c,unit:d})=>{try{if(a.contains(c)){let a=c.getAttribute("data-element_id");switch(d=d||"",t){case"attribute":l.setAttribute({target:a,name:n,value:e});break;case"classstyle":l.setClassStyle({target:a,classname:n,value:e,unit:d});break;case"style":l.setStyle({target:a,styleName:n,value:e,unit:d});break;case"innerText":l.setInnerText({target:a,value:e});break;case"class":l.setClass({target:a,value:e})}}}catch(e){}}})}));var v=a(3501),f=a(4727),g=a(212),h=a.n(g);const p=[{selector:"*",editable:!1,draggable:!0,droppable:!0,selectable:!0,hoverable:!0},{selector:"h1, h2, h3, h4, h5, h6, p, span, blockquote",editable:!0,draggable:!0,droppable:!1,selectable:!0,hoverable:!0},{selector:"input",editable:!1,draggable:!1,droppable:!1},{selector:"textarea",editable:!1},{selector:"select",editable:!1},{selector:"div.quill",draggable:!0,droppable:!1,selectable:!0,hoverable:!1},{selector:"div.nav",tagName:"navbar",draggable:!0,droppable:!0,selectable:!0,hoverable:!0},{selector:"div.floating-label_field",draggable:!0,droppable:!1,selectable:!1,hoverable:!1},{selector:"div.ql-editor *",draggable:!1,droppable:!1},{tagName:"icon",selector:"a.menu_icon",editable:!1,draggable:!1,droppable:!1,selectable:!0,hoverable:!0},{selector:"a.menu_icon span",selectable:!1,hoverable:!1},{selector:"menu_icon.span",editable:!1,draggable:!1,droppable:!1,selectable:!1,hoverable:!1,selectable2:!0}].reverse();window.elementConfig=p;const w=p;s.then((async function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){const l=await b;window.addEventListener("dndsuccess",(e=>{let{position:t,dragedEl:n,dropedEl:c,dropType:d,dragNextSib:o,dropNextSib:r}=e.detail;if(c.classList.contains("vdom-item")){let e=c.getAttribute("data-element_id");c=a.querySelector(`[data-element_id="${e}"]`),e=n.getAttribute("data-element_id"),n=a.querySelector(`[data-element_id="${e}"]`),c.insertAdjacentElement(t,n)}else if(!a.contains(c))return;try{switch(d){case"data-draggable":l.insertAdjacentElement({position:t,target:c.getAttribute("data-element_id"),element:n.getAttribute("data-element_id")});break;case"data-cloneable":l.insertAdjacentElement({position:t,target:c.getAttribute("data-element_id"),elementValue:n.outerHTML})}}catch(e){}})),v.default.initIframe({isIframe:!0,frame:t}),v.default.init({mode:"function",target:a,onDnd:(e,t)=>{for(let a of(0,f.configMatch)(w,e))for(let n of t)return!0===a[n.substr(5)]?[e,n]:void 0},onDndSuccess:e=>{e.dragedEl.getAttribute("data-element_id")||e.dragedEl.setAttribute("data-element_id",h().generate())}})}));var _=a(371);s.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){_.default.init({selector:"#selectedElementcoc",eventType:"click",config:w,configKey:"selectable",document:a}),_.default.init({selector:"#hoveredElementcoc",eventType:"mouseover",config:w,configKey:"hoverable",document:a})}));var y=a(2671);s.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){let l=document.querySelector("[data-vdom_target]"),c=document.querySelector("[data-vdom_id]");c=c.contentDocument.body.parentNode,l&&(l.innerText=""),c&&l&&(window.vdomObject=y.default.initVdom({realdom:c,virtualDom:l,ignore:"#dropMarker, script"}))}));var A=a(685);s.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){A.default.config({srcDocument:a,destDocument:document,selector:"*",target:"[data-attributes]:not(.styleunit)",callback:(e,a)=>{a.setAttribute("name",a.id+"-"+e.getAttribute("data-element_id")),a.setAttribute("data-attributes_target",`#${t.id};[data-element_id="${e.getAttribute("data-element_id")}"]`)}}),A.default.config({srcDocument:a,destDocument:document,selector:"*",target:".styleunit",callback:(e,t)=>{t.setAttribute("name",t.id+"-"+e.getAttribute("data-element_id"))}})}));var C=a(602),D=a(2742);const T={auto:!0,inherit:!0,initial:!0};function E(e){let t=e.target;if(t.matches(C.zO)&&t.matches('[data-attributes="data-attributes_unit"]')){let e=t.selectedOptions[0];if(!e)return;let a=e.getAttribute("value");if(T[a]){D.container.get(t).unselectAll(!0);let e=t.getAttribute("data-attributes_target");if(!e)return;let n=document.querySelector(e);if(!n)return;l.default.replaceText({collection:"builder",document_id:"null",name:n.getAttribute("name"),value:a+"",position:"0"})}}}s.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){document.addEventListener("input",E)}));(async()=>{a.e(2454).then(a.bind(a,7305)),Promise.all([a.e(7822),a.e(1272),a.e(225),a.e(3238)]).then(a.bind(a,4496)),a.e(4478).then(a.bind(a,4454)),a.e(1305).then(a.bind(a,2643)),a.e(9573).then(a.bind(a,9484)),a.e(3924).then(a.bind(a,1384)),Promise.resolve().then(a.bind(a,439))})();const k={crdt:l.default,observer:n.default}}}]);