(this.webpackChunkCoCreate=this.webpackChunkCoCreate||[]).push([[8653],{5898:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});a(7388);var n=a(366),d=a(4752);function l(e){return new Promise((function(t){setTimeout((()=>{t()}),e)}))}let i,o,c,r;function s(e,t,a){let n=Object.assign({},e);n.collection=n.document_id,n.document_id="null",t.init(n);let d=a.createElement("div");return d.setAttribute("contenteditable",""),d.style.display="none",d.setAttribute("data-document_id",n.document_id),d.setAttribute("data-collection",n.collection),d.setAttribute("name",n.name),a.body.appendChild(d),n}i=document.querySelector("#canvas"),r={collection:i.getAttribute("data-collection"),document_id:i.getAttribute("data-document_id"),name:i.getAttribute("name")},window.crdtCon=r,d.default.init(r);s(r,d.default,document);const u=new Promise((async function(e,t){setTimeout((()=>{if(window.location.href.endsWith("/CoCreate-builder/dist/index.html")){for(;;){if(!d.default.getText({crud:!1,...r}))break;d.default.replaceText({crud:!1,...r,value:""}),l(200)}d.default.replaceText({crud:!1,...r,value:'<!DOCTYPE html><html>\n  \n\t<body data-element_id="body" style="padding:1;">\n\t\n\t\t<h1 name="4" class="color:red" data-element_id="445797c5-e01b-42cf-a8a5-f753ab60c8f6">test 5</h1>\n\t\t<h1 data-element_id="t1" name="1">test 1</h1>\n\t\t<h1 data-element_id="t3" name="3">test 3</h1>\n\t\t<h1 data-element_id="t2" name="2">test 2</h1>\n\t\t<h1 data-element_id="t4" name="4">test 4</h1>\n\t\t\n\t\t<script>\n        var config = {\n            apiKey: \'c2b08663-06e3-440c-ef6f-13978b42883a\',\n            organization_Id: \'5de0387b12e200ea63204d6c\',\n            host: \'wss://server.cocreate.app:8088\'\n        }\n    <\/script>\n    \n     <script src="./CoCreate-builder-canvas.js"><\/script>\n        \n   \n\t</body>\n</html>'})}let t=d.default.getText({crud:!1,...r}),a=document.createElement("iframe");a.srcdoc=t;for(let e of i.attributes)a.setAttribute(e.name,e.value);i.replaceWith(a),a.addEventListener("load",(()=>{a.removeAttribute("srcdoc"),c=a.contentWindow,o=c.document||a.contentDocument,o.ccdefaultView=c;let t=s(r,c.CoCreate.crdt,o);e({crdtCon:r,weirdCrdtCon:t,canvas:a,canvasDocument:o,canvasWindow:c})}))}),5e3)}));var m=a(8659),b=a(8249);const v=u.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){let l=d.default.getText({crud:!1,...e}),i=new b.default(l,a.documentElement);i.setCallback({addCallback:function({value:t,position:a,avoidTextToDom:n=!1}){d.default.getText({crud:!1,...e});CoCreate.crdt.insertText({crud:!1,...e,value:t,position:a})},removeCallback:function({from:t,to:a,avoidTextToDom:n=!1}){CoCreate.crdt.deleteText({crud:!1,...e,position:t,length:a-t})}});let o=new b.default(l,a.documentElement);return window.addEventListener("cocreate-crdt-update",(function(t){try{let t=event.detail;if(t.collection!==e.collection||t.name!==e.name||t.document_id!==e.document_id)return;let a=t.eventDelta;for(let e=0;e<a.length;e++)if(a[e]?.attributes?.avoidTextToDom)return;let n=d.default.getText(e);o.html=i.html=n,window.savedDelta?window.savedDelta.push(a):window.savedDelta=[];let l=0;for(let e=0;e<a.length;e++)if(a[e].retain)l=a[e].retain;else if(a[e].insert){let t=a[e].insert;o.addToDom({pos:l,changeStr:t})}else{let t=a[e].delete;o.removeFromDom({pos:l,removeLength:t})}}catch(e){}})),i}));u.then((async function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){const d=await v;return m.default.init({document,exclude:"#ghostEffect, .vdom-item, #selectedElementcoc, #hoveredElementcoc",callback:({value:e,type:t,property:n,element:l,unit:i})=>{try{if(a.contains(l)){let a=l.getAttribute("data-element_id");switch(i=i||"",t){case"attribute":d.setAttribute({target:a,name:n,value:e});break;case"classstyle":d.setClassStyle({target:a,classname:n,value:e,unit:i});break;case"style":d.setStyle({target:a,styleName:n,value:e,unit:i});break;case"innerText":d.setInnerText({target:a,value:e});break;case"class":d.setClass({target:a,value:e})}}}catch(e){}}})}));var f=a(5949),g=a(4727),h=a(212),p=a.n(h);const w=[{selector:"*",editable:!1,draggable:!0,droppable:!0,selectable:!0,hoverable:!0},{selector:"h1, h2, h3, h4, h5, h6, p, span, blockquote",editable:!0,draggable:!0,droppable:!1,selectable:!0,hoverable:!0},{selector:"input",editable:!1,draggable:!1,droppable:!1},{selector:"textarea",editable:!1},{selector:"select",editable:!1},{selector:"div.quill",draggable:!0,droppable:!1,selectable:!0,hoverable:!1},{selector:"div.nav",tagName:"navbar",draggable:!0,droppable:!0,selectable:!0,hoverable:!0},{selector:"div.floating-label_field",draggable:!0,droppable:!1,selectable:!1,hoverable:!1},{selector:"div.ql-editor *",draggable:!1,droppable:!1},{tagName:"icon",selector:"a.menu_icon",editable:!1,draggable:!1,droppable:!1,selectable:!0,hoverable:!0},{selector:"a.menu_icon span",selectable:!1,hoverable:!1},{selector:"menu_icon.span",editable:!1,draggable:!1,droppable:!1,selectable:!1,hoverable:!1,selectable2:!0}].reverse();window.elementConfig=w;const _=w;u.then((async function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){const d=await v;window.addEventListener("dndsuccess",(e=>{let{position:t,dragedEl:n,dropedEl:l,dropType:i,dragNextSib:o,dropNextSib:c}=e.detail;if(l.classList.contains("vdom-item")){let e=l.getAttribute("data-element_id");l=a.querySelector(`[data-element_id="${e}"]`),e=n.getAttribute("data-element_id"),n=a.querySelector(`[data-element_id="${e}"]`),l.insertAdjacentElement(t,n)}else if(!a.contains(l))return;try{switch(i){case"data-draggable":d.insertAdjacentElement({position:t,target:l.getAttribute("data-element_id"),element:n.getAttribute("data-element_id"),metadata:{type:"dnd"}});break;case"data-cloneable":d.insertAdjacentElement({position:t,target:l.getAttribute("data-element_id"),elementValue:n.outerHTML,metadata:{type:"dnd"}})}}catch(e){}})),f.default.initIframe({isIframe:!0,frame:t}),f.default.init({mode:"function",target:a,onDnd:(e,t)=>{for(let a of(0,g.configMatch)(_,e))for(let n of t)return!0===a[n.substr(5)]?[e,n]:void 0},onDndSuccess:e=>{e.dragedEl.getAttribute("data-element_id")||e.dragedEl.setAttribute("data-element_id",p().generate())}})}));var C=a(371);u.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){C.default.init({selector:"#selectedElementcoc",eventType:"click",config:_,configKey:"selectable",document:a}),C.default.init({selector:"#hoveredElementcoc",eventType:"mouseover",config:_,configKey:"hoverable",document:a})}));var y=a(2671);u.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){let d=document.querySelector("[data-vdom_target]"),l=document.querySelector("[data-vdom_id]");l=l.contentDocument.body.parentNode,d&&(d.innerText=""),l&&d&&(window.vdomObject=y.default.initVdom({realdom:l,virtualDom:d,ignore:"#dropMarker, script"}))}));var A=a(685);u.then((function({crdtCon:e,weirdCrdtCon:t,canvas:a,canvasDocument:n,canvasWindow:d}){A.default.config({srcDocument:n,destDocument:document,selector:"*",target:"[data-attributes]:not(.styleunit)",callback:(e,n)=>{n.setAttribute("name",n.id+"-"+e.getAttribute("data-element_id")),n.setAttribute("data-attributes_target",`#${a.id};[data-element_id="${e.getAttribute("data-element_id")}"]`),n.setAttribute("collection",t.collection)}}),A.default.config({srcDocument:n,destDocument:document,selector:"*",target:".styleunit",callback:(e,a)=>{a.setAttribute("name",a.id+"-"+e.getAttribute("data-element_id")),a.setAttribute("collection",t.collection)}})}));var T=a(602),x=a(2742);const D={auto:!0,inherit:!0,initial:!0};function E(e){let t=e.target;if(t.matches(T.zO)&&t.matches('[data-attributes="data-attributes_unit"]')){let e=t.selectedOptions[0];if(!e)return;let a=e.getAttribute("value");if(D[a]){x.container.get(t).unselectAll(!0);let e=t.getAttribute("data-attributes_target");if(!e)return;let n=document.querySelector(e);if(!n)return;d.default.replaceText({collection:"builder",document_id:"null",name:n.getAttribute("name"),value:a+"",position:"0"})}}}u.then((function({crdtCon:e,canvas:t,canvasDocument:a,canvasWindow:n}){document.addEventListener("input",E)})),u.then((async function({crdtCon:e,weirdCrdtCon:t,canvas:a,canvasDocument:n,canvasWindow:l}){const i=await v;n.addEventListener("dblclick",(e=>{let a=e.target;if(a.hasAttribute("contenteditable"))return;let n=a.innerText,l=a.getAttribute("data-element_id");a.setAttribute("contenteditable",!0),a.setAttribute("name",`innertext-${l}`),a.setAttribute("data-collection",t.collection),a.setAttribute("data-document_id",t.document_id),setTimeout((()=>{!d.default.getText(t)&&a.innerText||d.default.getText(t)&&!a.innerText||d.default.replaceText({crud:!1,...t,value:n})}),0),a.addEventListener("input",(()=>{i.setInnerText({target:l,value:a.innerText,avoidTextToDom:!0})}))}))}));(async()=>{a.e(2454).then(a.bind(a,7305)),Promise.all([a.e(7822),a.e(225),a.e(1272),a.e(3238)]).then(a.bind(a,4496)),a.e(4478).then(a.bind(a,4454)),a.e(1305).then(a.bind(a,2643)),a.e(9573).then(a.bind(a,9484)),a.e(3924).then(a.bind(a,1384)),Promise.resolve().then(a.bind(a,439))})();const k={crdt:d.default,observer:n.default}}}]);